---
title: How should we measure manager performance in fantasy football?
description: "All-play team_scores, optimal lineup choices, and more"
date: 2024-01-02
categories:
  - r
  - football (american)
draft: true
image: latest-all-play-h2h.png
execute: 
  code-fold: false
  eval: false
  include: false
  echo: false
---

## Introduction

If you've played (American) fantasy football, you've probably felt that you have been unlucky and unjustfully lost matches at some point. "I had the second most points of any team in my league this week, and I only lost because I happened to play the team that scored the most points!" So the first thing that we probably do is go to our league standings and look to see how we stack up against the rest of the teams in points for and against. If you've scored the third most points but your current placing is eighth because you've happened to have the most points scored against you, then of course you have grounds to feel slighted.

But are there other ways you can go about justifying your dissatisfaction? Yes, indeed I can think of three:

1.  **All-play record**: What would your position in the league table be if every team played all other teams in head-to-head matchups every week?
2.  **Actual points scored compared to projection**: Are you scoring less than your projected total? Is your team under-performing more than other teams compared to their projected team_scores?
3.  **Points "left on the bench"**: How many points could you have had if you had started the best possible lineup (with the benefit of hindsight)?

I want to look at how we can calculate these things for the past 5 years of my primary fantasy football league. (Yes, like most sickos, I have multiple league). Comparing counter-factual team_scores should build up some intuition about all the ways that things can go wrong.

## Analysis and Results

```{r}
#| label: setup
## data ingestion
library(readr)
library(qs)

## data manipulation
library(dplyr)
library(tidyr)

## tables
library(gt)
library(gtExtras)

## plotting
library(ggplot2)
library(sysfonts)
library(showtext)
library(ggtext)
library(htmltools)
library(glue)
library(stringr)

PROJ_DIR <- 'posts/fantasy-football-performance'
DATA_DIR <- file.path(PROJ_DIR, 'data')
source(file.path(PROJ_DIR, 'theme.R'))
```

The data comes from the past 2018 - 2023 seasons of my primary fantasy football league. We've had different rule sets and schedule formats (i.e. playoffs started in week 14 prior to 2022 in this league), but for the most part, measures of performance should be mostly agnostic to this.

I've anonymized my league mates' names with letters of the alphabet, partly to save readers from viewing oddly-specific jokes, but mostly to focus the analysis on the methods and numbers.

### All-play records

I felt like I was particularly unlucky with my schedule this past year, and indeed this bears out in the numbers.[^1]

[^1]: For those looking to calculate this kind of table for themselves, ["The Fantasy Football Hub"](https://theffhub.com/) has a nice calculator, plus some extra goodies, e.g. "What would my record have been if I had league member X's schedule?".

```{r}
#| label: all-play
## Won't need sorting most of the time, but it's convenient to have a factor for local debugging
anonymize_team <- function(team, id) {
  factor(
    ifelse(id == 7, 'Tony', LETTERS[id]),
    levels = c(LETTERS[1:6], 'Tony', LETTERS[8:10])
  )
}

leagues <- qs::qread(file.path(DATA_DIR, 'leagues-all.qs'))
init_n_regular_season_weeks <- leagues |> 
  purrr::map(
    \(.x) {
      n_regular_season_weeks <- .x$settings$scheduleSettings$matchupPeriods |> 
        purrr::map_int(\(p) length(p)) |> 
        ## our post-seasons always have 2 weeks
        purrr::keep(\(l) l == 1L) |> 
        length()
      setNames(
        n_regular_season_weeks,
        .x$seasonId
      )
    }
  ) |> 
  purrr::flatten()

n_regular_season_weeks <- tibble::tibble(
  season = as.integer(names(init_n_regular_season_weeks)),
  last_regular_season_week = as.integer(unname(init_n_regular_season_weeks))
)

franchises <- readr::read_csv(file.path(DATA_DIR, 'franchises-all.csv')) |> 
  dplyr::transmute(
    season,
    franchise_id,
    user_name,
    team = anonymize_team(user_name, franchise_id)
  )
LATEST_SEASON <- max(unique(franchises$season))

team_scores <- readr::read_csv(file.path(DATA_DIR, 'team-scores-all.csv')) |> 
  dplyr::mutate(
    team = anonymize_team(user_name, franchise_id),
    opponent_name = anonymize_team(opponent_user_name, opponent_id)
  ) |> 
  dplyr::filter(!is.na(result)) |> 
  dplyr::inner_join(
    n_regular_season_weeks,
    by = dplyr::join_by(season)
  ) |> 
  dplyr::filter(
    week <= last_regular_season_week
  ) |> 
  dplyr::select(-last_regular_season_week) |> 
  ## if we were dealing with multi-week matchup periods, then this would be more useful
  dplyr::mutate(n_weeks_in_matchup = 1L)

actual_records <- team_scores |> 
  dplyr::mutate(
    w = user_score > opponent_score,
    l = user_score < opponent_score
  ) |> 
  dplyr::arrange(season) |> 
  dplyr::group_by(season, team) |> 
  dplyr::summarize(
    dplyr::across(
      c(w, l),
      sum
    )
  ) |> 
  dplyr::ungroup()

all_play_records <- tidyr::crossing(
  team_scores |> dplyr::distinct(season, week),
  team = franchises$team,
  opponent_name = franchises$team
) |> 
  dplyr::filter(team != opponent_name) |> 
  dplyr::inner_join(
    team_scores |>
      dplyr::select(season, week, team, user_score),
    by = dplyr::join_by(season, week, team)
  ) |>
  dplyr::inner_join(
    team_scores |> 
      dplyr::select(
        season,
        week,
        opponent_name = team,
        opponent_score = user_score
      ),
    by = dplyr::join_by(season, week, opponent_name)
  ) |> 
  dplyr::mutate(
    w = user_score > opponent_score,
    l = user_score < opponent_score
  ) |> 
  dplyr::group_by(season, team) |> 
  dplyr::summarize(
    dplyr::across(
      c(w, l),
      sum
    )
  ) |> 
  dplyr::ungroup() |> 
  dplyr::arrange(season, dplyr::desc(w))

compared_all_play_records <- all_play_records |> 
  dplyr::transmute(
    season,
    team,
    all_play_season = season,
    all_play_w = w,
    all_play_l = l,
    all_play_w_prop = w / (w + l)
  ) |> 
  dplyr::inner_join(
    actual_records |> 
      dplyr::transmute(
        season,
        team,
        actual_w = w,
        actual_l = l,
        actual_w_prop = w / (w + l)
      ),
    by = dplyr::join_by(season, team),
    relationship = 'many-to-many'
  ) |> 
  dplyr::mutate(
    w_prop_d = actual_w_prop - all_play_w_prop
  ) |> 
  dplyr::arrange(w_prop_d)

## Inspired by gtExtras::gt_hulk_col_numeric
.zero_centered_pal <- function(x, negative_colors, positive_colors, zero_color = '#F7F7F7') {
  rng <- range(x, na.rm = TRUE)
  mi <- rng[1]
  ma <- rng[2]
  f_neg <- scales::col_numeric(
    palette = c(negative_colors, zero_color),
    domain = c(mi, 0)
  )
  f_pos <- scales::col_numeric(
    palette = c(zero_color, positive_colors),
    domain = c(0, ma)
  )
  suppressWarnings(
    ifelse(x < 0, f_neg(x), f_pos(x))
  )
}

.zero_centered_brewer_pal <- function(x, palette = 'PRGn', n_colors = 7) {
  colors <- RColorBrewer::brewer.pal(n_colors, palette)
  function(x) {
    .zero_centered_pal(
      x,
      negative_colors = colors[1:floor(n_colors / 2)],
      positive_colors = colors[ceiling((n_colors + 2) / 2):n_colors]
    )
  }
}

.gt_zerocentered_brewer_col_numeric <- function(gt_object, columns = NULL, palette = 'PRGn', alpha = 0.9) {
  
  gt::data_color(
    gt_object,
    columns = {{ columns }},
    fn = .zero_centered_brewer_pal(palette = palette),
    alpha = alpha
  )
}

CAPTION_LABEL <- "Data from Tony's personal league."
latest_all_play_h2h_gt <- compared_all_play_records |> 
  dplyr::filter(season == LATEST_SEASON) |> 
  dplyr::arrange(w_prop_d) |> 
  dplyr::select(
    team,
    actual_w,
    actual_l,
    all_play_w,
    all_play_l,
    actual_w_prop,
    all_play_w_prop,
    w_prop_d
  ) |> 
  gt::gt() |> 
  gt::cols_label(
    team ~ 'Team',
    actual_w ~ 'W',
    actual_l ~ 'L',
    all_play_w ~ 'W',
    all_play_l ~ 'L',
    actual_w_prop ~ 'Actual',
    all_play_w_prop ~ 'All Play',
    w_prop_d ~ gt::md('**Δ**')
  ) |> 
  # gtExtras::gt_theme_538() |> 
  # gtExtras::gt_theme_dark() |> 
  .gt_theme_538_dark() |> 
  gt::tab_spanner(
    columns = c(actual_w, actual_l),
    label = 'Actual'
  ) |> 
  gt::tab_spanner(
    columns = c(all_play_w, all_play_l),
    label = 'All Play'
  ) |> 
  gt::cols_align(
    columns = team,
    align = 'left'
  ) |> 
  gt::tab_spanner(
    columns = c(actual_w_prop, all_play_w_prop),
    label = 'Win %'
  ) |> 
  .gt_zerocentered_brewer_col_numeric(
    columns = w_prop_d,
    palette = 'PRGn'
  ) |> 
  gt::fmt_percent(
    columns = dplyr::matches('_prop'),
    decimals = 0
  ) |> 
  gt::tab_header(
    title = glue::glue('{LATEST_SEASON} All Play records'),
    subtitle = 'Tony was the most unlucky in the league this season.'
  ) |> 
  gt::tab_footnote(
    footnote = CAPTION_LABEL
  )

gtExtras::gtsave_extra(
  latest_all_play_h2h_gt,
  filename = file.path(PROJ_DIR, 'latest-all-play-h2h.png')
)

## Reference: https://stackoverflow.com/questions/74349523/avoid-quarto-table-style-in-table-that-contains-images
make_tbl_quarto_robust <- function(tbl) {
  # Get tbl html code (without the inline stuff)
  tbl_html <- tbl |>
    gt::as_raw_html(inline_css = FALSE) 
  
  # Find table id
  tbl_id <-  stringr::str_match(tbl_html, 'id="(.*)"\\s')[,2] 
  
  # Split html so that we only replace strings in the css part at first
  # That's important for performance
  split_html <- tbl_html |> 
    stringr::str_split_1('<table class="gt_table".{0,}>')
  css_part <- split_html[1] |> 
    stringr::str_split_1('<style>')
  
  # Create regex to add table id
  my_regex <- stringr::str_c('(', tbl_id, ' )?(.* \\{)')
  replaced_css <- css_part[2] |>
    # Make global html changes more specific
    stringr::str_replace_all('html \\{', stringr::str_c(tbl_id, ' .gt_table {')) |> 
    # Make changes to everything specific to the table id
    stringr::str_replace_all(my_regex, stringr::str_c('\\#', tbl_id, ' \\2')) |> 
    # Replace duplicate names 
    stringr::str_replace_all(
      stringr::str_c('\\#', tbl_id, ' \\#', tbl_id),
      stringr::str_c('\\#', tbl_id)
    )
  
  # Put split html back together
  stringr::str_c(
    css_part[1], '<style>', 
    replaced_css, '<table class="gt_table">', 
    split_html[2]
  ) |> 
    # Rename all gt_* classes to new_gt_*
    stringr::str_replace_all('(\\.|class="| )gt', '\\1new_gt') |> 
    # Reformat as html
    gt::html()
}

make_tbl_quarto_robust(latest_all_play_h2h_gt) |> clipr::write_clip()
```

```{=html}
<div id="qddsbafhds" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#qddsbafhds table {
font-family: 'Titillium Web', system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
-webkit-font-smoothing: antialiased;
-moz-osx-font-smoothing: grayscale;
}

#qddsbafhds thead, #qddsbafhds tbody, #qddsbafhds tfoot, #qddsbafhds tr, #qddsbafhds td, #qddsbafhds th {
border-style: none;
}

#qddsbafhds p {
margin: 0;
padding: 0;
}

#qddsbafhds .new_gt_table {
display: table;
border-collapse: collapse;
line-height: normal;
margin-left: auto;
margin-right: auto;
color: #FFFFFF;
font-size: 16px;
font-weight: 400;
font-style: normal;
background-color: #222222;
width: auto;
border-top-style: none;
border-top-width: 3px;
border-top-color: #A8A8A8;
border-right-style: none;
border-right-width: 2px;
border-right-color: #222222;
border-bottom-style: none;
border-bottom-width: 2px;
border-bottom-color: #222222;
border-left-style: none;
border-left-width: 2px;
border-left-color: #222222;
}

#qddsbafhds .new_gt_caption {
padding-top: 4px;
padding-bottom: 4px;
}

#qddsbafhds .new_gt_title {
color: #FFFFFF;
font-size: 125%;
font-weight: initial;
padding-top: 4px;
padding-bottom: 4px;
padding-left: 5px;
padding-right: 5px;
border-bottom-color: #222222;
border-bottom-width: 0;
}

#qddsbafhds .new_gt_subtitle {
color: #FFFFFF;
font-size: 85%;
font-weight: initial;
padding-top: 3px;
padding-bottom: 5px;
padding-left: 5px;
padding-right: 5px;
border-top-color: #222222;
border-top-width: 0;
}

#qddsbafhds .new_gt_heading {
background-color: #222222;
text-align: left;
border-bottom-color: #222222;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
}

#qddsbafhds .new_gt_bottom_border {
border-bottom-style: none;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
}

#qddsbafhds .new_gt_col_headings {
border-top-style: none;
border-top-width: 2px;
border-top-color: #D3D3D3;
border-bottom-style: solid;
border-bottom-width: 3px;
border-bottom-color: #FFFFFF;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
}

#qddsbafhds .new_gt_col_heading {
color: #FFFFFF;
background-color: #222222;
font-size: 100%;
font-weight: normal;
text-transform: inherit;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
vertical-align: bottom;
padding-top: 5px;
padding-bottom: 6px;
padding-left: 5px;
padding-right: 5px;
overflow-x: hidden;
}

#qddsbafhds .new_gt_column_spanner_outer {
color: #FFFFFF;
background-color: #222222;
font-size: 100%;
font-weight: normal;
text-transform: inherit;
padding-top: 0;
padding-bottom: 0;
padding-left: 4px;
padding-right: 4px;
}

#qddsbafhds .new_gt_column_spanner_outer:first-child {
padding-left: 0;
}

#qddsbafhds .new_gt_column_spanner_outer:last-child {
padding-right: 0;
}

#qddsbafhds .new_gt_column_spanner {
border-bottom-style: solid;
border-bottom-width: 3px;
border-bottom-color: #FFFFFF;
vertical-align: bottom;
padding-top: 5px;
padding-bottom: 5px;
overflow-x: hidden;
display: inline-block;
width: 100%;
}

#qddsbafhds .new_gt_spanner_row {
border-bottom-style: hidden;
}

#qddsbafhds .new_gt_group_heading {
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
color: #FFFFFF;
background-color: #222222;
font-size: 100%;
font-weight: initial;
text-transform: inherit;
border-top-style: none;
border-top-width: 2px;
border-top-color: #222222;
border-bottom-style: solid;
border-bottom-width: 1px;
border-bottom-color: #FFFFFF;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
vertical-align: middle;
text-align: left;
}

#qddsbafhds .new_gt_empty_group_heading {
padding: 0.5px;
color: #FFFFFF;
background-color: #222222;
font-size: 100%;
font-weight: initial;
border-top-style: none;
border-top-width: 2px;
border-top-color: #222222;
border-bottom-style: solid;
border-bottom-width: 1px;
border-bottom-color: #FFFFFF;
vertical-align: middle;
}

#qddsbafhds .new_gt_from_md > :first-child {
margin-top: 0;
}

#qddsbafhds .new_gt_from_md > :last-child {
margin-bottom: 0;
}

#qddsbafhds .new_gt_row {
padding-top: 7px;
padding-bottom: 7px;
padding-left: 5px;
padding-right: 5px;
margin: 10px;
border-top-style: solid;
border-top-width: 1px;
border-top-color: #D3D3D3;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
vertical-align: middle;
overflow-x: hidden;
}

#qddsbafhds .new_gt_stub {
color: #FFFFFF;
background-color: #222222;
font-size: 100%;
font-weight: initial;
text-transform: inherit;
border-right-style: solid;
border-right-width: 0px;
border-right-color: #FFFFFF;
padding-left: 5px;
padding-right: 5px;
}

#qddsbafhds .new_gt_stub_row_group {
color: #FFFFFF;
background-color: #222222;
font-size: 100%;
font-weight: initial;
text-transform: inherit;
border-right-style: solid;
border-right-width: 2px;
border-right-color: #D3D3D3;
padding-left: 5px;
padding-right: 5px;
vertical-align: top;
}

#qddsbafhds .new_gt_row_group_first td {
border-top-width: 2px;
}

#qddsbafhds .new_gt_row_group_first th {
border-top-width: 2px;
}

#qddsbafhds .new_gt_summary_row {
color: #FFFFFF;
background-color: #222222;
text-transform: inherit;
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
}

#qddsbafhds .new_gt_first_summary_row {
border-top-style: solid;
border-top-color: #D3D3D3;
}

#qddsbafhds .new_gt_first_summary_row.thick {
border-top-width: 2px;
}

#qddsbafhds .new_gt_last_summary_row {
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
}

#qddsbafhds .new_gt_grand_summary_row {
color: #FFFFFF;
background-color: #222222;
text-transform: inherit;
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
}

#qddsbafhds .new_gt_first_grand_summary_row {
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
border-top-style: double;
border-top-width: 6px;
border-top-color: #D3D3D3;
}

#qddsbafhds .new_gt_last_grand_summary_row_top {
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
border-bottom-style: double;
border-bottom-width: 6px;
border-bottom-color: #D3D3D3;
}

#qddsbafhds .new_gt_striped {
background-color: rgba(128, 128, 128, 0.05);
}

#qddsbafhds .new_gt_table_body {
border-top-style: none;
border-top-width: 2px;
border-top-color: #D3D3D3;
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #222222;
}

#qddsbafhds .new_gt_footnotes {
color: #FFFFFF;
background-color: #222222;
border-bottom-style: none;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
border-left-style: none;
border-left-width: 2px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 2px;
border-right-color: #D3D3D3;
}

#qddsbafhds .new_gt_footnote {
margin: 0px;
font-size: 90%;
padding-top: 4px;
padding-bottom: 4px;
padding-left: 5px;
padding-right: 5px;
}

#qddsbafhds .new_gt_sourcenotes {
color: #FFFFFF;
background-color: #222222;
border-bottom-style: none;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
border-left-style: none;
border-left-width: 2px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 2px;
border-right-color: #D3D3D3;
}

#qddsbafhds .new_gt_sourcenote {
font-size: 12px;
padding-top: 4px;
padding-bottom: 4px;
padding-left: 5px;
padding-right: 5px;
}

#qddsbafhds .new_gt_left {
text-align: left;
}

#qddsbafhds .new_gt_center {
text-align: center;
}

#qddsbafhds .new_gt_right {
text-align: right;
font-variant-numeric: tabular-nums;
}

#qddsbafhds .new_gt_font_normal {
font-weight: normal;
}

#qddsbafhds .new_gt_font_bold {
font-weight: bold;
}

#qddsbafhds .new_gt_font_italic {
font-style: italic;
}

#qddsbafhds .new_gt_super {
font-size: 65%;
}

#qddsbafhds .new_gt_footnote_marks {
font-size: 75%;
vertical-align: 0.4em;
position: initial;
}

#qddsbafhds .new_gt_asterisk {
font-size: 100%;
vertical-align: 0;
}

#qddsbafhds .new_gt_indent_1 {
text-indent: 5px;
}

#qddsbafhds .new_gt_indent_2 {
text-indent: 10px;
}

#qddsbafhds .new_gt_indent_3 {
text-indent: 15px;
}

#qddsbafhds .new_gt_indent_4 {
text-indent: 20px;
}

#qddsbafhds .new_gt_indent_5 {
text-indent: 25px;
}

#qddsbafhds tbody tr:last-child {
border-bottom: 2px solid #ffffff00;
}
</style>
<table class="new_gt_table">
<thead>
<tr class="new_gt_heading">
<td colspan="8" class="new_gt_heading new_gt_title new_gt_font_normal" style="font-family: 'Titillium Web'; font-weight: 700;">2023 All Play records</td>
</tr>
<tr class="new_gt_heading">
<td colspan="8" class="new_gt_heading new_gt_subtitle new_gt_font_normal new_gt_bottom_border" style="font-family: 'Titillium Web'; font-weight: 400;">Tony was the most unlucky in the league this season.</td>
</tr>
<tr class="new_gt_col_headings new_gt_spanner_row">
<th class="new_gt_col_heading new_gt_columns_bottom_border new_gt_left" rowspan="2" colspan="1" style="color: #FFFFFF; font-family: 'Titillium Web'; text-transform: uppercase; font-size: 14px; vertical-align: bottom; font-weight: 200; border-top-width: 0px; border-top-style: solid; border-top-color: #222222;" scope="col" id="Team">Team</th>
<th class="new_gt_center new_gt_columns_top_border new_gt_column_spanner_outer" rowspan="1" colspan="2" scope="colgroup" id="Actual">
<span class="new_gt_column_spanner">Actual</span>
</th>
<th class="new_gt_center new_gt_columns_top_border new_gt_column_spanner_outer" rowspan="1" colspan="2" scope="colgroup" id="All Play">
<span class="new_gt_column_spanner">All Play</span>
</th>
<th class="new_gt_center new_gt_columns_top_border new_gt_column_spanner_outer" rowspan="1" colspan="2" scope="colgroup" id="Win %">
<span class="new_gt_column_spanner">Win %</span>
</th>
<th class="new_gt_col_heading new_gt_columns_bottom_border new_gt_right" rowspan="2" colspan="1" style="color: #FFFFFF; font-family: 'Titillium Web'; text-transform: uppercase; font-size: 14px; vertical-align: bottom; font-weight: 200; border-top-width: 0px; border-top-style: solid; border-top-color: #222222;" scope="col" id="&lt;strong&gt;Δ&lt;/strong&gt;"><strong>Δ</strong></th>
</tr>
<tr class="new_gt_col_headings">
<th class="new_gt_col_heading new_gt_columns_bottom_border new_gt_right" rowspan="1" colspan="1" style="color: #FFFFFF; font-family: 'Titillium Web'; text-transform: uppercase; font-size: 14px; vertical-align: bottom; font-weight: 200; border-top-width: 0px; border-top-style: solid; border-top-color: #222222;" scope="col" id="W">W</th>
<th class="new_gt_col_heading new_gt_columns_bottom_border new_gt_right" rowspan="1" colspan="1" style="color: #FFFFFF; font-family: 'Titillium Web'; text-transform: uppercase; font-size: 14px; vertical-align: bottom; font-weight: 200; border-top-width: 0px; border-top-style: solid; border-top-color: #222222;" scope="col" id="L">L</th>
<th class="new_gt_col_heading new_gt_columns_bottom_border new_gt_right" rowspan="1" colspan="1" style="color: #FFFFFF; font-family: 'Titillium Web'; text-transform: uppercase; font-size: 14px; vertical-align: bottom; font-weight: 200; border-top-width: 0px; border-top-style: solid; border-top-color: #222222;" scope="col" id="W">W</th>
<th class="new_gt_col_heading new_gt_columns_bottom_border new_gt_right" rowspan="1" colspan="1" style="color: #FFFFFF; font-family: 'Titillium Web'; text-transform: uppercase; font-size: 14px; vertical-align: bottom; font-weight: 200; border-top-width: 0px; border-top-style: solid; border-top-color: #222222;" scope="col" id="L">L</th>
<th class="new_gt_col_heading new_gt_columns_bottom_border new_gt_right" rowspan="1" colspan="1" style="color: #FFFFFF; font-family: 'Titillium Web'; text-transform: uppercase; font-size: 14px; vertical-align: bottom; font-weight: 200; border-top-width: 0px; border-top-style: solid; border-top-color: #222222;" scope="col" id="Actual">Actual</th>
<th class="new_gt_col_heading new_gt_columns_bottom_border new_gt_right" rowspan="1" colspan="1" style="color: #FFFFFF; font-family: 'Titillium Web'; text-transform: uppercase; font-size: 14px; vertical-align: bottom; font-weight: 200; border-top-width: 0px; border-top-style: solid; border-top-color: #222222;" scope="col" id="All Play">All Play</th>
</tr>
</thead>
<tbody class="new_gt_table_body">
<tr><td headers="team" class="new_gt_row new_gt_left">Tony</td>
<td headers="actual_w" class="new_gt_row new_gt_right">4</td>
<td headers="actual_l" class="new_gt_row new_gt_right">10</td>
<td headers="all_play_w" class="new_gt_row new_gt_right">56</td>
<td headers="all_play_l" class="new_gt_row new_gt_right">70</td>
<td headers="actual_w_prop" class="new_gt_row new_gt_right">29%</td>
<td headers="all_play_w_prop" class="new_gt_row new_gt_right">44%</td>
<td headers="w_prop_d" class="new_gt_row new_gt_right" style="background-color: rgba(118,42,131,0.9); color: #FFFFFF;">−16%</td></tr>
<tr><td headers="team" class="new_gt_row new_gt_left">A</td>
<td headers="actual_w" class="new_gt_row new_gt_right">6</td>
<td headers="actual_l" class="new_gt_row new_gt_right">8</td>
<td headers="all_play_w" class="new_gt_row new_gt_right">73</td>
<td headers="all_play_l" class="new_gt_row new_gt_right">53</td>
<td headers="actual_w_prop" class="new_gt_row new_gt_right">43%</td>
<td headers="all_play_w_prop" class="new_gt_row new_gt_right">58%</td>
<td headers="w_prop_d" class="new_gt_row new_gt_right" style="background-color: rgba(127,58,140,0.9); color: #FFFFFF;">−15%</td></tr>
<tr><td headers="team" class="new_gt_row new_gt_left">F</td>
<td headers="actual_w" class="new_gt_row new_gt_right">4</td>
<td headers="actual_l" class="new_gt_row new_gt_right">10</td>
<td headers="all_play_w" class="new_gt_row new_gt_right">55</td>
<td headers="all_play_l" class="new_gt_row new_gt_right">71</td>
<td headers="actual_w_prop" class="new_gt_row new_gt_right">29%</td>
<td headers="all_play_w_prop" class="new_gt_row new_gt_right">44%</td>
<td headers="w_prop_d" class="new_gt_row new_gt_right" style="background-color: rgba(127,58,140,0.9); color: #FFFFFF;">−15%</td></tr>
<tr><td headers="team" class="new_gt_row new_gt_left">I</td>
<td headers="actual_w" class="new_gt_row new_gt_right">6</td>
<td headers="actual_l" class="new_gt_row new_gt_right">8</td>
<td headers="all_play_w" class="new_gt_row new_gt_right">60</td>
<td headers="all_play_l" class="new_gt_row new_gt_right">66</td>
<td headers="actual_w_prop" class="new_gt_row new_gt_right">43%</td>
<td headers="all_play_w_prop" class="new_gt_row new_gt_right">48%</td>
<td headers="w_prop_d" class="new_gt_row new_gt_right" style="background-color: rgba(233,215,234,0.9); color: #000000;">−5%</td></tr>
<tr><td headers="team" class="new_gt_row new_gt_left">H</td>
<td headers="actual_w" class="new_gt_row new_gt_right">7</td>
<td headers="actual_l" class="new_gt_row new_gt_right">7</td>
<td headers="all_play_w" class="new_gt_row new_gt_right">63</td>
<td headers="all_play_l" class="new_gt_row new_gt_right">63</td>
<td headers="actual_w_prop" class="new_gt_row new_gt_right">50%</td>
<td headers="all_play_w_prop" class="new_gt_row new_gt_right">50%</td>
<td headers="w_prop_d" class="new_gt_row new_gt_right" style="background-color: rgba(247,247,247,0.9); color: #000000;">0%</td></tr>
<tr><td headers="team" class="new_gt_row new_gt_left">C</td>
<td headers="actual_w" class="new_gt_row new_gt_right">9</td>
<td headers="actual_l" class="new_gt_row new_gt_right">5</td>
<td headers="all_play_w" class="new_gt_row new_gt_right">76</td>
<td headers="all_play_l" class="new_gt_row new_gt_right">50</td>
<td headers="actual_w_prop" class="new_gt_row new_gt_right">64%</td>
<td headers="all_play_w_prop" class="new_gt_row new_gt_right">60%</td>
<td headers="w_prop_d" class="new_gt_row new_gt_right" style="background-color: rgba(230,243,227,0.9); color: #000000;">4%</td></tr>
<tr><td headers="team" class="new_gt_row new_gt_left">J</td>
<td headers="actual_w" class="new_gt_row new_gt_right">7</td>
<td headers="actual_l" class="new_gt_row new_gt_right">7</td>
<td headers="all_play_w" class="new_gt_row new_gt_right">55</td>
<td headers="all_play_l" class="new_gt_row new_gt_right">71</td>
<td headers="actual_w_prop" class="new_gt_row new_gt_right">50%</td>
<td headers="all_play_w_prop" class="new_gt_row new_gt_right">44%</td>
<td headers="w_prop_d" class="new_gt_row new_gt_right" style="background-color: rgba(220,241,215,0.9); color: #000000;">6%</td></tr>
<tr><td headers="team" class="new_gt_row new_gt_left">E</td>
<td headers="actual_w" class="new_gt_row new_gt_right">9</td>
<td headers="actual_l" class="new_gt_row new_gt_right">5</td>
<td headers="all_play_w" class="new_gt_row new_gt_right">72</td>
<td headers="all_play_l" class="new_gt_row new_gt_right">54</td>
<td headers="actual_w_prop" class="new_gt_row new_gt_right">64%</td>
<td headers="all_play_w_prop" class="new_gt_row new_gt_right">57%</td>
<td headers="w_prop_d" class="new_gt_row new_gt_right" style="background-color: rgba(217,240,211,0.9); color: #000000;">7%</td></tr>
<tr><td headers="team" class="new_gt_row new_gt_left">D</td>
<td headers="actual_w" class="new_gt_row new_gt_right">8</td>
<td headers="actual_l" class="new_gt_row new_gt_right">6</td>
<td headers="all_play_w" class="new_gt_row new_gt_right">57</td>
<td headers="all_play_l" class="new_gt_row new_gt_right">69</td>
<td headers="actual_w_prop" class="new_gt_row new_gt_right">57%</td>
<td headers="all_play_w_prop" class="new_gt_row new_gt_right">45%</td>
<td headers="w_prop_d" class="new_gt_row new_gt_right" style="background-color: rgba(157,207,152,0.9); color: #000000;">12%</td></tr>
<tr><td headers="team" class="new_gt_row new_gt_left">B</td>
<td headers="actual_w" class="new_gt_row new_gt_right">10</td>
<td headers="actual_l" class="new_gt_row new_gt_right">4</td>
<td headers="all_play_w" class="new_gt_row new_gt_right">63</td>
<td headers="all_play_l" class="new_gt_row new_gt_right">63</td>
<td headers="actual_w_prop" class="new_gt_row new_gt_right">71%</td>
<td headers="all_play_w_prop" class="new_gt_row new_gt_right">50%</td>
<td headers="w_prop_d" class="new_gt_row new_gt_right" style="background-color: rgba(27,120,55,0.9); color: #FFFFFF;">21%</td></tr>
</tbody>

<tfoot class="new_gt_footnotes">
<tr>
<td class="new_gt_footnote" colspan="8"> Data from Tony's personal league.</td>
</tr>
</tfoot>
</table>
</div>
```
An 18% difference between my actual record and my all play record feels non-trivial. In fact, in comparing that level of under-performance to the prior seasons, I find that there were only 3 less fortunate outcomes-- -26% for team A in 2021, -23% for team E in 2019, and -21% for myself in 2020!

```{r}
#| label: all-play-all
#| include: false
total_all_play_h2h_gt <- compared_all_play_records |> 
  dplyr::transmute(
    team,
    season = as.character(season),
    w_prop_d
  ) |> 
  dplyr::bind_rows(
    compared_all_play_records |> 
      dplyr::group_by(team) |> 
      dplyr::summarize(
        dplyr::across(
          dplyr::matches('_(w|l)$'),
          sum
        )
      ) |> 
      dplyr::ungroup() |> 
      dplyr::transmute(
        team,
        season = 'Total',
        w_prop_d = (actual_w / (actual_w + actual_l)) - (all_play_w / (all_play_w + all_play_l))
      )
  ) |> 
  tidyr::pivot_wider(
    names_from = season,
    values_from = w_prop_d,
    names_sort = TRUE
  ) |> 
  dplyr::arrange(Total) |> 
  gt::gt() |> 
  gt::cols_label(
    team ~ 'Team'
  ) |> 
  .gt_theme_538_dark() |> 
  gt::cols_align(
    columns = team,
    align = 'left'
  ) |> 
  gt::fmt_percent(
    columns = -c(team),
    decimals = 0
  ) |> 
  .gt_zerocentered_brewer_col_numeric(
    columns = -c(team),
    palette = 'PRGn'
  ) |> 
  gt::tab_header(
    title = gt::md('Actual Win % - All Play Win %'),
    subtitle = 'Tony has been the second unluckiest since 2018.'
  ) |> 
  gt::tab_footnote(
    footnote = CAPTION_LABEL
  )

gt::gtsave(
  total_all_play_h2h_gt,
  filename = file.path(PROJ_DIR, 'total-all-play-h2h.png')
)

make_tbl_quarto_robust(total_all_play_h2h_gt) |> clipr::write_clip()
```

```{=html}
<div id="jduazwbmbu" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#jduazwbmbu table {
font-family: 'Titillium Web', system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
-webkit-font-smoothing: antialiased;
-moz-osx-font-smoothing: grayscale;
}

#jduazwbmbu thead, #jduazwbmbu tbody, #jduazwbmbu tfoot, #jduazwbmbu tr, #jduazwbmbu td, #jduazwbmbu th {
border-style: none;
}

#jduazwbmbu p {
margin: 0;
padding: 0;
}

#jduazwbmbu .new_gt_table {
display: table;
border-collapse: collapse;
line-height: normal;
margin-left: auto;
margin-right: auto;
color: #FFFFFF;
font-size: 16px;
font-weight: 400;
font-style: normal;
background-color: #222222;
width: auto;
border-top-style: none;
border-top-width: 3px;
border-top-color: #A8A8A8;
border-right-style: none;
border-right-width: 2px;
border-right-color: #222222;
border-bottom-style: none;
border-bottom-width: 2px;
border-bottom-color: #222222;
border-left-style: none;
border-left-width: 2px;
border-left-color: #222222;
}

#jduazwbmbu .new_gt_caption {
padding-top: 4px;
padding-bottom: 4px;
}

#jduazwbmbu .new_gt_title {
color: #FFFFFF;
font-size: 125%;
font-weight: initial;
padding-top: 4px;
padding-bottom: 4px;
padding-left: 5px;
padding-right: 5px;
border-bottom-color: #222222;
border-bottom-width: 0;
}

#jduazwbmbu .new_gt_subtitle {
color: #FFFFFF;
font-size: 85%;
font-weight: initial;
padding-top: 3px;
padding-bottom: 5px;
padding-left: 5px;
padding-right: 5px;
border-top-color: #222222;
border-top-width: 0;
}

#jduazwbmbu .new_gt_heading {
background-color: #222222;
text-align: left;
border-bottom-color: #222222;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
}

#jduazwbmbu .new_gt_bottom_border {
border-bottom-style: none;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
}

#jduazwbmbu .new_gt_col_headings {
border-top-style: none;
border-top-width: 2px;
border-top-color: #D3D3D3;
border-bottom-style: solid;
border-bottom-width: 3px;
border-bottom-color: #FFFFFF;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
}

#jduazwbmbu .new_gt_col_heading {
color: #FFFFFF;
background-color: #222222;
font-size: 100%;
font-weight: normal;
text-transform: inherit;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
vertical-align: bottom;
padding-top: 5px;
padding-bottom: 6px;
padding-left: 5px;
padding-right: 5px;
overflow-x: hidden;
}

#jduazwbmbu .new_gt_column_spanner_outer {
color: #FFFFFF;
background-color: #222222;
font-size: 100%;
font-weight: normal;
text-transform: inherit;
padding-top: 0;
padding-bottom: 0;
padding-left: 4px;
padding-right: 4px;
}

#jduazwbmbu .new_gt_column_spanner_outer:first-child {
padding-left: 0;
}

#jduazwbmbu .new_gt_column_spanner_outer:last-child {
padding-right: 0;
}

#jduazwbmbu .new_gt_column_spanner {
border-bottom-style: solid;
border-bottom-width: 3px;
border-bottom-color: #FFFFFF;
vertical-align: bottom;
padding-top: 5px;
padding-bottom: 5px;
overflow-x: hidden;
display: inline-block;
width: 100%;
}

#jduazwbmbu .new_gt_spanner_row {
border-bottom-style: hidden;
}

#jduazwbmbu .new_gt_group_heading {
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
color: #FFFFFF;
background-color: #222222;
font-size: 100%;
font-weight: initial;
text-transform: inherit;
border-top-style: none;
border-top-width: 2px;
border-top-color: #222222;
border-bottom-style: solid;
border-bottom-width: 1px;
border-bottom-color: #FFFFFF;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
vertical-align: middle;
text-align: left;
}

#jduazwbmbu .new_gt_empty_group_heading {
padding: 0.5px;
color: #FFFFFF;
background-color: #222222;
font-size: 100%;
font-weight: initial;
border-top-style: none;
border-top-width: 2px;
border-top-color: #222222;
border-bottom-style: solid;
border-bottom-width: 1px;
border-bottom-color: #FFFFFF;
vertical-align: middle;
}

#jduazwbmbu .new_gt_from_md > :first-child {
margin-top: 0;
}

#jduazwbmbu .new_gt_from_md > :last-child {
margin-bottom: 0;
}

#jduazwbmbu .new_gt_row {
padding-top: 7px;
padding-bottom: 7px;
padding-left: 5px;
padding-right: 5px;
margin: 10px;
border-top-style: solid;
border-top-width: 1px;
border-top-color: #D3D3D3;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
vertical-align: middle;
overflow-x: hidden;
}

#jduazwbmbu .new_gt_stub {
color: #FFFFFF;
background-color: #222222;
font-size: 100%;
font-weight: initial;
text-transform: inherit;
border-right-style: solid;
border-right-width: 0px;
border-right-color: #FFFFFF;
padding-left: 5px;
padding-right: 5px;
}

#jduazwbmbu .new_gt_stub_row_group {
color: #FFFFFF;
background-color: #222222;
font-size: 100%;
font-weight: initial;
text-transform: inherit;
border-right-style: solid;
border-right-width: 2px;
border-right-color: #D3D3D3;
padding-left: 5px;
padding-right: 5px;
vertical-align: top;
}

#jduazwbmbu .new_gt_row_group_first td {
border-top-width: 2px;
}

#jduazwbmbu .new_gt_row_group_first th {
border-top-width: 2px;
}

#jduazwbmbu .new_gt_summary_row {
color: #FFFFFF;
background-color: #222222;
text-transform: inherit;
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
}

#jduazwbmbu .new_gt_first_summary_row {
border-top-style: solid;
border-top-color: #D3D3D3;
}

#jduazwbmbu .new_gt_first_summary_row.thick {
border-top-width: 2px;
}

#jduazwbmbu .new_gt_last_summary_row {
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
}

#jduazwbmbu .new_gt_grand_summary_row {
color: #FFFFFF;
background-color: #222222;
text-transform: inherit;
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
}

#jduazwbmbu .new_gt_first_grand_summary_row {
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
border-top-style: double;
border-top-width: 6px;
border-top-color: #D3D3D3;
}

#jduazwbmbu .new_gt_last_grand_summary_row_top {
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
border-bottom-style: double;
border-bottom-width: 6px;
border-bottom-color: #D3D3D3;
}

#jduazwbmbu .new_gt_striped {
background-color: rgba(128, 128, 128, 0.05);
}

#jduazwbmbu .new_gt_table_body {
border-top-style: none;
border-top-width: 2px;
border-top-color: #D3D3D3;
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #222222;
}

#jduazwbmbu .new_gt_footnotes {
color: #FFFFFF;
background-color: #222222;
border-bottom-style: none;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
border-left-style: none;
border-left-width: 2px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 2px;
border-right-color: #D3D3D3;
}

#jduazwbmbu .new_gt_footnote {
margin: 0px;
font-size: 90%;
padding-top: 4px;
padding-bottom: 4px;
padding-left: 5px;
padding-right: 5px;
}

#jduazwbmbu .new_gt_sourcenotes {
color: #FFFFFF;
background-color: #222222;
border-bottom-style: none;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
border-left-style: none;
border-left-width: 2px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 2px;
border-right-color: #D3D3D3;
}

#jduazwbmbu .new_gt_sourcenote {
font-size: 12px;
padding-top: 4px;
padding-bottom: 4px;
padding-left: 5px;
padding-right: 5px;
}

#jduazwbmbu .new_gt_left {
text-align: left;
}

#jduazwbmbu .new_gt_center {
text-align: center;
}

#jduazwbmbu .new_gt_right {
text-align: right;
font-variant-numeric: tabular-nums;
}

#jduazwbmbu .new_gt_font_normal {
font-weight: normal;
}

#jduazwbmbu .new_gt_font_bold {
font-weight: bold;
}

#jduazwbmbu .new_gt_font_italic {
font-style: italic;
}

#jduazwbmbu .new_gt_super {
font-size: 65%;
}

#jduazwbmbu .new_gt_footnote_marks {
font-size: 75%;
vertical-align: 0.4em;
position: initial;
}

#jduazwbmbu .new_gt_asterisk {
font-size: 100%;
vertical-align: 0;
}

#jduazwbmbu .new_gt_indent_1 {
text-indent: 5px;
}

#jduazwbmbu .new_gt_indent_2 {
text-indent: 10px;
}

#jduazwbmbu .new_gt_indent_3 {
text-indent: 15px;
}

#jduazwbmbu .new_gt_indent_4 {
text-indent: 20px;
}

#jduazwbmbu .new_gt_indent_5 {
text-indent: 25px;
}

#jduazwbmbu tbody tr:last-child {
border-bottom: 2px solid #ffffff00;
}
</style>
<table class="new_gt_table">
<thead>
<tr class="new_gt_heading">
<td colspan="8" class="new_gt_heading new_gt_title new_gt_font_normal" style="font-family: 'Titillium Web'; font-weight: 700;">Actual Win % - All Play Win %</td>
</tr>
<tr class="new_gt_heading">
<td colspan="8" class="new_gt_heading new_gt_subtitle new_gt_font_normal new_gt_bottom_border" style="font-family: 'Titillium Web'; font-weight: 400;">Tony has been the second unluckiest since 2018.</td>
</tr>
<tr class="new_gt_col_headings">
<th class="new_gt_col_heading new_gt_columns_bottom_border new_gt_left" rowspan="1" colspan="1" style="color: #FFFFFF; font-family: 'Titillium Web'; text-transform: uppercase; font-size: 14px; vertical-align: bottom; font-weight: 200; border-top-width: 0px; border-top-style: solid; border-top-color: #222222;" scope="col" id="Team">Team</th>
<th class="new_gt_col_heading new_gt_columns_bottom_border new_gt_right" rowspan="1" colspan="1" style="color: #FFFFFF; font-family: 'Titillium Web'; text-transform: uppercase; font-size: 14px; vertical-align: bottom; font-weight: 200; border-top-width: 0px; border-top-style: solid; border-top-color: #222222;" scope="col" id="2018">2018</th>
<th class="new_gt_col_heading new_gt_columns_bottom_border new_gt_right" rowspan="1" colspan="1" style="color: #FFFFFF; font-family: 'Titillium Web'; text-transform: uppercase; font-size: 14px; vertical-align: bottom; font-weight: 200; border-top-width: 0px; border-top-style: solid; border-top-color: #222222;" scope="col" id="2019">2019</th>
<th class="new_gt_col_heading new_gt_columns_bottom_border new_gt_right" rowspan="1" colspan="1" style="color: #FFFFFF; font-family: 'Titillium Web'; text-transform: uppercase; font-size: 14px; vertical-align: bottom; font-weight: 200; border-top-width: 0px; border-top-style: solid; border-top-color: #222222;" scope="col" id="2020">2020</th>
<th class="new_gt_col_heading new_gt_columns_bottom_border new_gt_right" rowspan="1" colspan="1" style="color: #FFFFFF; font-family: 'Titillium Web'; text-transform: uppercase; font-size: 14px; vertical-align: bottom; font-weight: 200; border-top-width: 0px; border-top-style: solid; border-top-color: #222222;" scope="col" id="2021">2021</th>
<th class="new_gt_col_heading new_gt_columns_bottom_border new_gt_right" rowspan="1" colspan="1" style="color: #FFFFFF; font-family: 'Titillium Web'; text-transform: uppercase; font-size: 14px; vertical-align: bottom; font-weight: 200; border-top-width: 0px; border-top-style: solid; border-top-color: #222222;" scope="col" id="2022">2022</th>
<th class="new_gt_col_heading new_gt_columns_bottom_border new_gt_right" rowspan="1" colspan="1" style="color: #FFFFFF; font-family: 'Titillium Web'; text-transform: uppercase; font-size: 14px; vertical-align: bottom; font-weight: 200; border-top-width: 0px; border-top-style: solid; border-top-color: #222222;" scope="col" id="2023">2023</th>
<th class="new_gt_col_heading new_gt_columns_bottom_border new_gt_right" rowspan="1" colspan="1" style="color: #FFFFFF; font-family: 'Titillium Web'; text-transform: uppercase; font-size: 14px; vertical-align: bottom; font-weight: 200; border-top-width: 0px; border-top-style: solid; border-top-color: #222222;" scope="col" id="Total">Total</th>
</tr>
</thead>
<tbody class="new_gt_table_body">
<tr><td headers="team" class="new_gt_row new_gt_left">A</td>
<td headers="2018" class="new_gt_row new_gt_right" style="background-color: rgba(141,83,156,0.9); color: #FFFFFF;">−12%</td>
<td headers="2019" class="new_gt_row new_gt_right" style="background-color: rgba(110,178,110,0.9); color: #FFFFFF;">15%</td>
<td headers="2020" class="new_gt_row new_gt_right" style="background-color: rgba(241,233,241,0.9); color: #000000;">−4%</td>
<td headers="2021" class="new_gt_row new_gt_right" style="background-color: rgba(118,42,131,0.9); color: #FFFFFF;">−25%</td>
<td headers="2022" class="new_gt_row new_gt_right" style="background-color: rgba(215,239,209,0.9); color: #000000;">7%</td>
<td headers="2023" class="new_gt_row new_gt_right" style="background-color: rgba(127,58,140,0.9); color: #FFFFFF;">−15%</td>
<td headers="Total" class="new_gt_row new_gt_right" style="background-color: rgba(118,42,131,0.9); color: #FFFFFF;">−6%</td></tr>
<tr><td headers="team" class="new_gt_row new_gt_left">Tony</td>
<td headers="2018" class="new_gt_row new_gt_right" style="background-color: rgba(237,245,235,0.9); color: #000000;">2%</td>
<td headers="2019" class="new_gt_row new_gt_right" style="background-color: rgba(218,240,213,0.9); color: #000000;">6%</td>
<td headers="2020" class="new_gt_row new_gt_right" style="background-color: rgba(118,42,131,0.9); color: #FFFFFF;">−29%</td>
<td headers="2021" class="new_gt_row new_gt_right" style="background-color: rgba(238,227,239,0.9); color: #000000;">−5%</td>
<td headers="2022" class="new_gt_row new_gt_right" style="background-color: rgba(227,242,223,0.9); color: #000000;">5%</td>
<td headers="2023" class="new_gt_row new_gt_right" style="background-color: rgba(118,42,131,0.9); color: #FFFFFF;">−16%</td>
<td headers="Total" class="new_gt_row new_gt_right" style="background-color: rgba(130,64,144,0.9); color: #FFFFFF;">−6%</td></tr>
<tr><td headers="team" class="new_gt_row new_gt_left">C</td>
<td headers="2018" class="new_gt_row new_gt_right" style="background-color: rgba(202,232,196,0.9); color: #000000;">6%</td>
<td headers="2019" class="new_gt_row new_gt_right" style="background-color: rgba(141,82,156,0.9); color: #FFFFFF;">−19%</td>
<td headers="2020" class="new_gt_row new_gt_right" style="background-color: rgba(189,159,205,0.9); color: #000000;">−17%</td>
<td headers="2021" class="new_gt_row new_gt_right" style="background-color: rgba(244,240,244,0.9); color: #000000;">−2%</td>
<td headers="2022" class="new_gt_row new_gt_right" style="background-color: rgba(224,242,219,0.9); color: #000000;">6%</td>
<td headers="2023" class="new_gt_row new_gt_right" style="background-color: rgba(230,243,227,0.9); color: #000000;">4%</td>
<td headers="Total" class="new_gt_row new_gt_right" style="background-color: rgba(209,183,217,0.9); color: #000000;">−3%</td></tr>
<tr><td headers="team" class="new_gt_row new_gt_left">I</td>
<td headers="2018" class="new_gt_row new_gt_right" style="background-color: rgba(241,233,241,0.9); color: #000000;">−2%</td>
<td headers="2019" class="new_gt_row new_gt_right" style="background-color: rgba(214,190,221,0.9); color: #000000;">−9%</td>
<td headers="2020" class="new_gt_row new_gt_right" style="background-color: rgba(172,216,166,0.9); color: #000000;">6%</td>
<td headers="2021" class="new_gt_row new_gt_right" style="background-color: rgba(213,189,220,0.9); color: #000000;">−11%</td>
<td headers="2022" class="new_gt_row new_gt_right" style="background-color: rgba(234,244,231,0.9); color: #000000;">3%</td>
<td headers="2023" class="new_gt_row new_gt_right" style="background-color: rgba(233,215,234,0.9); color: #000000;">−5%</td>
<td headers="Total" class="new_gt_row new_gt_right" style="background-color: rgba(209,183,217,0.9); color: #000000;">−3%</td></tr>
<tr><td headers="team" class="new_gt_row new_gt_left">F</td>
<td headers="2018" class="new_gt_row new_gt_right" style="background-color: rgba(237,245,235,0.9); color: #000000;">2%</td>
<td headers="2019" class="new_gt_row new_gt_right" style="background-color: rgba(218,240,213,0.9); color: #000000;">6%</td>
<td headers="2020" class="new_gt_row new_gt_right" style="background-color: rgba(134,195,129,0.9); color: #000000;">8%</td>
<td headers="2021" class="new_gt_row new_gt_right" style="background-color: rgba(50,133,67,0.9); color: #FFFFFF;">12%</td>
<td headers="2022" class="new_gt_row new_gt_right" style="background-color: rgba(238,226,238,0.9); color: #000000;">−4%</td>
<td headers="2023" class="new_gt_row new_gt_right" style="background-color: rgba(127,58,140,0.9); color: #FFFFFF;">−15%</td>
<td headers="Total" class="new_gt_row new_gt_right" style="background-color: rgba(228,243,224,0.9); color: #000000;">1%</td></tr>
<tr><td headers="team" class="new_gt_row new_gt_left">J</td>
<td headers="2018" class="new_gt_row new_gt_right" style="background-color: rgba(118,42,131,0.9); color: #FFFFFF;">−14%</td>
<td headers="2019" class="new_gt_row new_gt_right" style="background-color: rgba(27,120,55,0.9); color: #FFFFFF;">20%</td>
<td headers="2020" class="new_gt_row new_gt_right" style="background-color: rgba(192,226,185,0.9); color: #000000;">6%</td>
<td headers="2021" class="new_gt_row new_gt_right" style="background-color: rgba(172,216,166,0.9); color: #000000;">6%</td>
<td headers="2022" class="new_gt_row new_gt_right" style="background-color: rgba(161,117,179,0.9); color: #FFFFFF;">−15%</td>
<td headers="2023" class="new_gt_row new_gt_right" style="background-color: rgba(220,241,215,0.9); color: #000000;">6%</td>
<td headers="Total" class="new_gt_row new_gt_right" style="background-color: rgba(226,242,222,0.9); color: #000000;">1%</td></tr>
<tr><td headers="team" class="new_gt_row new_gt_left">D</td>
<td headers="2018" class="new_gt_row new_gt_right" style="background-color: rgba(27,120,55,0.9); color: #FFFFFF;">17%</td>
<td headers="2019" class="new_gt_row new_gt_right" style="background-color: rgba(177,144,197,0.9); color: #FFFFFF;">−14%</td>
<td headers="2020" class="new_gt_row new_gt_right" style="background-color: rgba(27,120,55,0.9); color: #FFFFFF;">13%</td>
<td headers="2021" class="new_gt_row new_gt_right" style="background-color: rgba(225,242,220,0.9); color: #000000;">3%</td>
<td headers="2022" class="new_gt_row new_gt_right" style="background-color: rgba(118,42,131,0.9); color: #FFFFFF;">−20%</td>
<td headers="2023" class="new_gt_row new_gt_right" style="background-color: rgba(157,207,152,0.9); color: #000000;">12%</td>
<td headers="Total" class="new_gt_row new_gt_right" style="background-color: rgba(220,241,215,0.9); color: #000000;">2%</td></tr>
<tr><td headers="team" class="new_gt_row new_gt_left">B</td>
<td headers="2018" class="new_gt_row new_gt_right" style="background-color: rgba(227,242,223,0.9); color: #000000;">4%</td>
<td headers="2019" class="new_gt_row new_gt_right" style="background-color: rgba(235,244,232,0.9); color: #000000;">3%</td>
<td headers="2020" class="new_gt_row new_gt_right" style="background-color: rgba(241,246,239,0.9); color: #000000;">1%</td>
<td headers="2021" class="new_gt_row new_gt_right" style="background-color: rgba(243,237,243,0.9); color: #000000;">−2%</td>
<td headers="2022" class="new_gt_row new_gt_right" style="background-color: rgba(174,140,194,0.9); color: #FFFFFF;">−13%</td>
<td headers="2023" class="new_gt_row new_gt_right" style="background-color: rgba(27,120,55,0.9); color: #FFFFFF;">21%</td>
<td headers="Total" class="new_gt_row new_gt_right" style="background-color: rgba(213,238,207,0.9); color: #000000;">2%</td></tr>
<tr><td headers="team" class="new_gt_row new_gt_left">E</td>
<td headers="2018" class="new_gt_row new_gt_right" style="background-color: rgba(142,199,137,0.9); color: #000000;">10%</td>
<td headers="2019" class="new_gt_row new_gt_right" style="background-color: rgba(118,42,131,0.9); color: #FFFFFF;">−21%</td>
<td headers="2020" class="new_gt_row new_gt_right" style="background-color: rgba(53,135,69,0.9); color: #FFFFFF;">12%</td>
<td headers="2021" class="new_gt_row new_gt_right" style="background-color: rgba(27,120,55,0.9); color: #FFFFFF;">13%</td>
<td headers="2022" class="new_gt_row new_gt_right" style="background-color: rgba(177,218,171,0.9); color: #000000;">10%</td>
<td headers="2023" class="new_gt_row new_gt_right" style="background-color: rgba(217,240,211,0.9); color: #000000;">7%</td>
<td headers="Total" class="new_gt_row new_gt_right" style="background-color: rgba(59,139,73,0.9); color: #FFFFFF;">6%</td></tr>
<tr><td headers="team" class="new_gt_row new_gt_left">H</td>
<td headers="2018" class="new_gt_row new_gt_right" style="background-color: rgba(130,63,144,0.9); color: #FFFFFF;">−13%</td>
<td headers="2019" class="new_gt_row new_gt_right" style="background-color: rgba(148,202,143,0.9); color: #000000;">12%</td>
<td headers="2020" class="new_gt_row new_gt_right" style="background-color: rgba(228,243,224,0.9); color: #000000;">3%</td>
<td headers="2021" class="new_gt_row new_gt_right" style="background-color: rgba(69,146,80,0.9); color: #FFFFFF;">11%</td>
<td headers="2022" class="new_gt_row new_gt_right" style="background-color: rgba(27,120,55,0.9); color: #FFFFFF;">21%</td>
<td headers="2023" class="new_gt_row new_gt_right" style="background-color: rgba(247,247,247,0.9); color: #000000;">0%</td>
<td headers="Total" class="new_gt_row new_gt_right" style="background-color: rgba(27,120,55,0.9); color: #FFFFFF;">6%</td></tr>
</tbody>

<tfoot class="new_gt_footnotes">
<tr>
<td class="new_gt_footnote" colspan="8"> Data from Tony's personal league.</td>
</tr>
</tfoot>
</table>
</div>
```
Teams E and H have been fairly fortunate, only facing one season in the past 6 where they ended up with a record that was worse than their all play record.

```{r}
#| label: compared-all-play-save
qs::qsave(compared_all_play_records, file.path(PROJ_DIR, 'compared_all_play_records.qs'))
```

```{r}
#| label: compared-all-play-read
compared_all_play_records <- qs::read(file.path(PROJ_DIR, 'compared_all_play_records.qs'))
```

```{r}
#| label: all-play-quantiles
round(quantile(compared_all_play_records$w_prop_d, c(0.975, 0.025)), 3)
#>  97.5%   2.5% 
#>  0.209 -0.234
```

The top and bottom 2.5th percentiles of season-long actual win % minus all play win % are about +21% and -23% respectively. This translates to about ±3 wins in leagues with a 14 game season. So, the "back-of-the-napkin" take-away here is that you could be winning or losing 3 more games due to your schedule, in the most extreme cases.

Overall, it's interesting to see that the under- and over-performance doesn't quite level out even over the course of 6 seasons. (How has Team H consistently gotten favorable schedules?!) Surely we'd see this even out over more and more seasons, but it's noteworthy that even 6 seasons may not be sufficient to achieve long-run schedule fairness.

### Actual vs. projected points

```{r}
#| label: projected-scores
league_avg_projected_scores <- team_scores |> 
  dplyr::group_by(season) |> 
  dplyr::summarize(
    mean_d = mean((user_score - user_projected_score) / n_weeks_in_matchup, na.rm = TRUE),
    sd_d = sd((user_score - user_projected_score) / n_weeks_in_matchup, na.rm = TRUE),
    n_games = sum(n_weeks_in_matchup),
    dplyr::across(
      dplyr::matches('user.*score'),
      \(.x) sum(.x, na.rm = TRUE)
    )
  ) |> 
  dplyr::ungroup() |> 
  dplyr::mutate(
    user_d = user_score - user_projected_score,
    user_d_per_game = user_d / n_games
  )

season_points_above_projected <- team_scores |> 
  dplyr::group_by(season, team) |> 
  dplyr::summarize(
    n_games = sum(n_weeks_in_matchup),
    dplyr::across(
      dplyr::ends_with('score'),
      \(.x) sum(.x, na.rm = TRUE)
    )
  ) |> 
  dplyr::ungroup() |> 
  dplyr::mutate(
    user_d = user_score - user_projected_score,
    opponent_d = opponent_score - opponent_projected_score,
    user_d_per_game = user_d / n_games,
    opponent_d_per_game = opponent_d / n_games,
    total_d_per_game = user_d_per_game - opponent_d_per_game
  ) |> 
  dplyr::group_by(season) |> 
  dplyr::mutate(
    projected_underperformance_rank = dplyr::row_number(user_d_per_game - opponent_d_per_game)
  ) |> 
  dplyr::ungroup() |> 
  dplyr::arrange(season, projected_underperformance_rank)

latest_season_points_above_projected <- season_points_above_projected |> 
  dplyr::filter(season == LATEST_SEASON) 

tony_position <- latest_season_points_above_projected |> 
  dplyr::filter(team == 'Tony') |> 
  dplyr::pull(projected_underperformance_rank)

latest_season_points_above_projected_gt <- latest_season_points_above_projected |> 
  dplyr::select(
    team,
    user_d_per_game,
    opponent_d_per_game,
    total_d_per_game
  ) |> 
  gt::gt() |> 
  gt::cols_label(
    team ~ 'Team',
    user_d_per_game ~ 'Team',
    opponent_d_per_game ~ 'Opponent',
    total_d_per_game = gt::html('Team -<br/>Opponent')
  ) |> 
  .gt_theme_538_dark() |> 
  gt::cols_align(
    columns = team,
    align = 'left'
  ) |> 
  gt::fmt_number(
    columns = -c(team),
    decimals = 1
  ) |> 
  .gt_zerocentered_brewer_col_numeric(
    columns = -c(team),
    palette = 'BrBG'
  ) |> 
  gt::tab_header(
    title = glue::glue('{LATEST_SEASON} Avg. Weekly Actual - Projected Points'),
    subtitle = glue::glue('Tony was the {scales::ordinal(tony_position)} unluckiest this season.')
  ) |> 
  gt::tab_footnote(
    footnote = CAPTION_LABEL
  )

gt::gtsave(
  latest_season_points_above_projected_gt,
  filename = file.path(PROJ_DIR, 'latest-points-above-projected.png')
)
make_tbl_quarto_robust(latest_season_points_above_projected_gt) |> clipr::write_clip()
```

```{=html}
<div id="ywurrtmqnx" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#ywurrtmqnx table {
font-family: 'Titillium Web', system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
-webkit-font-smoothing: antialiased;
-moz-osx-font-smoothing: grayscale;
}

#ywurrtmqnx thead, #ywurrtmqnx tbody, #ywurrtmqnx tfoot, #ywurrtmqnx tr, #ywurrtmqnx td, #ywurrtmqnx th {
border-style: none;
}

#ywurrtmqnx p {
margin: 0;
padding: 0;
}

#ywurrtmqnx .new_gt_table {
display: table;
border-collapse: collapse;
line-height: normal;
margin-left: auto;
margin-right: auto;
color: #FFFFFF;
font-size: 16px;
font-weight: 400;
font-style: normal;
background-color: #222222;
width: auto;
border-top-style: none;
border-top-width: 3px;
border-top-color: #A8A8A8;
border-right-style: none;
border-right-width: 2px;
border-right-color: #222222;
border-bottom-style: none;
border-bottom-width: 2px;
border-bottom-color: #222222;
border-left-style: none;
border-left-width: 2px;
border-left-color: #222222;
}

#ywurrtmqnx .new_gt_caption {
padding-top: 4px;
padding-bottom: 4px;
}

#ywurrtmqnx .new_gt_title {
color: #FFFFFF;
font-size: 125%;
font-weight: initial;
padding-top: 4px;
padding-bottom: 4px;
padding-left: 5px;
padding-right: 5px;
border-bottom-color: #222222;
border-bottom-width: 0;
}

#ywurrtmqnx .new_gt_subtitle {
color: #FFFFFF;
font-size: 85%;
font-weight: initial;
padding-top: 3px;
padding-bottom: 5px;
padding-left: 5px;
padding-right: 5px;
border-top-color: #222222;
border-top-width: 0;
}

#ywurrtmqnx .new_gt_heading {
background-color: #222222;
text-align: left;
border-bottom-color: #222222;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
}

#ywurrtmqnx .new_gt_bottom_border {
border-bottom-style: none;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
}

#ywurrtmqnx .new_gt_col_headings {
border-top-style: none;
border-top-width: 2px;
border-top-color: #D3D3D3;
border-bottom-style: solid;
border-bottom-width: 3px;
border-bottom-color: #FFFFFF;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
}

#ywurrtmqnx .new_gt_col_heading {
color: #FFFFFF;
background-color: #222222;
font-size: 100%;
font-weight: normal;
text-transform: inherit;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
vertical-align: bottom;
padding-top: 5px;
padding-bottom: 6px;
padding-left: 5px;
padding-right: 5px;
overflow-x: hidden;
}

#ywurrtmqnx .new_gt_column_spanner_outer {
color: #FFFFFF;
background-color: #222222;
font-size: 100%;
font-weight: normal;
text-transform: inherit;
padding-top: 0;
padding-bottom: 0;
padding-left: 4px;
padding-right: 4px;
}

#ywurrtmqnx .new_gt_column_spanner_outer:first-child {
padding-left: 0;
}

#ywurrtmqnx .new_gt_column_spanner_outer:last-child {
padding-right: 0;
}

#ywurrtmqnx .new_gt_column_spanner {
border-bottom-style: solid;
border-bottom-width: 3px;
border-bottom-color: #FFFFFF;
vertical-align: bottom;
padding-top: 5px;
padding-bottom: 5px;
overflow-x: hidden;
display: inline-block;
width: 100%;
}

#ywurrtmqnx .new_gt_spanner_row {
border-bottom-style: hidden;
}

#ywurrtmqnx .new_gt_group_heading {
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
color: #FFFFFF;
background-color: #222222;
font-size: 100%;
font-weight: initial;
text-transform: inherit;
border-top-style: none;
border-top-width: 2px;
border-top-color: #222222;
border-bottom-style: solid;
border-bottom-width: 1px;
border-bottom-color: #FFFFFF;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
vertical-align: middle;
text-align: left;
}

#ywurrtmqnx .new_gt_empty_group_heading {
padding: 0.5px;
color: #FFFFFF;
background-color: #222222;
font-size: 100%;
font-weight: initial;
border-top-style: none;
border-top-width: 2px;
border-top-color: #222222;
border-bottom-style: solid;
border-bottom-width: 1px;
border-bottom-color: #FFFFFF;
vertical-align: middle;
}

#ywurrtmqnx .new_gt_from_md > :first-child {
margin-top: 0;
}

#ywurrtmqnx .new_gt_from_md > :last-child {
margin-bottom: 0;
}

#ywurrtmqnx .new_gt_row {
padding-top: 7px;
padding-bottom: 7px;
padding-left: 5px;
padding-right: 5px;
margin: 10px;
border-top-style: solid;
border-top-width: 1px;
border-top-color: #D3D3D3;
border-left-style: none;
border-left-width: 1px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 1px;
border-right-color: #D3D3D3;
vertical-align: middle;
overflow-x: hidden;
}

#ywurrtmqnx .new_gt_stub {
color: #FFFFFF;
background-color: #222222;
font-size: 100%;
font-weight: initial;
text-transform: inherit;
border-right-style: solid;
border-right-width: 0px;
border-right-color: #FFFFFF;
padding-left: 5px;
padding-right: 5px;
}

#ywurrtmqnx .new_gt_stub_row_group {
color: #FFFFFF;
background-color: #222222;
font-size: 100%;
font-weight: initial;
text-transform: inherit;
border-right-style: solid;
border-right-width: 2px;
border-right-color: #D3D3D3;
padding-left: 5px;
padding-right: 5px;
vertical-align: top;
}

#ywurrtmqnx .new_gt_row_group_first td {
border-top-width: 2px;
}

#ywurrtmqnx .new_gt_row_group_first th {
border-top-width: 2px;
}

#ywurrtmqnx .new_gt_summary_row {
color: #FFFFFF;
background-color: #222222;
text-transform: inherit;
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
}

#ywurrtmqnx .new_gt_first_summary_row {
border-top-style: solid;
border-top-color: #D3D3D3;
}

#ywurrtmqnx .new_gt_first_summary_row.thick {
border-top-width: 2px;
}

#ywurrtmqnx .new_gt_last_summary_row {
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
}

#ywurrtmqnx .new_gt_grand_summary_row {
color: #FFFFFF;
background-color: #222222;
text-transform: inherit;
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
}

#ywurrtmqnx .new_gt_first_grand_summary_row {
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
border-top-style: double;
border-top-width: 6px;
border-top-color: #D3D3D3;
}

#ywurrtmqnx .new_gt_last_grand_summary_row_top {
padding-top: 8px;
padding-bottom: 8px;
padding-left: 5px;
padding-right: 5px;
border-bottom-style: double;
border-bottom-width: 6px;
border-bottom-color: #D3D3D3;
}

#ywurrtmqnx .new_gt_striped {
background-color: rgba(128, 128, 128, 0.05);
}

#ywurrtmqnx .new_gt_table_body {
border-top-style: none;
border-top-width: 2px;
border-top-color: #D3D3D3;
border-bottom-style: solid;
border-bottom-width: 2px;
border-bottom-color: #222222;
}

#ywurrtmqnx .new_gt_footnotes {
color: #FFFFFF;
background-color: #222222;
border-bottom-style: none;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
border-left-style: none;
border-left-width: 2px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 2px;
border-right-color: #D3D3D3;
}

#ywurrtmqnx .new_gt_footnote {
margin: 0px;
font-size: 90%;
padding-top: 4px;
padding-bottom: 4px;
padding-left: 5px;
padding-right: 5px;
}

#ywurrtmqnx .new_gt_sourcenotes {
color: #FFFFFF;
background-color: #222222;
border-bottom-style: none;
border-bottom-width: 2px;
border-bottom-color: #D3D3D3;
border-left-style: none;
border-left-width: 2px;
border-left-color: #D3D3D3;
border-right-style: none;
border-right-width: 2px;
border-right-color: #D3D3D3;
}

#ywurrtmqnx .new_gt_sourcenote {
font-size: 12px;
padding-top: 4px;
padding-bottom: 4px;
padding-left: 5px;
padding-right: 5px;
}

#ywurrtmqnx .new_gt_left {
text-align: left;
}

#ywurrtmqnx .new_gt_center {
text-align: center;
}

#ywurrtmqnx .new_gt_right {
text-align: right;
font-variant-numeric: tabular-nums;
}

#ywurrtmqnx .new_gt_font_normal {
font-weight: normal;
}

#ywurrtmqnx .new_gt_font_bold {
font-weight: bold;
}

#ywurrtmqnx .new_gt_font_italic {
font-style: italic;
}

#ywurrtmqnx .new_gt_super {
font-size: 65%;
}

#ywurrtmqnx .new_gt_footnote_marks {
font-size: 75%;
vertical-align: 0.4em;
position: initial;
}

#ywurrtmqnx .new_gt_asterisk {
font-size: 100%;
vertical-align: 0;
}

#ywurrtmqnx .new_gt_indent_1 {
text-indent: 5px;
}

#ywurrtmqnx .new_gt_indent_2 {
text-indent: 10px;
}

#ywurrtmqnx .new_gt_indent_3 {
text-indent: 15px;
}

#ywurrtmqnx .new_gt_indent_4 {
text-indent: 20px;
}

#ywurrtmqnx .new_gt_indent_5 {
text-indent: 25px;
}

#ywurrtmqnx tbody tr:last-child {
border-bottom: 2px solid #ffffff00;
}
</style>
<table class="new_gt_table">
<thead>
<tr class="new_gt_heading">
<td colspan="4" class="new_gt_heading new_gt_title new_gt_font_normal" style="font-family: 'Titillium Web'; font-weight: 700;">2023 Avg. Weekly Actual - Projected Points</td>
</tr>
<tr class="new_gt_heading">
<td colspan="4" class="new_gt_heading new_gt_subtitle new_gt_font_normal new_gt_bottom_border" style="font-family: 'Titillium Web'; font-weight: 400;">Tony was the 3rd unluckiest this season.</td>
</tr>
<tr class="new_gt_col_headings">
<th class="new_gt_col_heading new_gt_columns_bottom_border new_gt_left" rowspan="1" colspan="1" style="color: #FFFFFF; font-family: 'Titillium Web'; text-transform: uppercase; font-size: 14px; vertical-align: bottom; font-weight: 200; border-top-width: 0px; border-top-style: solid; border-top-color: #222222;" scope="col" id="Team">Team</th>
<th class="new_gt_col_heading new_gt_columns_bottom_border new_gt_right" rowspan="1" colspan="1" style="color: #FFFFFF; font-family: 'Titillium Web'; text-transform: uppercase; font-size: 14px; vertical-align: bottom; font-weight: 200; border-top-width: 0px; border-top-style: solid; border-top-color: #222222;" scope="col" id="Team">Team</th>
<th class="new_gt_col_heading new_gt_columns_bottom_border new_gt_right" rowspan="1" colspan="1" style="color: #FFFFFF; font-family: 'Titillium Web'; text-transform: uppercase; font-size: 14px; vertical-align: bottom; font-weight: 200; border-top-width: 0px; border-top-style: solid; border-top-color: #222222;" scope="col" id="Opponent">Opponent</th>
<th class="new_gt_col_heading new_gt_columns_bottom_border new_gt_right" rowspan="1" colspan="1" style="color: #FFFFFF; font-family: 'Titillium Web'; text-transform: uppercase; font-size: 14px; vertical-align: bottom; font-weight: 200; border-top-width: 0px; border-top-style: solid; border-top-color: #222222;" scope="col" id="Team -&lt;br/&gt;Opponent">Team -<br/>Opponent</th>
</tr>
</thead>
<tbody class="new_gt_table_body">
<tr><td headers="team" class="new_gt_row new_gt_left">I</td>
<td headers="user_d_per_game" class="new_gt_row new_gt_right" style="background-color: rgba(140,81,10,0.9); color: #FFFFFF;">−11.1</td>
<td headers="opponent_d_per_game" class="new_gt_row new_gt_right" style="background-color: rgba(123,195,188,0.9); color: #000000;">4.7</td>
<td headers="total_d_per_game" class="new_gt_row new_gt_right" style="background-color: rgba(140,81,10,0.9); color: #FFFFFF;">−15.8</td></tr>
<tr><td headers="team" class="new_gt_row new_gt_left">F</td>
<td headers="user_d_per_game" class="new_gt_row new_gt_right" style="background-color: rgba(231,203,143,0.9); color: #000000;">−5.7</td>
<td headers="opponent_d_per_game" class="new_gt_row new_gt_right" style="background-color: rgba(64,152,144,0.9); color: #FFFFFF;">6.4</td>
<td headers="total_d_per_game" class="new_gt_row new_gt_right" style="background-color: rgba(193,148,74,0.9); color: #FFFFFF;">−12.1</td></tr>
<tr><td headers="team" class="new_gt_row new_gt_left">Tony</td>
<td headers="user_d_per_game" class="new_gt_row new_gt_right" style="background-color: rgba(247,236,208,0.9); color: #000000;">−2.8</td>
<td headers="opponent_d_per_game" class="new_gt_row new_gt_right" style="background-color: rgba(1,102,94,0.9); color: #FFFFFF;">8.2</td>
<td headers="total_d_per_game" class="new_gt_row new_gt_right" style="background-color: rgba(210,170,93,0.9); color: #000000;">−11.0</td></tr>
<tr><td headers="team" class="new_gt_row new_gt_left">A</td>
<td headers="user_d_per_game" class="new_gt_row new_gt_right" style="background-color: rgba(182,225,219,0.9); color: #000000;">2.0</td>
<td headers="opponent_d_per_game" class="new_gt_row new_gt_right" style="background-color: rgba(47,135,127,0.9); color: #FFFFFF;">7.0</td>
<td headers="total_d_per_game" class="new_gt_row new_gt_right" style="background-color: rgba(246,233,198,0.9); color: #000000;">−5.0</td></tr>
<tr><td headers="team" class="new_gt_row new_gt_left">J</td>
<td headers="user_d_per_game" class="new_gt_row new_gt_right" style="background-color: rgba(247,242,230,0.9); color: #000000;">−1.2</td>
<td headers="opponent_d_per_game" class="new_gt_row new_gt_right" style="background-color: rgba(247,240,224,0.9); color: #000000;">−2.1</td>
<td headers="total_d_per_game" class="new_gt_row new_gt_right" style="background-color: rgba(237,244,243,0.9); color: #000000;">0.9</td></tr>
<tr><td headers="team" class="new_gt_row new_gt_left">H</td>
<td headers="user_d_per_game" class="new_gt_row new_gt_right" style="background-color: rgba(212,238,234,0.9); color: #000000;">1.3</td>
<td headers="opponent_d_per_game" class="new_gt_row new_gt_right" style="background-color: rgba(247,242,231,0.9); color: #000000;">−1.5</td>
<td headers="total_d_per_game" class="new_gt_row new_gt_right" style="background-color: rgba(218,239,236,0.9); color: #000000;">2.8</td></tr>
<tr><td headers="team" class="new_gt_row new_gt_left">D</td>
<td headers="user_d_per_game" class="new_gt_row new_gt_right" style="background-color: rgba(247,238,215,0.9); color: #000000;">−2.2</td>
<td headers="opponent_d_per_game" class="new_gt_row new_gt_right" style="background-color: rgba(227,196,131,0.9); color: #000000;">−8.2</td>
<td headers="total_d_per_game" class="new_gt_row new_gt_right" style="background-color: rgba(166,217,211,0.9); color: #000000;">6.0</td></tr>
<tr><td headers="team" class="new_gt_row new_gt_left">C</td>
<td headers="user_d_per_game" class="new_gt_row new_gt_right" style="background-color: rgba(121,194,187,0.9); color: #000000;">3.0</td>
<td headers="opponent_d_per_game" class="new_gt_row new_gt_right" style="background-color: rgba(238,215,166,0.9); color: #000000;">−6.4</td>
<td headers="total_d_per_game" class="new_gt_row new_gt_right" style="background-color: rgba(84,173,165,0.9); color: #FFFFFF;">9.4</td></tr>
<tr><td headers="team" class="new_gt_row new_gt_left">B</td>
<td headers="user_d_per_game" class="new_gt_row new_gt_right" style="background-color: rgba(246,233,197,0.9); color: #000000;">−3.5</td>
<td headers="opponent_d_per_game" class="new_gt_row new_gt_right" style="background-color: rgba(140,81,10,0.9); color: #FFFFFF;">−14.7</td>
<td headers="total_d_per_game" class="new_gt_row new_gt_right" style="background-color: rgba(55,143,135,0.9); color: #FFFFFF;">11.2</td></tr>
<tr><td headers="team" class="new_gt_row new_gt_left">E</td>
<td headers="user_d_per_game" class="new_gt_row new_gt_right" style="background-color: rgba(1,102,94,0.9); color: #FFFFFF;">5.2</td>
<td headers="opponent_d_per_game" class="new_gt_row new_gt_right" style="background-color: rgba(226,194,128,0.9); color: #000000;">−8.4</td>
<td headers="total_d_per_game" class="new_gt_row new_gt_right" style="background-color: rgba(1,102,94,0.9); color: #FFFFFF;">13.6</td></tr>
</tbody>

<tfoot class="new_gt_footnotes">
<tr>
<td class="new_gt_footnote" colspan="4"> Data from Tony's personal league.</td>
</tr>
</tfoot>
</table>
</div>
```
```{r}
#| label: all-projected-points
BAD_PROJECTED_POINTS_SEASONS <- c(2018)
filt_season_points_above_projected <- season_points_above_projected |> 
  dplyr::filter(!(season %in% BAD_PROJECTED_POINTS_SEASONS))

filt_season_points_above_projected |> 
  dplyr::transmute(
    season = as.character(season),
    team,
    total_d_per_game
  ) |> 
  dplyr::bind_rows(
    filt_season_points_above_projected |> 
      dplyr::group_by(team) |> 
      dplyr::summarize(
        n_games = sum(n_games),
        user_d = sum(user_score - user_projected_score),
        opponent_d = sum(opponent_score - opponent_projected_score)
      ) |> 
      dplyr::ungroup() |> 
      dplyr::transmute(
        season = 'Total',
        team,
        total_d_per_game = (user_d / n_games) - (opponent_d / n_games)
      )
  ) |> 
  tidyr::pivot_wider(
    names_from = season,
    values_from = total_d_per_game,
    names_sort = TRUE
  ) |> 
  dplyr::arrange(Total) |> 
  gt::gt() |> 
  gt::cols_label(
    team ~ 'Team'
  ) |> 
  .gt_theme_538_dark() |> 
  gt::cols_align(
    columns = team,
    align = 'left'
  ) |> 
  gt::fmt_number(
    columns = -c(team),
    decimals = 1
  ) |> 
  .gt_zerocentered_brewer_col_numeric(
    columns = -c(team),
    palette = 'BrBG'
  ) |> 
  gt::tab_header(
    title = gt::html("Avg. Weekly Actual - Projected Points<br/>Minus Opponent's Actual - Projected Points"),
    subtitle = 'Tony has mostly over-performed projections, with the exception of 2023.'
  ) |> 
  gt::tab_footnote(
    footnote = CAPTION_LABEL
  ) |> 
  gt::tab_footnote(
    locations = cells_column_labels(Total),
    footnote = '2018 season excluded due to miscalibrated projected points.'
  )
```

```{r}
#| label: weekly-sd-projected-points
team_scores |> 
  dplyr::filter(!(season %in% BAD_PROJECTED_POINTS_SEASONS)) |> 
  dplyr::summarize(
    sd_d = sd(
      ((user_score - user_projected_score) / n_weeks_in_matchup) - 
        ((opponent_score - opponent_projected_score) / n_weeks_in_matchup),
       na.rm = TRUE
      )
  ) |> 
  dplyr::pull(sd_d) |> 
  round(1)
#> [1] 32.5
```

Observations:

-   I benefited from the second most fortunate season in 2019. I averaged 13.0 points per game above my projected score, and my opponents scored 4.7 less than their projected scores, adding up to +17.7.
-   Teams F and J have under-performed and over-performed in 4 of the 5 seasons, respectively. Interestingly, I have also over-performed in the 4 of the 5 seasons, but was fairly unfortunate this past season.
-   The variance in weekly performance against expectation (as defined by projected points) is not directly represented by this table, which shows averages. The standard deviation of the weekly difference in the actual points minus projected points for both teams in a matchup is about 32.5!

### Lost Opportunity

## Discussion

```{r}
#| label: median-scoring
median_scoring_records <- team_scores |> 
  dplyr::group_by(season, week) |> 
  dplyr::mutate(
    median_score = median(user_score)
  ) |> 
  dplyr::ungroup() |> 
  dplyr::mutate(
    median_result = ifelse(user_score > median_score, 'W', 'L')
  ) |> 
  dplyr::group_by(season, team) |> 
  dplyr::summarize(
    orig_wins = sum(result == 'W'),
    init_median_wins = sum(median_result == 'W')
  ) |> 
  dplyr::ungroup() |> 
  dplyr::mutate(
    median_wins = orig_wins + init_median_wins
  ) |> 
  dplyr::group_by(season) |> 
  dplyr::mutate(
    orig_placing = dplyr::row_number(dplyr::desc(orig_wins)),
    median_placing = dplyr::row_number(dplyr::desc(init_median_wins))
  ) |> 
  dplyr::ungroup() |> 
  dplyr::arrange(season, orig_placing)

median_scoring_records_with_labels <- median_scoring_records |>
  dplyr::mutate(
    label = forcats::fct_reorder(
      paste0(
        "<b><span style='font-size:12pt'>", 
        team, 
        "</span></b> <span style='font-size:9pt'>(", 
        orig_placing,
        ## https://albert-rapp.de/posts/ggplot2-tips/08_fonts_and_icons/08_fonts_and_icons.html
        " <span style='font-family:fa-solid",
        dplyr::case_when(
          orig_placing > median_placing ~ ';color:#2feaa8',
          orig_placing < median_placing ~ ';color:#fb3640',
          TRUE ~ ''
        ),
        "'>&#x",
        dplyr::case_when(
          orig_placing  > median_placing ~ 'e098',
          orig_placing  < median_placing ~ 'e097',
          TRUE ~ 'f061'
        ),
        ';</span> ',
        median_placing,
        ')</span>'
      ),
      1000 * season - 10 * orig_placing
    )
  )

median_scoring_changes_plot <- median_scoring_records_with_labels |>
  ggplot2::ggplot() +
  ggplot2::geom_vline(
    data = tibble::tibble(x = c(1, 2)),
    color = COMPLEMENTARY_BACKGROUND_COLOR,
    ggplot2::aes(
      xintercept = x
    )
  ) + 
  ggplot2::geom_segment(
    color = WHITISH_FOREGROUND_COLOR,
    ## don't filter ou  because it messes with factor levels
    # data = median_scoring_records_with_labels |> filter(team != 'Tony'),
    linewidth = 0.25,
    ggplot2::aes(
      x = 1,
      xend = 2,
      y = label,
      yend = 11 - median_placing
    )
  ) +
  ggplot2::geom_segment(
    color = WHITISH_FOREGROUND_COLOR,
    data = median_scoring_records_with_labels |> dplyr::filter(team == 'Tony'),
    linewidth = 1,
    ggplot2::aes(
      x = 1,
      xend = 2,
      y = label,
      yend = 11 - median_placing
    )
  ) +
  ggplot2::facet_wrap(~season, scales = 'free_y') +
  ggplot2::theme(
    axis.text.x = ggplot2::element_blank(),
    axis.text.y = ggtext::element_markdown(),
    panel.grid.major = ggplot2::element_blank(),
    plot.subtitle = ggtext::element_markdown(size = 14)
  ) +
  ggplot2::labs(
    title = 'Changes in records with median scoring',
    subtitle = "Does the original placement go up (<span style='font-family:fa-solid;color:#2feaa8'>&#xe098;</span>), down (<span style='font-family:fa-solid;color:#fb3640'>&#xe097;</span>), or stay the same (<span style='font-family:fa-solid'>&#xf061;</span>) with median scoring?",
    y = NULL,
    x = NULL,
    caption = CAPTION_LABEL
  )

ggplot2::ggsave(
  median_scoring_changes_plot,
  filename = file.path(PROJ_DIR, 'median-scoring.png'),
  width = 8,
  height = 8
)

median_scoring_records |> 
  dplyr::group_by(`Team` = team) |> 
  dplyr::summarize(
    `Total placement Δ` = sum(orig_placing - median_placing),
    `Positive changes` = sum(median_placing < orig_placing),
    `Negative changes` = sum(median_placing > orig_placing)
  ) |> 
  dplyr::arrange(dplyr::desc(`Total placement Δ`)) |> 
  knitr::kable(align = c('lrrr'))
```

![](median-scoring.png)

And here's a tabular summary.

| Team | Total placement Δ | Positive changes | Negative changes |
|:-----|------------------:|-----------------:|-----------------:|
| C    |                11 |                4 |                0 |
| A    |                 9 |                4 |                2 |
| Tony |                 7 |                3 |                2 |
| B    |                 1 |                2 |                1 |
| E    |                 0 |                1 |                3 |
| I    |                -1 |                3 |                3 |
| D    |                -3 |                2 |                4 |
| J    |                -5 |                2 |                3 |
| H    |                -8 |                1 |                5 |
| F    |               -11 |                1 |                4 |

Some observations:

-   I would have moved up in my placement in 3 out of the 6 seasons with the median scoring system.
-   Team C would have benefited the most--they would have moved up the rankings in 4 out of the 6 seasons (and not changed in the other 2), for a total sum of +11 placements (about +2 per season).
-   Team F is on the other end of the spectrum--their placement would have been worse in 4 of the 6 seasons with the median scoring system, for a total ranking change of -11 (about -2 per season).

```{r}
#| label: median-scoring-records-top4
median_scoring_records |> 
  group_by(`Season` = season) |> 
  summarize(
    `Teams dropping out of Top 4` = sum(orig_placing <= 4 & median_placing > 4),
    `Teams rising out of Bottom 4` = sum(orig_placing >= 6 & median_placing < 6)
  ) |> 
  arrange(`Season`) |> 
  knitr::kable()
```

| Season | Teams dropping out of Top 4 | Teams rising out of Bottom 4 |
|-------:|----------------------------:|-----------------------------:|
|   2018 |                           0 |                            0 |
|   2019 |                           1 |                            2 |
|   2020 |                           2 |                            2 |
|   2021 |                           1 |                            2 |
|   2022 |                           1 |                            2 |
|   2023 |                           1 |                            2 |

Given the high importance of not finishing in the bottom 4 (to avoid our last place penalty), it's notable that the 2 teams would have moved out of the bottom 4 every season with the median scoring system, with the exception of 2018. As for the top 4, 2 teams would have dropped out in 2020, no teams would have dropped out in 2018, and only 1 team would have dropped out in the rest of the seasons.

## Conclusion

Of course, a lot of things are out of one's control--i.e. you generally don't have any influence on your opponent's score in a given week--but our look into lost opportunity is something that could serve as an impetus for action. Knowing that, on average, players in my leagues lose out on about \~20 points every week due to sub-optimal lineup choices can make me reconsider how I think about "upside" with bench players.
