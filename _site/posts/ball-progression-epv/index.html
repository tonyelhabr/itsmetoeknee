<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tony ElHabr">
<meta name="dcterms.date" content="2024-04-01">
<meta name="description" content="Identifying where incomplete passes can have positive impact on the pitch.">

<title>Tony’s Blog - Does completing your passes even matter?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../assets/img/keyboard.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-listing/list.min.js"></script>
<script src="../../site_libs/quarto-listing/quarto-listing.js"></script>
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script>

  window.document.addEventListener("DOMContentLoaded", function (_event) {
    const listingTargetEl = window.document.querySelector('#listing-listing .list');
    if (!listingTargetEl) {
      // No listing discovered, do not attach.
      return; 
    }

    const options = {
      valueNames: [{ data: ['index'] },{ data: ['categories'] },{ data: ['listing-date-sort'] },{ data: ['listing-file-modified-sort'] }],
      
      searchColumns: [],
    };

    window['quarto-listings'] = window['quarto-listings'] || {};
    window['quarto-listings']['listing-listing'] = new List('listing-listing', options);

    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  });

  window.addEventListener('hashchange',() => {
    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  })
  </script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-TKB26G5GZW"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-TKB26G5GZW', { 'anonymize_ip': true});
</script>
<script type="module" src="../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="alternate" type="application/rss+xml" title="Tony's Blog" href="index.xml"><meta name="twitter:title" content="Tony’s Blog - Does completing your passes even matter?">
<meta name="twitter:description" content="Identifying where incomplete passes can have positive impact on the pitch.">
<meta name="twitter:site" content="@TonyElHabr">
<meta name="twitter:card" content="summary">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Tony’s Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html" rel="" target="">
 <span class="menu-text">Projects</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/tonyelhabr" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/TonyElHabr" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/tony-elhabr/" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#possession-value-pv-for-passes" id="toc-possession-value-pv-for-passes" class="nav-link" data-scroll-target="#possession-value-pv-for-passes">Possession Value (PV) for Passes</a>
  <ul>
  <li><a href="#successful-passes" id="toc-successful-passes" class="nav-link" data-scroll-target="#successful-passes">Successful Passes</a>
  <ul class="collapse">
  <li><a href="#from-the-center-spot-to-anywhere-on-the-pitch" id="toc-from-the-center-spot-to-anywhere-on-the-pitch" class="nav-link" data-scroll-target="#from-the-center-spot-to-anywhere-on-the-pitch">From the Center Spot, To Anywhere on the Pitch</a>
  <ul class="collapse">
  <li><a href="#empirical-average-pv" id="toc-empirical-average-pv" class="nav-link" data-scroll-target="#empirical-average-pv">Empirical average PV</a></li>
  </ul></li>
  <li><a href="#from-anywhere-on-the-pitch-to-anywhere-on-the-pitch" id="toc-from-anywhere-on-the-pitch-to-anywhere-on-the-pitch" class="nav-link" data-scroll-target="#from-anywhere-on-the-pitch-to-anywhere-on-the-pitch">From Anywhere on the Pitch, To Anywhere on the Pitch</a></li>
  </ul></li>
  <li><a href="#unsuccessful-passes" id="toc-unsuccessful-passes" class="nav-link" data-scroll-target="#unsuccessful-passes">Unsuccessful Passes</a>
  <ul class="collapse">
  <li><a href="#from-the-center-spot-to-anywhere-on-the-pitch-1" id="toc-from-the-center-spot-to-anywhere-on-the-pitch-1" class="nav-link" data-scroll-target="#from-the-center-spot-to-anywhere-on-the-pitch-1">From the Center Spot, To Anywhere on the Pitch</a>
  <ul class="collapse">
  <li><a href="#empirical-average-pv-1" id="toc-empirical-average-pv-1" class="nav-link" data-scroll-target="#empirical-average-pv-1">Empirical average PV</a></li>
  </ul></li>
  <li><a href="#from-anywhere-on-the-pitch-to-anywhere-on-the-pitch-1" id="toc-from-anywhere-on-the-pitch-to-anywhere-on-the-pitch-1" class="nav-link" data-scroll-target="#from-anywhere-on-the-pitch-to-anywhere-on-the-pitch-1">From Anywhere on the Pitch, To Anywhere on the Pitch</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Does completing your passes even matter?</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button" data-quarto-source-url="https://github.com/tonyelhabr/itsmetoeknee/blob/main/posts/ball-progression-epv/index.qmd">View Source</a></li></ul></div></div>
  <div class="quarto-categories">
    <div class="quarto-category">r</div>
    <div class="quarto-category">soccer</div>
  </div>
  </div>

<div>
  <div class="description">
    Identifying where incomplete passes can have positive impact on the pitch.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Tony ElHabr </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 1, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>I heard someone recently say something like “Possession values (PV) models in soccer basically come down to ball progression”. That’s an interesting thought, and add a hunch that it probably isn’t too wrong.</p>
<p>One way of getting at that idea is too look at how your PV model treats incomplete passes.</p>
<ul>
<li>Does it say that all long passes are “good” (i.e.&nbsp;have &gt;0 PV)?</li>
<li>What role does the starting position of the pass play? (i.e.&nbsp;Are balls crossed into the 18-yard box from the wing treated similarly to goal kicks launched into the opponent’s box?)</li>
<li>How does PV for an unsuccessful pass compare to a successful one, holding all else equal?</li>
</ul>
<p>I attempt to answer some of these questions with <a href="https://dtai.cs.kuleuven.be/sports/vaep">a VAEP model</a>–an <a href="https://fivethirtyeight.com/features/possession-is-the-puzzle-of-soccer-analytics-these-models-are-trying-to-solve-it/">open-source PV model</a>.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> Every PV model is different, but they all generally try assign value to every on-ball action on the pitch. VAEP specifically defines possession value as the difference in goals scored and goals conceded expected in the next 10 actions.</p>
</section>
<section id="possession-value-pv-for-passes" class="level1">
<h1>Possession Value (PV) for Passes</h1>
<section id="successful-passes" class="level2">
<h2 class="anchored" data-anchor-id="successful-passes">Successful Passes</h2>
<p>We’ll want to eventually look at the PV of incomplete passes, but it’s probably easier to start with completed passes, as we have pretty strong intuition about them–pass the ball successfully closer to the goal, and you’re most likely helping your team (i.e.&nbsp;positive PV).</p>
<section id="from-the-center-spot-to-anywhere-on-the-pitch" class="level3">
<h3 class="anchored" data-anchor-id="from-the-center-spot-to-anywhere-on-the-pitch">From the Center Spot, To Anywhere on the Pitch</h3>
<p>In the interactive 12x16 pitch below, the blue tile illustrates where a <strong>typical, hypothetical</strong> pass is made, and the colored tiles illustrate the possession value (PV) associated with a successful pass made to that area. Hovering over the tile shows the PV value above the pitch as well.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<p>::: {.callout-note title=““Typical” and ““Hypothetical” collapse=“false”} <strong>Typical</strong>: I’ve selected “constant” values for non-spatial features, i.e.&nbsp;game state of 0-0 with no time elapsed, pass taken with foot.</p>
<p><strong>Hypothetical</strong>: I’m generating one set of predictions (PV values) on an x-y grid rather than using (average) PV values from empirical data. (More on that in below.) :::</p>
<div class="cell" data-include="true">
<details class="hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb1" data-startfrom="737" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 736;"><span id="cb1-737"><a href="#cb1-737" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1-738"><a href="#cb1-738" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> chart <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"div"</span>)</span>
<span id="cb1-739"><a href="#cb1-739" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> title <span class="op">=</span> chart<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"heatmap-title-complete"</span>)</span>
<span id="cb1-740"><a href="#cb1-740" aria-hidden="true" tabindex="-1"></a>  title<span class="op">.</span><span class="fu">append</span>(<span class="st">"p"</span>)<span class="op">.</span><span class="fu">html</span>(<span class="vs">`PV: &lt;span id='pv-value-complete'&gt;0&lt;/span&gt;`</span>)</span>
<span id="cb1-741"><a href="#cb1-741" aria-hidden="true" tabindex="-1"></a>  chart<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"heatmap-complete"</span>)</span>
<span id="cb1-742"><a href="#cb1-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-743"><a href="#cb1-743" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> legendSwatchContainer <span class="op">=</span> chart<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb1-744"><a href="#cb1-744" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"heatmap-legend-complete"</span>)</span>
<span id="cb1-745"><a href="#cb1-745" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"flex"</span>)</span>
<span id="cb1-746"><a href="#cb1-746" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"flex-direction"</span><span class="op">,</span> <span class="st">"column"</span>)</span>
<span id="cb1-747"><a href="#cb1-747" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"align-items"</span><span class="op">,</span> <span class="st">"center"</span>)</span>
<span id="cb1-748"><a href="#cb1-748" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="st">"100%"</span>)<span class="op">;</span></span>
<span id="cb1-749"><a href="#cb1-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-750"><a href="#cb1-750" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> legendRange <span class="op">=</span> [</span>
<span id="cb1-751"><a href="#cb1-751" aria-hidden="true" tabindex="-1"></a>    <span class="fl">1.1</span> <span class="op">*</span> d3<span class="op">.</span><span class="fu">min</span>(colorScaleCompleteRange)<span class="op">,</span></span>
<span id="cb1-752"><a href="#cb1-752" aria-hidden="true" tabindex="-1"></a>    <span class="fl">1.1</span> <span class="op">*</span> d3<span class="op">.</span><span class="fu">max</span>(colorScaleCompleteRange)</span>
<span id="cb1-753"><a href="#cb1-753" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb1-754"><a href="#cb1-754" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> stepSize <span class="op">=</span> (legendRange[<span class="dv">1</span>] <span class="op">-</span> legendRange[<span class="dv">0</span>]) <span class="op">/</span> (swatchParams<span class="op">.</span><span class="at">num</span> <span class="op">-</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb1-755"><a href="#cb1-755" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> legendSwatches <span class="op">=</span> d3<span class="op">.</span><span class="fu">range</span>(legendRange[<span class="dv">0</span>]<span class="op">,</span> legendRange[<span class="dv">1</span>] <span class="op">+</span> stepSize<span class="op">,</span> stepSize)<span class="op">;</span></span>
<span id="cb1-756"><a href="#cb1-756" aria-hidden="true" tabindex="-1"></a>  legendSwatches[legendSwatches<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span>] <span class="op">=</span> legendRange[<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb1-757"><a href="#cb1-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-758"><a href="#cb1-758" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalLegendWidth <span class="op">=</span> swatchParams<span class="op">.</span><span class="at">width</span> <span class="op">*</span> swatchParams<span class="op">.</span><span class="at">num</span><span class="op">;</span></span>
<span id="cb1-759"><a href="#cb1-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-760"><a href="#cb1-760" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> swatchRow <span class="op">=</span> legendSwatchContainer<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb1-761"><a href="#cb1-761" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"flex"</span>)</span>
<span id="cb1-762"><a href="#cb1-762" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"justify-content"</span><span class="op">,</span> <span class="st">"center"</span>)</span>
<span id="cb1-763"><a href="#cb1-763" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="st">"100%"</span>)<span class="op">;</span></span>
<span id="cb1-764"><a href="#cb1-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-765"><a href="#cb1-765" aria-hidden="true" tabindex="-1"></a>  swatchRow<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"div"</span>)</span>
<span id="cb1-766"><a href="#cb1-766" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(legendSwatches)</span>
<span id="cb1-767"><a href="#cb1-767" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-768"><a href="#cb1-768" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb1-769"><a href="#cb1-769" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>swatchParams<span class="op">.</span><span class="at">width</span><span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb1-770"><a href="#cb1-770" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"height"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>swatchParams<span class="op">.</span><span class="at">height</span><span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb1-771"><a href="#cb1-771" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"background-color"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">colorScaleComplete</span>(d))<span class="op">;</span></span>
<span id="cb1-772"><a href="#cb1-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-773"><a href="#cb1-773" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> labelRow <span class="op">=</span> legendSwatchContainer<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb1-774"><a href="#cb1-774" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"flex"</span>)</span>
<span id="cb1-775"><a href="#cb1-775" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"justify-content"</span><span class="op">,</span> <span class="st">"center"</span>)</span>
<span id="cb1-776"><a href="#cb1-776" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>totalLegendWidth<span class="sc">}</span><span class="vs">px`</span>)<span class="op">;</span></span>
<span id="cb1-777"><a href="#cb1-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-778"><a href="#cb1-778" aria-hidden="true" tabindex="-1"></a>  labelRow<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"span"</span>)</span>
<span id="cb1-779"><a href="#cb1-779" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(colorScaleCompleteRange)</span>
<span id="cb1-780"><a href="#cb1-780" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-781"><a href="#cb1-781" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"span"</span>)</span>
<span id="cb1-782"><a href="#cb1-782" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb1-783"><a href="#cb1-783" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (d <span class="op">===</span> d3<span class="op">.</span><span class="fu">min</span>(colorScaleCompleteRange)) {</span>
<span id="cb1-784"><a href="#cb1-784" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> d <span class="op">+</span> <span class="st">" &lt;="</span><span class="op">;</span></span>
<span id="cb1-785"><a href="#cb1-785" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (d <span class="op">===</span> d3<span class="op">.</span><span class="fu">max</span>(colorScaleCompleteRange)) {</span>
<span id="cb1-786"><a href="#cb1-786" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"&gt;= "</span> <span class="op">+</span> d<span class="op">;</span></span>
<span id="cb1-787"><a href="#cb1-787" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-788"><a href="#cb1-788" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> d<span class="op">;</span></span>
<span id="cb1-789"><a href="#cb1-789" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb1-790"><a href="#cb1-790" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Center the middle text element, then right- and left-align the right and left text labels</span></span>
<span id="cb1-791"><a href="#cb1-791" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"flex"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">"1"</span> <span class="op">:</span> <span class="kw">null</span>)</span>
<span id="cb1-792"><a href="#cb1-792" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"text-align"</span><span class="op">,</span> <span class="st">"center"</span>)</span>
<span id="cb1-793"><a href="#cb1-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-794"><a href="#cb1-794" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> chart<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb1-795"><a href="#cb1-795" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-ojs-cell-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div id="ojs-cell-1" data-nodetype="expression">

</div>
<figcaption class="figure-caption">Figure&nbsp;1: A heatmap showing the possession value (PV) of a typical successful pass from roughly the center spot (annotated in blue) to all areas on the pitch. The exact PV value associated with a successful pass ending at the hover point can be viewed above the pitch.</figcaption>
</figure>
</div>
</div>
<div class="cell">
<details class="hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb2" data-startfrom="801" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 800;"><span id="cb2-801"><a href="#cb2-801" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb2-802"><a href="#cb2-802" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> heatmap_complete <span class="op">=</span> d3_soccer<span class="op">.</span><span class="fu">heatmap</span>(pitch)</span>
<span id="cb2-803"><a href="#cb2-803" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">colorScale</span>(colorScaleComplete)</span>
<span id="cb2-804"><a href="#cb2-804" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enableInteraction</span>(<span class="kw">true</span>)</span>
<span id="cb2-805"><a href="#cb2-805" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">onSelect</span>((x<span class="op">,</span> y<span class="op">,</span> v) <span class="kw">=&gt;</span> {</span>
<span id="cb2-806"><a href="#cb2-806" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> cappedValue <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(v<span class="op">,</span> <span class="op">-</span><span class="dv">1</span>)<span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb2-807"><a href="#cb2-807" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">select</span>(<span class="st">"#pv-value-complete"</span>)<span class="op">.</span><span class="fu">text</span>(cappedValue<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>))<span class="op">;</span></span>
<span id="cb2-808"><a href="#cb2-808" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb2-809"><a href="#cb2-809" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">parent_el</span>(<span class="st">"#heatmap-complete"</span>)</span>
<span id="cb2-810"><a href="#cb2-810" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">interpolate</span>(<span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb2-811"><a href="#cb2-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-812"><a href="#cb2-812" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(<span class="st">"#heatmap-complete"</span>)<span class="op">.</span><span class="fu">html</span>(<span class="st">""</span>)<span class="op">.</span><span class="fu">datum</span>(complete_pv_data)<span class="op">.</span><span class="fu">call</span>(heatmap_complete)<span class="op">;</span></span>
<span id="cb2-813"><a href="#cb2-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-814"><a href="#cb2-814" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3<span class="op">.</span><span class="fu">select</span>(<span class="st">"#heatmap-complete"</span>)<span class="op">.</span><span class="fu">select</span>(<span class="st">"svg"</span>)<span class="op">;</span></span>
<span id="cb2-815"><a href="#cb2-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-816"><a href="#cb2-816" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb2-817"><a href="#cb2-817" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> passStartParams<span class="op">.</span><span class="at">x</span>)</span>
<span id="cb2-818"><a href="#cb2-818" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> passStartParams<span class="op">.</span><span class="at">y</span>)</span>
<span id="cb2-819"><a href="#cb2-819" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> tileParams<span class="op">.</span><span class="at">width</span>)</span>
<span id="cb2-820"><a href="#cb2-820" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> tileParams<span class="op">.</span><span class="at">height</span>)</span>
<span id="cb2-821"><a href="#cb2-821" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"blue"</span>)</span>
<span id="cb2-822"><a href="#cb2-822" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb2-823"><a href="#cb2-823" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="st">"1px"</span>)<span class="op">;</span></span>
<span id="cb2-824"><a href="#cb2-824" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-2" data-nodetype="expression">

</div>
</div>
</div>
<p>I’d say this illustration matches common knowledge Forward completed passes should be assigned non-trivial positive value.</p>
<section id="empirical-average-pv" class="level4">
<h4 class="anchored" data-anchor-id="empirical-average-pv">Empirical average PV</h4>
<p>I called out the fact that the PV pitch above is a “hypothetical” and “typical” one. An alternative approach would be to view the <strong>average</strong> PV of <strong>empirical</strong> completed passes. Theoretically this shouldn’t look too different–we’re using the same underlying model after all–but I think it’s useful to verify that our prior illustration isn’t misrepresentation of historical PV.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<div class="cell" data-include="true">
<details class="hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb3" data-startfrom="840" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 839;"><span id="cb3-840"><a href="#cb3-840" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb3-841"><a href="#cb3-841" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> chart <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"div"</span>)</span>
<span id="cb3-842"><a href="#cb3-842" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> title <span class="op">=</span> chart<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"heatmap-title-complete-empirical"</span>)</span>
<span id="cb3-843"><a href="#cb3-843" aria-hidden="true" tabindex="-1"></a>  title<span class="op">.</span><span class="fu">append</span>(<span class="st">"p"</span>)<span class="op">.</span><span class="fu">html</span>(<span class="vs">`PV: &lt;span id='pv-value-complete-empirical'&gt;0&lt;/span&gt;`</span>)</span>
<span id="cb3-844"><a href="#cb3-844" aria-hidden="true" tabindex="-1"></a>  chart<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"heatmap-complete-empirical"</span>)</span>
<span id="cb3-845"><a href="#cb3-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-846"><a href="#cb3-846" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> legendSwatchContainer <span class="op">=</span> chart<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb3-847"><a href="#cb3-847" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"heatmap-legend-complete-empirical"</span>)</span>
<span id="cb3-848"><a href="#cb3-848" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"flex"</span>)</span>
<span id="cb3-849"><a href="#cb3-849" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"flex-direction"</span><span class="op">,</span> <span class="st">"column"</span>)</span>
<span id="cb3-850"><a href="#cb3-850" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"align-items"</span><span class="op">,</span> <span class="st">"center"</span>)</span>
<span id="cb3-851"><a href="#cb3-851" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="st">"100%"</span>)<span class="op">;</span></span>
<span id="cb3-852"><a href="#cb3-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-853"><a href="#cb3-853" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> legendRange <span class="op">=</span> [</span>
<span id="cb3-854"><a href="#cb3-854" aria-hidden="true" tabindex="-1"></a>    <span class="fl">1.1</span> <span class="op">*</span> d3<span class="op">.</span><span class="fu">min</span>(colorScaleCompleteRange)<span class="op">,</span></span>
<span id="cb3-855"><a href="#cb3-855" aria-hidden="true" tabindex="-1"></a>    <span class="fl">1.1</span> <span class="op">*</span> d3<span class="op">.</span><span class="fu">max</span>(colorScaleCompleteRange)</span>
<span id="cb3-856"><a href="#cb3-856" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb3-857"><a href="#cb3-857" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> stepSize <span class="op">=</span> (legendRange[<span class="dv">1</span>] <span class="op">-</span> legendRange[<span class="dv">0</span>]) <span class="op">/</span> (swatchParams<span class="op">.</span><span class="at">num</span> <span class="op">-</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb3-858"><a href="#cb3-858" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> legendSwatches <span class="op">=</span> d3<span class="op">.</span><span class="fu">range</span>(legendRange[<span class="dv">0</span>]<span class="op">,</span> legendRange[<span class="dv">1</span>] <span class="op">+</span> stepSize<span class="op">,</span> stepSize)<span class="op">;</span></span>
<span id="cb3-859"><a href="#cb3-859" aria-hidden="true" tabindex="-1"></a>  legendSwatches[legendSwatches<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span>] <span class="op">=</span> legendRange[<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb3-860"><a href="#cb3-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-861"><a href="#cb3-861" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalLegendWidth <span class="op">=</span> swatchParams<span class="op">.</span><span class="at">width</span> <span class="op">*</span> swatchParams<span class="op">.</span><span class="at">num</span><span class="op">;</span></span>
<span id="cb3-862"><a href="#cb3-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-863"><a href="#cb3-863" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> swatchRow <span class="op">=</span> legendSwatchContainer<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb3-864"><a href="#cb3-864" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"flex"</span>)</span>
<span id="cb3-865"><a href="#cb3-865" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"justify-content"</span><span class="op">,</span> <span class="st">"center"</span>)</span>
<span id="cb3-866"><a href="#cb3-866" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="st">"100%"</span>)<span class="op">;</span></span>
<span id="cb3-867"><a href="#cb3-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-868"><a href="#cb3-868" aria-hidden="true" tabindex="-1"></a>  swatchRow<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"div"</span>)</span>
<span id="cb3-869"><a href="#cb3-869" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(legendSwatches)</span>
<span id="cb3-870"><a href="#cb3-870" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb3-871"><a href="#cb3-871" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb3-872"><a href="#cb3-872" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>swatchParams<span class="op">.</span><span class="at">width</span><span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb3-873"><a href="#cb3-873" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"height"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>swatchParams<span class="op">.</span><span class="at">height</span><span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb3-874"><a href="#cb3-874" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"background-color"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">colorScaleComplete</span>(d))<span class="op">;</span></span>
<span id="cb3-875"><a href="#cb3-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-876"><a href="#cb3-876" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> labelRow <span class="op">=</span> legendSwatchContainer<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb3-877"><a href="#cb3-877" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"flex"</span>)</span>
<span id="cb3-878"><a href="#cb3-878" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"justify-content"</span><span class="op">,</span> <span class="st">"center"</span>)</span>
<span id="cb3-879"><a href="#cb3-879" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>totalLegendWidth<span class="sc">}</span><span class="vs">px`</span>)<span class="op">;</span></span>
<span id="cb3-880"><a href="#cb3-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-881"><a href="#cb3-881" aria-hidden="true" tabindex="-1"></a>  labelRow<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"span"</span>)</span>
<span id="cb3-882"><a href="#cb3-882" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(colorScaleCompleteRange)</span>
<span id="cb3-883"><a href="#cb3-883" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb3-884"><a href="#cb3-884" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"span"</span>)</span>
<span id="cb3-885"><a href="#cb3-885" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb3-886"><a href="#cb3-886" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (d <span class="op">===</span> d3<span class="op">.</span><span class="fu">min</span>(colorScaleCompleteRange)) {</span>
<span id="cb3-887"><a href="#cb3-887" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> d <span class="op">+</span> <span class="st">" &lt;="</span><span class="op">;</span></span>
<span id="cb3-888"><a href="#cb3-888" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (d <span class="op">===</span> d3<span class="op">.</span><span class="fu">max</span>(colorScaleCompleteRange)) {</span>
<span id="cb3-889"><a href="#cb3-889" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"&gt;= "</span> <span class="op">+</span> d<span class="op">;</span></span>
<span id="cb3-890"><a href="#cb3-890" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb3-891"><a href="#cb3-891" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> d<span class="op">;</span></span>
<span id="cb3-892"><a href="#cb3-892" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb3-893"><a href="#cb3-893" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"flex"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">"1"</span> <span class="op">:</span> <span class="kw">null</span>)</span>
<span id="cb3-894"><a href="#cb3-894" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"text-align"</span><span class="op">,</span> <span class="st">"center"</span>)</span>
<span id="cb3-895"><a href="#cb3-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-896"><a href="#cb3-896" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> chart<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb3-897"><a href="#cb3-897" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-ojs-cell-3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div id="ojs-cell-3" data-nodetype="expression">

</div>
<figcaption class="figure-caption">Figure&nbsp;2: A heatmap showing the average possession value (PV) of empirical successful passes from the center spot (annotated in blue) to all areas on the pitch. The relative frequency of completed passes from the center spot to each other cell is shown as a percentage. The exact PV value associated with a successful pass ending at the hover point can be viewed above the pitch.</figcaption>
</figure>
</div>
</div>
<div class="cell">
<details class="hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb4" data-startfrom="903" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 902;"><span id="cb4-903"><a href="#cb4-903" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb4-904"><a href="#cb4-904" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> heatmap_complete_empirical <span class="op">=</span> d3_soccer<span class="op">.</span><span class="fu">heatmap</span>(pitch)</span>
<span id="cb4-905"><a href="#cb4-905" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">colorScale</span>(colorScaleComplete)</span>
<span id="cb4-906"><a href="#cb4-906" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enableInteraction</span>(<span class="kw">true</span>)</span>
<span id="cb4-907"><a href="#cb4-907" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">onSelect</span>((x<span class="op">,</span> y<span class="op">,</span> v) <span class="kw">=&gt;</span> {</span>
<span id="cb4-908"><a href="#cb4-908" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> cappedValue <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(v<span class="op">,</span> <span class="op">-</span><span class="dv">1</span>)<span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb4-909"><a href="#cb4-909" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">select</span>(<span class="st">"#pv-value-complete-empirical"</span>)<span class="op">.</span><span class="fu">text</span>(cappedValue<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>))<span class="op">;</span></span>
<span id="cb4-910"><a href="#cb4-910" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb4-911"><a href="#cb4-911" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">parent_el</span>(<span class="st">"#heatmap-complete-empirical"</span>)</span>
<span id="cb4-912"><a href="#cb4-912" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">interpolate</span>(<span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb4-913"><a href="#cb4-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-914"><a href="#cb4-914" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(<span class="st">"#heatmap-complete-empirical"</span>)<span class="op">.</span><span class="fu">html</span>(<span class="st">""</span>)<span class="op">.</span><span class="fu">datum</span>(complete_actual_pv_data)<span class="op">.</span><span class="fu">call</span>(heatmap_complete_empirical)<span class="op">;</span></span>
<span id="cb4-915"><a href="#cb4-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-916"><a href="#cb4-916" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3<span class="op">.</span><span class="fu">select</span>(<span class="st">"#heatmap-complete-empirical"</span>)<span class="op">.</span><span class="fu">select</span>(<span class="st">"svg"</span>)<span class="op">;</span></span>
<span id="cb4-917"><a href="#cb4-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-918"><a href="#cb4-918" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cells <span class="op">=</span> svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".cell"</span>)<span class="op">;</span></span>
<span id="cb4-919"><a href="#cb4-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-920"><a href="#cb4-920" aria-hidden="true" tabindex="-1"></a>  cells<span class="op">.</span><span class="fu">each</span>(<span class="kw">function</span>(d<span class="op">,</span> i) {</span>
<span id="cb4-921"><a href="#cb4-921" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cell <span class="op">=</span> d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span>)<span class="op">;</span></span>
<span id="cb4-922"><a href="#cb4-922" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> bbox <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getBBox</span>()<span class="op">;</span></span>
<span id="cb4-923"><a href="#cb4-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-924"><a href="#cb4-924" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span><span class="op">.</span><span class="at">parentNode</span>)</span>
<span id="cb4-925"><a href="#cb4-925" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb4-926"><a href="#cb4-926" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> bbox<span class="op">.</span><span class="at">x</span> <span class="op">+</span> bbox<span class="op">.</span><span class="at">width</span> <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb4-927"><a href="#cb4-927" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> bbox<span class="op">.</span><span class="at">y</span> <span class="op">+</span> bbox<span class="op">.</span><span class="at">height</span> <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb4-928"><a href="#cb4-928" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb4-929"><a href="#cb4-929" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"alignment-baseline"</span><span class="op">,</span> <span class="st">"central"</span>)</span>
<span id="cb4-930"><a href="#cb4-930" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"2.5px"</span>)</span>
<span id="cb4-931"><a href="#cb4-931" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"pointer-events"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb4-932"><a href="#cb4-932" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>((d<span class="op">.</span><span class="at">prop</span> <span class="op">*</span> <span class="dv">100</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>) <span class="op">+</span> <span class="st">"%"</span>)<span class="op">;</span></span>
<span id="cb4-933"><a href="#cb4-933" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb4-934"><a href="#cb4-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-935"><a href="#cb4-935" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb4-936"><a href="#cb4-936" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> passStartParams<span class="op">.</span><span class="at">x</span>)</span>
<span id="cb4-937"><a href="#cb4-937" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> passStartParams<span class="op">.</span><span class="at">y</span>)</span>
<span id="cb4-938"><a href="#cb4-938" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> tileParams<span class="op">.</span><span class="at">width</span>)</span>
<span id="cb4-939"><a href="#cb4-939" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> tileParams<span class="op">.</span><span class="at">height</span>)</span>
<span id="cb4-940"><a href="#cb4-940" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"blue"</span>)</span>
<span id="cb4-941"><a href="#cb4-941" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb4-942"><a href="#cb4-942" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="st">"1px"</span>)<span class="op">;</span></span>
<span id="cb4-943"><a href="#cb4-943" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-4" data-nodetype="expression">

</div>
</div>
</div>
<p>The gradient looks similar to our hypothetical pitch, which is what we hoped to confirm. This empirical pitch implicitly embeds historical information about the passes actually completed from the center spot. If all the completed passes from the center spot were historically from headers, we might have seen a different looking gradient (since the hypothetical view assumes a footed pass, which can lead to much different subsequent chains of passes). So we know that “location isn’t everything” and that we’re simplifying a lot by just looking at a 2-D pitch, but we can feel ok that our hypothetical view is at least fairly approximating empirical PV.</p>
<p>The other interesting this view offers–we can see the actual relative frequency of the end points of passes from the center spot highlights just how uncommon completed passes into the box are from the center spot. So yes, successful passes into the box add a lot of value, but in reality they are hard to complete, so they don’t happen all that often.</p>
</section>
</section>
<section id="from-anywhere-on-the-pitch-to-anywhere-on-the-pitch" class="level3">
<h3 class="anchored" data-anchor-id="from-anywhere-on-the-pitch-to-anywhere-on-the-pitch">From Anywhere on the Pitch, To Anywhere on the Pitch</h3>
<p>Now, to give the full picture, the interactive pitch below will dynamically update to show PV values associated with a pass starting from ANY tile that you hover over. pitch</p>
<div class="cell" data-include="true">
<details class="hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb5" data-startfrom="957" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 956;"><span id="cb5-957"><a href="#cb5-957" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb5-958"><a href="#cb5-958" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> chart <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"div"</span>)</span>
<span id="cb5-959"><a href="#cb5-959" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> title <span class="op">=</span> chart<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"heatmap-title-complete-nested"</span>)</span>
<span id="cb5-960"><a href="#cb5-960" aria-hidden="true" tabindex="-1"></a>  title<span class="op">.</span><span class="fu">append</span>(<span class="st">"p"</span>)<span class="op">.</span><span class="fu">html</span>(<span class="vs">`min PV: &lt;span id='pv-min-complete-nested'&gt;0&lt;/span&gt;, max PV: &lt;span id='pv-max-complete-nested'&gt;0&lt;/span&gt;`</span>)</span>
<span id="cb5-961"><a href="#cb5-961" aria-hidden="true" tabindex="-1"></a>  chart<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"heatmap-complete-nested"</span>)</span>
<span id="cb5-962"><a href="#cb5-962" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-963"><a href="#cb5-963" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> legendSwatchContainer <span class="op">=</span> chart<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb5-964"><a href="#cb5-964" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"heatmap-legend-complete-nested"</span>)</span>
<span id="cb5-965"><a href="#cb5-965" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"flex"</span>)</span>
<span id="cb5-966"><a href="#cb5-966" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"flex-direction"</span><span class="op">,</span> <span class="st">"column"</span>)</span>
<span id="cb5-967"><a href="#cb5-967" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"align-items"</span><span class="op">,</span> <span class="st">"center"</span>)</span>
<span id="cb5-968"><a href="#cb5-968" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="st">"100%"</span>)<span class="op">;</span></span>
<span id="cb5-969"><a href="#cb5-969" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-970"><a href="#cb5-970" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> legendRange <span class="op">=</span> [</span>
<span id="cb5-971"><a href="#cb5-971" aria-hidden="true" tabindex="-1"></a>    <span class="fl">1.1</span> <span class="op">*</span> d3<span class="op">.</span><span class="fu">min</span>(colorScaleCompleteRange)<span class="op">,</span></span>
<span id="cb5-972"><a href="#cb5-972" aria-hidden="true" tabindex="-1"></a>    <span class="fl">1.1</span> <span class="op">*</span> d3<span class="op">.</span><span class="fu">max</span>(colorScaleCompleteRange)</span>
<span id="cb5-973"><a href="#cb5-973" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb5-974"><a href="#cb5-974" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> stepSize <span class="op">=</span> (legendRange[<span class="dv">1</span>] <span class="op">-</span> legendRange[<span class="dv">0</span>]) <span class="op">/</span> (swatchParams<span class="op">.</span><span class="at">num</span> <span class="op">-</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb5-975"><a href="#cb5-975" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> legendSwatches <span class="op">=</span> d3<span class="op">.</span><span class="fu">range</span>(legendRange[<span class="dv">0</span>]<span class="op">,</span> legendRange[<span class="dv">1</span>] <span class="op">+</span> stepSize<span class="op">,</span> stepSize)<span class="op">;</span></span>
<span id="cb5-976"><a href="#cb5-976" aria-hidden="true" tabindex="-1"></a>  legendSwatches[legendSwatches<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span>] <span class="op">=</span> legendRange[<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb5-977"><a href="#cb5-977" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-978"><a href="#cb5-978" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalLegendWidth <span class="op">=</span> swatchParams<span class="op">.</span><span class="at">width</span> <span class="op">*</span> swatchParams<span class="op">.</span><span class="at">num</span><span class="op">;</span></span>
<span id="cb5-979"><a href="#cb5-979" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-980"><a href="#cb5-980" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> swatchRow <span class="op">=</span> legendSwatchContainer<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb5-981"><a href="#cb5-981" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"flex"</span>)</span>
<span id="cb5-982"><a href="#cb5-982" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"justify-content"</span><span class="op">,</span> <span class="st">"center"</span>)</span>
<span id="cb5-983"><a href="#cb5-983" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="st">"100%"</span>)<span class="op">;</span></span>
<span id="cb5-984"><a href="#cb5-984" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-985"><a href="#cb5-985" aria-hidden="true" tabindex="-1"></a>  swatchRow<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"div"</span>)</span>
<span id="cb5-986"><a href="#cb5-986" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(legendSwatches)</span>
<span id="cb5-987"><a href="#cb5-987" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb5-988"><a href="#cb5-988" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb5-989"><a href="#cb5-989" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>swatchParams<span class="op">.</span><span class="at">width</span><span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb5-990"><a href="#cb5-990" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"height"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>swatchParams<span class="op">.</span><span class="at">height</span><span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb5-991"><a href="#cb5-991" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"background-color"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">colorScaleComplete</span>(d))<span class="op">;</span></span>
<span id="cb5-992"><a href="#cb5-992" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-993"><a href="#cb5-993" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> labelRow <span class="op">=</span> legendSwatchContainer<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb5-994"><a href="#cb5-994" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"flex"</span>)</span>
<span id="cb5-995"><a href="#cb5-995" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"justify-content"</span><span class="op">,</span> <span class="st">"center"</span>)</span>
<span id="cb5-996"><a href="#cb5-996" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>totalLegendWidth<span class="sc">}</span><span class="vs">px`</span>)<span class="op">;</span></span>
<span id="cb5-997"><a href="#cb5-997" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-998"><a href="#cb5-998" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-999"><a href="#cb5-999" aria-hidden="true" tabindex="-1"></a>  labelRow<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"span"</span>)</span>
<span id="cb5-1000"><a href="#cb5-1000" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(colorScaleCompleteRange)</span>
<span id="cb5-1001"><a href="#cb5-1001" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb5-1002"><a href="#cb5-1002" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"span"</span>)</span>
<span id="cb5-1003"><a href="#cb5-1003" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb5-1004"><a href="#cb5-1004" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (d <span class="op">===</span> d3<span class="op">.</span><span class="fu">min</span>(colorScaleCompleteRange)) {</span>
<span id="cb5-1005"><a href="#cb5-1005" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> d <span class="op">+</span> <span class="st">" &lt;="</span><span class="op">;</span></span>
<span id="cb5-1006"><a href="#cb5-1006" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (d <span class="op">===</span> d3<span class="op">.</span><span class="fu">max</span>(colorScaleCompleteRange)) {</span>
<span id="cb5-1007"><a href="#cb5-1007" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"&gt;= "</span> <span class="op">+</span> d<span class="op">;</span></span>
<span id="cb5-1008"><a href="#cb5-1008" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-1009"><a href="#cb5-1009" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> d<span class="op">;</span></span>
<span id="cb5-1010"><a href="#cb5-1010" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-1011"><a href="#cb5-1011" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"flex"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">"1"</span> <span class="op">:</span> <span class="kw">null</span>)</span>
<span id="cb5-1012"><a href="#cb5-1012" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"text-align"</span><span class="op">,</span> <span class="st">"center"</span>)</span>
<span id="cb5-1013"><a href="#cb5-1013" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-1014"><a href="#cb5-1014" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> chart<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb5-1015"><a href="#cb5-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1016"><a href="#cb5-1016" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-ojs-cell-5" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div id="ojs-cell-5" data-nodetype="expression">

</div>
<figcaption class="figure-caption">Figure&nbsp;3: A heatmap showing the possession value (PV) of a typical successful pass from the hover spot to all areas on the pitch. The highest and lowest PV values across all end points associated with a completed pass from the hover point is shown above the pitch.</figcaption>
</figure>
</div>
</div>
<div class="cell">
<details class="hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb6" data-startfrom="1022" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1021;"><span id="cb6-1022"><a href="#cb6-1022" aria-hidden="true" tabindex="-1"></a>{  </span>
<span id="cb6-1023"><a href="#cb6-1023" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> heatmap_complete_nested <span class="op">=</span> d3_soccer<span class="op">.</span><span class="fu">heatmap</span>(pitch)</span>
<span id="cb6-1024"><a href="#cb6-1024" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">colorScale</span>(d3<span class="op">.</span><span class="fu">scaleLinear</span>()<span class="op">.</span><span class="fu">domain</span>([<span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span>])<span class="op">.</span><span class="fu">range</span>([<span class="st">"white"</span><span class="op">,</span> <span class="st">"white"</span>]))</span>
<span id="cb6-1025"><a href="#cb6-1025" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enableInteraction</span>(<span class="kw">true</span>)</span>
<span id="cb6-1026"><a href="#cb6-1026" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">onSelect</span>((x<span class="op">,</span> y<span class="op">,</span> v) <span class="kw">=&gt;</span> {</span>
<span id="cb6-1027"><a href="#cb6-1027" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> rawMinValue <span class="op">=</span> d3<span class="op">.</span><span class="fu">min</span>(v<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">value</span>)<span class="op">;</span></span>
<span id="cb6-1028"><a href="#cb6-1028" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> rawMaxValue <span class="op">=</span> d3<span class="op">.</span><span class="fu">max</span>(v<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">value</span>)<span class="op">;</span></span>
<span id="cb6-1029"><a href="#cb6-1029" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> minValue <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(rawMinValue<span class="op">,</span> <span class="op">-</span><span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb6-1030"><a href="#cb6-1030" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> maxValue <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(rawMaxValue<span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb6-1031"><a href="#cb6-1031" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-1032"><a href="#cb6-1032" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">select</span>(<span class="st">'#pv-min-complete-nested'</span>)<span class="op">.</span><span class="fu">text</span>(minValue<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>))<span class="op">;</span></span>
<span id="cb6-1033"><a href="#cb6-1033" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">select</span>(<span class="st">'#pv-max-complete-nested'</span>)<span class="op">.</span><span class="fu">text</span>(maxValue<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>))<span class="op">;</span></span>
<span id="cb6-1034"><a href="#cb6-1034" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> cells <span class="op">=</span> d3</span>
<span id="cb6-1035"><a href="#cb6-1035" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">select</span>(<span class="st">"#heatmap-complete-nested"</span>)</span>
<span id="cb6-1036"><a href="#cb6-1036" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"rect.cell"</span>)</span>
<span id="cb6-1037"><a href="#cb6-1037" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">data</span>(v)</span>
<span id="cb6-1038"><a href="#cb6-1038" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-1039"><a href="#cb6-1039" aria-hidden="true" tabindex="-1"></a>      cells<span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb6-1040"><a href="#cb6-1040" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">merge</span>(cells) <span class="co">// Merge enter and update selections</span></span>
<span id="cb6-1041"><a href="#cb6-1041" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x</span>)</span>
<span id="cb6-1042"><a href="#cb6-1042" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">y</span>)</span>
<span id="cb6-1043"><a href="#cb6-1043" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">width</span>)</span>
<span id="cb6-1044"><a href="#cb6-1044" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">height</span>)</span>
<span id="cb6-1045"><a href="#cb6-1045" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">colorScaleComplete</span>(<span class="op">+</span>d<span class="op">.</span><span class="at">value</span>))<span class="op">;</span></span>
<span id="cb6-1046"><a href="#cb6-1046" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-1047"><a href="#cb6-1047" aria-hidden="true" tabindex="-1"></a>      cells<span class="op">.</span><span class="fu">exit</span>()<span class="op">.</span><span class="fu">remove</span>()</span>
<span id="cb6-1048"><a href="#cb6-1048" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-1049"><a href="#cb6-1049" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">select</span>(<span class="st">"#heatmap-complete-nested"</span>)<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"rect.cell"</span>)<span class="op">.</span><span class="fu">data</span>(complete_nested_pv_data)</span>
<span id="cb6-1050"><a href="#cb6-1050" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb6-1051"><a href="#cb6-1051" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">parent_el</span>(<span class="st">"#heatmap-complete-nested"</span>)</span>
<span id="cb6-1052"><a href="#cb6-1052" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">interpolate</span>(<span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb6-1053"><a href="#cb6-1053" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-1054"><a href="#cb6-1054" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(<span class="st">"#heatmap-complete-nested"</span>)<span class="op">.</span><span class="fu">html</span>(<span class="st">""</span>)<span class="op">.</span><span class="fu">datum</span>(complete_nested_pv_data)<span class="op">.</span><span class="fu">call</span>(heatmap_complete_nested)<span class="op">;</span></span>
<span id="cb6-1055"><a href="#cb6-1055" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-6" data-nodetype="expression">

</div>
</div>
</div>
<p>There are several take-aways one might make from this view.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> The one I see is that as you move your mouse (i.e.&nbsp;the starting point of the pass) from the defender’s box to the opponent’s box, the consolidate green box of +0.025 PV doesn’t change much. It stays basically at around the final quarter of the pitch. So you can’t just complete a 25 yard pass from the top of your own box progressing the ball towards the middle of the pitch and expect to get anywhere near the same PV as completing a 25 yard pass from the center of the pitch to near the opponent’s 18-yard box. The end point really matters.</p>
</section>
</section>
<section id="unsuccessful-passes" class="level2">
<h2 class="anchored" data-anchor-id="unsuccessful-passes">Unsuccessful Passes</h2>
<section id="from-the-center-spot-to-anywhere-on-the-pitch-1" class="level3">
<h3 class="anchored" data-anchor-id="from-the-center-spot-to-anywhere-on-the-pitch-1">From the Center Spot, To Anywhere on the Pitch</h3>
<p>Now, the more interesting side of things–how does the PV heatmap look for incomplete passes? Let’s start with an example again, looking at PV for unsuccessful passes from the center spot.</p>
<div class="cell" data-include="true">
<details class="hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb7" data-startfrom="1071" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1070;"><span id="cb7-1071"><a href="#cb7-1071" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb7-1072"><a href="#cb7-1072" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> chart <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"div"</span>)</span>
<span id="cb7-1073"><a href="#cb7-1073" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> title <span class="op">=</span> chart<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"heatmap-title-incomplete"</span>)</span>
<span id="cb7-1074"><a href="#cb7-1074" aria-hidden="true" tabindex="-1"></a>  title<span class="op">.</span><span class="fu">append</span>(<span class="st">"p"</span>)<span class="op">.</span><span class="fu">html</span>(<span class="vs">`PV: &lt;span id='pv-value-incomplete'&gt;0&lt;/span&gt;`</span>)</span>
<span id="cb7-1075"><a href="#cb7-1075" aria-hidden="true" tabindex="-1"></a>  chart<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"heatmap-incomplete"</span>)</span>
<span id="cb7-1076"><a href="#cb7-1076" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-1077"><a href="#cb7-1077" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> legendSwatchContainer <span class="op">=</span> chart<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb7-1078"><a href="#cb7-1078" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"heatmap-legend-incomplete"</span>)</span>
<span id="cb7-1079"><a href="#cb7-1079" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"flex"</span>)</span>
<span id="cb7-1080"><a href="#cb7-1080" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"flex-direction"</span><span class="op">,</span> <span class="st">"column"</span>)</span>
<span id="cb7-1081"><a href="#cb7-1081" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"align-items"</span><span class="op">,</span> <span class="st">"center"</span>)</span>
<span id="cb7-1082"><a href="#cb7-1082" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="st">"100%"</span>)<span class="op">;</span></span>
<span id="cb7-1083"><a href="#cb7-1083" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-1084"><a href="#cb7-1084" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> legendRange <span class="op">=</span> [</span>
<span id="cb7-1085"><a href="#cb7-1085" aria-hidden="true" tabindex="-1"></a>    <span class="fl">1.1</span> <span class="op">*</span> d3<span class="op">.</span><span class="fu">min</span>(colorScaleIncompleteRange)<span class="op">,</span></span>
<span id="cb7-1086"><a href="#cb7-1086" aria-hidden="true" tabindex="-1"></a>    <span class="fl">1.1</span> <span class="op">*</span> d3<span class="op">.</span><span class="fu">max</span>(colorScaleIncompleteRange)</span>
<span id="cb7-1087"><a href="#cb7-1087" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb7-1088"><a href="#cb7-1088" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> stepSize <span class="op">=</span> (legendRange[<span class="dv">1</span>] <span class="op">-</span> legendRange[<span class="dv">0</span>]) <span class="op">/</span> (swatchParams<span class="op">.</span><span class="at">num</span> <span class="op">-</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb7-1089"><a href="#cb7-1089" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> legendSwatches <span class="op">=</span> d3<span class="op">.</span><span class="fu">range</span>(legendRange[<span class="dv">0</span>]<span class="op">,</span> legendRange[<span class="dv">1</span>] <span class="op">+</span> stepSize<span class="op">,</span> stepSize)<span class="op">;</span></span>
<span id="cb7-1090"><a href="#cb7-1090" aria-hidden="true" tabindex="-1"></a>  legendSwatches[legendSwatches<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span>] <span class="op">=</span> legendRange[<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb7-1091"><a href="#cb7-1091" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-1092"><a href="#cb7-1092" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalLegendWidth <span class="op">=</span> swatchParams<span class="op">.</span><span class="at">width</span> <span class="op">*</span> swatchParams<span class="op">.</span><span class="at">num</span><span class="op">;</span></span>
<span id="cb7-1093"><a href="#cb7-1093" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-1094"><a href="#cb7-1094" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> swatchRow <span class="op">=</span> legendSwatchContainer<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb7-1095"><a href="#cb7-1095" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"flex"</span>)</span>
<span id="cb7-1096"><a href="#cb7-1096" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"justify-content"</span><span class="op">,</span> <span class="st">"center"</span>)</span>
<span id="cb7-1097"><a href="#cb7-1097" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="st">"100%"</span>)<span class="op">;</span></span>
<span id="cb7-1098"><a href="#cb7-1098" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-1099"><a href="#cb7-1099" aria-hidden="true" tabindex="-1"></a>  swatchRow<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"div"</span>)</span>
<span id="cb7-1100"><a href="#cb7-1100" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(legendSwatches)</span>
<span id="cb7-1101"><a href="#cb7-1101" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb7-1102"><a href="#cb7-1102" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb7-1103"><a href="#cb7-1103" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>swatchParams<span class="op">.</span><span class="at">width</span><span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb7-1104"><a href="#cb7-1104" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"height"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>swatchParams<span class="op">.</span><span class="at">height</span><span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb7-1105"><a href="#cb7-1105" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"background-color"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">colorScaleIncomplete</span>(d))<span class="op">;</span></span>
<span id="cb7-1106"><a href="#cb7-1106" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-1107"><a href="#cb7-1107" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-1108"><a href="#cb7-1108" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> labelRow <span class="op">=</span> legendSwatchContainer<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb7-1109"><a href="#cb7-1109" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"flex"</span>)</span>
<span id="cb7-1110"><a href="#cb7-1110" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"justify-content"</span><span class="op">,</span> <span class="st">"center"</span>)</span>
<span id="cb7-1111"><a href="#cb7-1111" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>totalLegendWidth<span class="sc">}</span><span class="vs">px`</span>)<span class="op">;</span></span>
<span id="cb7-1112"><a href="#cb7-1112" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-1113"><a href="#cb7-1113" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-1114"><a href="#cb7-1114" aria-hidden="true" tabindex="-1"></a>  labelRow<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"span"</span>)</span>
<span id="cb7-1115"><a href="#cb7-1115" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(colorScaleIncompleteRange)</span>
<span id="cb7-1116"><a href="#cb7-1116" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb7-1117"><a href="#cb7-1117" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"span"</span>)</span>
<span id="cb7-1118"><a href="#cb7-1118" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb7-1119"><a href="#cb7-1119" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (d <span class="op">===</span> d3<span class="op">.</span><span class="fu">min</span>(colorScaleIncompleteRange)) {</span>
<span id="cb7-1120"><a href="#cb7-1120" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> d <span class="op">+</span> <span class="st">" &lt;="</span><span class="op">;</span></span>
<span id="cb7-1121"><a href="#cb7-1121" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (d <span class="op">===</span> d3<span class="op">.</span><span class="fu">max</span>(colorScaleIncompleteRange)) {</span>
<span id="cb7-1122"><a href="#cb7-1122" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"&gt;= "</span> <span class="op">+</span> d<span class="op">;</span></span>
<span id="cb7-1123"><a href="#cb7-1123" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb7-1124"><a href="#cb7-1124" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> d<span class="op">;</span></span>
<span id="cb7-1125"><a href="#cb7-1125" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb7-1126"><a href="#cb7-1126" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"flex"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">"1"</span> <span class="op">:</span> <span class="kw">null</span>)</span>
<span id="cb7-1127"><a href="#cb7-1127" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"text-align"</span><span class="op">,</span> <span class="st">"center"</span>)</span>
<span id="cb7-1128"><a href="#cb7-1128" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-1129"><a href="#cb7-1129" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> chart<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb7-1130"><a href="#cb7-1130" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-ojs-cell-7" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div id="ojs-cell-7" data-nodetype="expression">

</div>
<figcaption class="figure-caption">Figure&nbsp;4: A heatmap showing the possession value (PV) of a typical unsuccessful pass from roughly the center spot (annotated in blue) to all areas on the pitch. The exact PV value associated with an unsuccessful pass ending at the hover point can be viewed above the pitch.</figcaption>
</figure>
</div>
</div>
<div class="cell">
<details class="hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb8" data-startfrom="1136" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1135;"><span id="cb8-1136"><a href="#cb8-1136" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb8-1137"><a href="#cb8-1137" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> heatmap_incomplete <span class="op">=</span> d3_soccer<span class="op">.</span><span class="fu">heatmap</span>(pitch)</span>
<span id="cb8-1138"><a href="#cb8-1138" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">colorScale</span>(colorScaleIncomplete)</span>
<span id="cb8-1139"><a href="#cb8-1139" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enableInteraction</span>(<span class="kw">true</span>)</span>
<span id="cb8-1140"><a href="#cb8-1140" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">onSelect</span>((x<span class="op">,</span> y<span class="op">,</span> v) <span class="kw">=&gt;</span> {</span>
<span id="cb8-1141"><a href="#cb8-1141" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> cappedValue <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(v<span class="op">,</span> <span class="op">-</span><span class="dv">1</span>)<span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb8-1142"><a href="#cb8-1142" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">select</span>(<span class="st">'#pv-value-incomplete'</span>)<span class="op">.</span><span class="fu">text</span>(cappedValue<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>))<span class="op">;</span></span>
<span id="cb8-1143"><a href="#cb8-1143" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb8-1144"><a href="#cb8-1144" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">parent_el</span>(<span class="st">"#heatmap-incomplete"</span>)</span>
<span id="cb8-1145"><a href="#cb8-1145" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">interpolate</span>(<span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb8-1146"><a href="#cb8-1146" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1147"><a href="#cb8-1147" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(<span class="st">"#heatmap-incomplete"</span>)<span class="op">.</span><span class="fu">html</span>(<span class="st">""</span>)<span class="op">.</span><span class="fu">datum</span>(incomplete_pv_data)<span class="op">.</span><span class="fu">call</span>(heatmap_incomplete)<span class="op">;</span></span>
<span id="cb8-1148"><a href="#cb8-1148" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1149"><a href="#cb8-1149" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3<span class="op">.</span><span class="fu">select</span>(<span class="st">"#heatmap-incomplete"</span>)<span class="op">.</span><span class="fu">select</span>(<span class="st">"svg"</span>)<span class="op">;</span></span>
<span id="cb8-1150"><a href="#cb8-1150" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1151"><a href="#cb8-1151" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb8-1152"><a href="#cb8-1152" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> passStartParams<span class="op">.</span><span class="at">x</span>)</span>
<span id="cb8-1153"><a href="#cb8-1153" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> passStartParams<span class="op">.</span><span class="at">y</span>)</span>
<span id="cb8-1154"><a href="#cb8-1154" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> tileParams<span class="op">.</span><span class="at">width</span>)</span>
<span id="cb8-1155"><a href="#cb8-1155" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> tileParams<span class="op">.</span><span class="at">height</span>)</span>
<span id="cb8-1156"><a href="#cb8-1156" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"blue"</span>)</span>
<span id="cb8-1157"><a href="#cb8-1157" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb8-1158"><a href="#cb8-1158" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="st">"1px"</span>)<span class="op">;</span></span>
<span id="cb8-1159"><a href="#cb8-1159" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-8" data-nodetype="expression">

</div>
</div>
</div>
<p>I think this grid is actually fairly intuitive. Incomplete passes backwards have fairly negative PVs, as those are leading to turnovers probably setting up the opponent for a good scoring opportunity. Incomplete passes forward mostly have neutral PVs, with some notable spots on the pitch having non-trivially positive PVs.</p>
<p>Some of those exceptions include the top of the 18-yard-box (i.e.&nbsp;<a href="https://www.youtube.com/watch?v=_EFtACGzD7E">“zone 14”</a>), where a loss of possession can actually be advantageous, as it leaves the opponent likely in a vulnerable position. You could also infer that the “risk” of losing possession to passes to zone 14 is justified from the potential to take a shot. The other observable positive PV end-points for passes taken from the center of the pitch are the goal lines on the ends of the 18-yard box. We could deduce that passes to those areas often lead to cutback passes to the front of the goal, which often lead to high-converting shots. So again, the PV model seems to indicate that the “lost opportunity” of such a (failed) pass seems worth it, on average.</p>
<section id="empirical-average-pv-1" class="level4">
<h4 class="anchored" data-anchor-id="empirical-average-pv-1">Empirical average PV</h4>
<div class="cell" data-include="true">
<details class="hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb9" data-startfrom="1171" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1170;"><span id="cb9-1171"><a href="#cb9-1171" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb9-1172"><a href="#cb9-1172" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> chart <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"div"</span>)</span>
<span id="cb9-1173"><a href="#cb9-1173" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> title <span class="op">=</span> chart<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"heatmap-title-incomplete-empirical"</span>)</span>
<span id="cb9-1174"><a href="#cb9-1174" aria-hidden="true" tabindex="-1"></a>  title<span class="op">.</span><span class="fu">append</span>(<span class="st">"p"</span>)<span class="op">.</span><span class="fu">html</span>(<span class="vs">`PV: &lt;span id='pv-value-incomplete-empirical'&gt;0&lt;/span&gt;`</span>)</span>
<span id="cb9-1175"><a href="#cb9-1175" aria-hidden="true" tabindex="-1"></a>  chart<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"heatmap-incomplete-empirical"</span>)</span>
<span id="cb9-1176"><a href="#cb9-1176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1177"><a href="#cb9-1177" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> legendSwatchContainer <span class="op">=</span> chart<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb9-1178"><a href="#cb9-1178" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"heatmap-legend-incomplete-empirical"</span>)</span>
<span id="cb9-1179"><a href="#cb9-1179" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"flex"</span>)</span>
<span id="cb9-1180"><a href="#cb9-1180" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"flex-direction"</span><span class="op">,</span> <span class="st">"column"</span>)</span>
<span id="cb9-1181"><a href="#cb9-1181" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"align-items"</span><span class="op">,</span> <span class="st">"center"</span>)</span>
<span id="cb9-1182"><a href="#cb9-1182" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="st">"100%"</span>)<span class="op">;</span></span>
<span id="cb9-1183"><a href="#cb9-1183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1184"><a href="#cb9-1184" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> legendRange <span class="op">=</span> [</span>
<span id="cb9-1185"><a href="#cb9-1185" aria-hidden="true" tabindex="-1"></a>    <span class="fl">1.1</span> <span class="op">*</span> d3<span class="op">.</span><span class="fu">min</span>(colorScaleIncompleteRange)<span class="op">,</span></span>
<span id="cb9-1186"><a href="#cb9-1186" aria-hidden="true" tabindex="-1"></a>    <span class="fl">1.1</span> <span class="op">*</span> d3<span class="op">.</span><span class="fu">max</span>(colorScaleIncompleteRange)</span>
<span id="cb9-1187"><a href="#cb9-1187" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb9-1188"><a href="#cb9-1188" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> stepSize <span class="op">=</span> (legendRange[<span class="dv">1</span>] <span class="op">-</span> legendRange[<span class="dv">0</span>]) <span class="op">/</span> (swatchParams<span class="op">.</span><span class="at">num</span> <span class="op">-</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb9-1189"><a href="#cb9-1189" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> legendSwatches <span class="op">=</span> d3<span class="op">.</span><span class="fu">range</span>(legendRange[<span class="dv">0</span>]<span class="op">,</span> legendRange[<span class="dv">1</span>] <span class="op">+</span> stepSize<span class="op">,</span> stepSize)<span class="op">;</span></span>
<span id="cb9-1190"><a href="#cb9-1190" aria-hidden="true" tabindex="-1"></a>  legendSwatches[legendSwatches<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span>] <span class="op">=</span> legendRange[<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb9-1191"><a href="#cb9-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1192"><a href="#cb9-1192" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalLegendWidth <span class="op">=</span> swatchParams<span class="op">.</span><span class="at">width</span> <span class="op">*</span> swatchParams<span class="op">.</span><span class="at">num</span><span class="op">;</span></span>
<span id="cb9-1193"><a href="#cb9-1193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1194"><a href="#cb9-1194" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> swatchRow <span class="op">=</span> legendSwatchContainer<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb9-1195"><a href="#cb9-1195" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"flex"</span>)</span>
<span id="cb9-1196"><a href="#cb9-1196" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"justify-content"</span><span class="op">,</span> <span class="st">"center"</span>)</span>
<span id="cb9-1197"><a href="#cb9-1197" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="st">"100%"</span>)<span class="op">;</span></span>
<span id="cb9-1198"><a href="#cb9-1198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1199"><a href="#cb9-1199" aria-hidden="true" tabindex="-1"></a>  swatchRow<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"div"</span>)</span>
<span id="cb9-1200"><a href="#cb9-1200" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(legendSwatches)</span>
<span id="cb9-1201"><a href="#cb9-1201" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb9-1202"><a href="#cb9-1202" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb9-1203"><a href="#cb9-1203" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>swatchParams<span class="op">.</span><span class="at">width</span><span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb9-1204"><a href="#cb9-1204" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"height"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>swatchParams<span class="op">.</span><span class="at">height</span><span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb9-1205"><a href="#cb9-1205" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"background-color"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">colorScaleIncomplete</span>(d))<span class="op">;</span></span>
<span id="cb9-1206"><a href="#cb9-1206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1207"><a href="#cb9-1207" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> labelRow <span class="op">=</span> legendSwatchContainer<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb9-1208"><a href="#cb9-1208" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"flex"</span>)</span>
<span id="cb9-1209"><a href="#cb9-1209" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"justify-content"</span><span class="op">,</span> <span class="st">"center"</span>)</span>
<span id="cb9-1210"><a href="#cb9-1210" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>totalLegendWidth<span class="sc">}</span><span class="vs">px`</span>)<span class="op">;</span></span>
<span id="cb9-1211"><a href="#cb9-1211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1212"><a href="#cb9-1212" aria-hidden="true" tabindex="-1"></a>  labelRow<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"span"</span>)</span>
<span id="cb9-1213"><a href="#cb9-1213" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(colorScaleIncompleteRange)</span>
<span id="cb9-1214"><a href="#cb9-1214" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb9-1215"><a href="#cb9-1215" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"span"</span>)</span>
<span id="cb9-1216"><a href="#cb9-1216" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb9-1217"><a href="#cb9-1217" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (d <span class="op">===</span> d3<span class="op">.</span><span class="fu">min</span>(colorScaleIncompleteRange)) {</span>
<span id="cb9-1218"><a href="#cb9-1218" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> d <span class="op">+</span> <span class="st">" &lt;="</span><span class="op">;</span></span>
<span id="cb9-1219"><a href="#cb9-1219" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (d <span class="op">===</span> d3<span class="op">.</span><span class="fu">max</span>(colorScaleIncompleteRange)) {</span>
<span id="cb9-1220"><a href="#cb9-1220" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"&gt;= "</span> <span class="op">+</span> d<span class="op">;</span></span>
<span id="cb9-1221"><a href="#cb9-1221" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb9-1222"><a href="#cb9-1222" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> d<span class="op">;</span></span>
<span id="cb9-1223"><a href="#cb9-1223" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb9-1224"><a href="#cb9-1224" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"flex"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">"1"</span> <span class="op">:</span> <span class="kw">null</span>)</span>
<span id="cb9-1225"><a href="#cb9-1225" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"text-align"</span><span class="op">,</span> <span class="st">"center"</span>)</span>
<span id="cb9-1226"><a href="#cb9-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-1227"><a href="#cb9-1227" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> chart<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb9-1228"><a href="#cb9-1228" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-ojs-cell-9" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div id="ojs-cell-9" data-nodetype="expression">

</div>
<figcaption class="figure-caption">Figure&nbsp;5: A heatmap showing the average possession value (PV) of empirical unsuccessful passes from the center spot (annotated in blue) to all areas of the pitch. The relative frequency of incomplete passes from the center spot to each other cell is shown as a percentage. The exact PV value associated with an unsuccessful pass ending at the hover point can be viewed above the pitch.</figcaption>
</figure>
</div>
</div>
<div class="cell">
<details class="hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb10" data-startfrom="1234" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1233;"><span id="cb10-1234"><a href="#cb10-1234" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb10-1235"><a href="#cb10-1235" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> heatmap_incomplete_empirical <span class="op">=</span> d3_soccer<span class="op">.</span><span class="fu">heatmap</span>(pitch)</span>
<span id="cb10-1236"><a href="#cb10-1236" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">colorScale</span>(colorScaleIncomplete)</span>
<span id="cb10-1237"><a href="#cb10-1237" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enableInteraction</span>(<span class="kw">true</span>)</span>
<span id="cb10-1238"><a href="#cb10-1238" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">onSelect</span>((x<span class="op">,</span> y<span class="op">,</span> v) <span class="kw">=&gt;</span> {</span>
<span id="cb10-1239"><a href="#cb10-1239" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> cappedValue <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(v<span class="op">,</span> <span class="op">-</span><span class="dv">1</span>)<span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb10-1240"><a href="#cb10-1240" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">select</span>(<span class="st">"#pv-value-incomplete-empirical"</span>)<span class="op">.</span><span class="fu">text</span>(cappedValue<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>))<span class="op">;</span></span>
<span id="cb10-1241"><a href="#cb10-1241" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb10-1242"><a href="#cb10-1242" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">parent_el</span>(<span class="st">"#heatmap-incomplete-empirical"</span>)</span>
<span id="cb10-1243"><a href="#cb10-1243" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">interpolate</span>(<span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb10-1244"><a href="#cb10-1244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1245"><a href="#cb10-1245" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(<span class="st">"#heatmap-incomplete-empirical"</span>)<span class="op">.</span><span class="fu">html</span>(<span class="st">""</span>)<span class="op">.</span><span class="fu">datum</span>(incomplete_actual_pv_data)<span class="op">.</span><span class="fu">call</span>(heatmap_incomplete_empirical)<span class="op">;</span></span>
<span id="cb10-1246"><a href="#cb10-1246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1247"><a href="#cb10-1247" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3<span class="op">.</span><span class="fu">select</span>(<span class="st">"#heatmap-incomplete-empirical"</span>)<span class="op">.</span><span class="fu">select</span>(<span class="st">"svg"</span>)<span class="op">;</span></span>
<span id="cb10-1248"><a href="#cb10-1248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1249"><a href="#cb10-1249" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cells <span class="op">=</span> svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".cell"</span>)<span class="op">;</span></span>
<span id="cb10-1250"><a href="#cb10-1250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1251"><a href="#cb10-1251" aria-hidden="true" tabindex="-1"></a>  cells<span class="op">.</span><span class="fu">each</span>(<span class="kw">function</span>(d<span class="op">,</span> i) {</span>
<span id="cb10-1252"><a href="#cb10-1252" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cell <span class="op">=</span> d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span>)<span class="op">;</span></span>
<span id="cb10-1253"><a href="#cb10-1253" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> bbox <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getBBox</span>()<span class="op">;</span></span>
<span id="cb10-1254"><a href="#cb10-1254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1255"><a href="#cb10-1255" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span><span class="op">.</span><span class="at">parentNode</span>)</span>
<span id="cb10-1256"><a href="#cb10-1256" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb10-1257"><a href="#cb10-1257" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> bbox<span class="op">.</span><span class="at">x</span> <span class="op">+</span> bbox<span class="op">.</span><span class="at">width</span> <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb10-1258"><a href="#cb10-1258" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> bbox<span class="op">.</span><span class="at">y</span> <span class="op">+</span> bbox<span class="op">.</span><span class="at">height</span> <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb10-1259"><a href="#cb10-1259" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb10-1260"><a href="#cb10-1260" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"alignment-baseline"</span><span class="op">,</span> <span class="st">"central"</span>)</span>
<span id="cb10-1261"><a href="#cb10-1261" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"2.5px"</span>)</span>
<span id="cb10-1262"><a href="#cb10-1262" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"pointer-events"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb10-1263"><a href="#cb10-1263" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>((d<span class="op">.</span><span class="at">prop</span> <span class="op">*</span> <span class="dv">100</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>) <span class="op">+</span> <span class="st">"%"</span>)<span class="op">;</span></span>
<span id="cb10-1264"><a href="#cb10-1264" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb10-1265"><a href="#cb10-1265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1266"><a href="#cb10-1266" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb10-1267"><a href="#cb10-1267" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> passStartParams<span class="op">.</span><span class="at">x</span>)</span>
<span id="cb10-1268"><a href="#cb10-1268" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> passStartParams<span class="op">.</span><span class="at">y</span>)</span>
<span id="cb10-1269"><a href="#cb10-1269" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> tileParams<span class="op">.</span><span class="at">width</span>)</span>
<span id="cb10-1270"><a href="#cb10-1270" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> tileParams<span class="op">.</span><span class="at">height</span>)</span>
<span id="cb10-1271"><a href="#cb10-1271" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"blue"</span>)</span>
<span id="cb10-1272"><a href="#cb10-1272" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb10-1273"><a href="#cb10-1273" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="st">"1px"</span>)<span class="op">;</span></span>
<span id="cb10-1274"><a href="#cb10-1274" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-10" data-nodetype="expression">

</div>
</div>
</div>
</section>
</section>
<section id="from-anywhere-on-the-pitch-to-anywhere-on-the-pitch-1" class="level3">
<h3 class="anchored" data-anchor-id="from-anywhere-on-the-pitch-to-anywhere-on-the-pitch-1">From Anywhere on the Pitch, To Anywhere on the Pitch</h3>
<p>Now lets scale up our pass PV grid to all incomplete passes. Hovering over a tile will show PV associated with unsuccessful passes from that point on the pitch.</p>
<div class="cell" data-include="true">
<details class="hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb11" data-startfrom="1284" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1283;"><span id="cb11-1284"><a href="#cb11-1284" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb11-1285"><a href="#cb11-1285" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> chart <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"div"</span>)</span>
<span id="cb11-1286"><a href="#cb11-1286" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> title <span class="op">=</span> chart<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"heatmap-title-incomplete-nested"</span>)</span>
<span id="cb11-1287"><a href="#cb11-1287" aria-hidden="true" tabindex="-1"></a>  title<span class="op">.</span><span class="fu">append</span>(<span class="st">"p"</span>)<span class="op">.</span><span class="fu">html</span>(<span class="vs">`min PV: &lt;span id='pv-min-incomplete-nested'&gt;0&lt;/span&gt;, max PV: &lt;span id='pv-max-incomplete-nested'&gt;0&lt;/span&gt;`</span>)</span>
<span id="cb11-1288"><a href="#cb11-1288" aria-hidden="true" tabindex="-1"></a>  chart<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"heatmap-incomplete-nested"</span>)</span>
<span id="cb11-1289"><a href="#cb11-1289" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-1290"><a href="#cb11-1290" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> legendSwatchContainer <span class="op">=</span> chart<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb11-1291"><a href="#cb11-1291" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"heatmap-legend-incomplete-nested"</span>)</span>
<span id="cb11-1292"><a href="#cb11-1292" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"flex"</span>)</span>
<span id="cb11-1293"><a href="#cb11-1293" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"flex-direction"</span><span class="op">,</span> <span class="st">"column"</span>)</span>
<span id="cb11-1294"><a href="#cb11-1294" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"align-items"</span><span class="op">,</span> <span class="st">"center"</span>)</span>
<span id="cb11-1295"><a href="#cb11-1295" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="st">"100%"</span>)<span class="op">;</span></span>
<span id="cb11-1296"><a href="#cb11-1296" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-1297"><a href="#cb11-1297" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> legendRange <span class="op">=</span> [</span>
<span id="cb11-1298"><a href="#cb11-1298" aria-hidden="true" tabindex="-1"></a>    <span class="fl">1.1</span> <span class="op">*</span> d3<span class="op">.</span><span class="fu">min</span>(colorScaleIncompleteRange)<span class="op">,</span></span>
<span id="cb11-1299"><a href="#cb11-1299" aria-hidden="true" tabindex="-1"></a>    <span class="fl">1.1</span> <span class="op">*</span> d3<span class="op">.</span><span class="fu">max</span>(colorScaleIncompleteRange)</span>
<span id="cb11-1300"><a href="#cb11-1300" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb11-1301"><a href="#cb11-1301" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> stepSize <span class="op">=</span> (legendRange[<span class="dv">1</span>] <span class="op">-</span> legendRange[<span class="dv">0</span>]) <span class="op">/</span> (swatchParams<span class="op">.</span><span class="at">num</span> <span class="op">-</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb11-1302"><a href="#cb11-1302" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> legendSwatches <span class="op">=</span> d3<span class="op">.</span><span class="fu">range</span>(legendRange[<span class="dv">0</span>]<span class="op">,</span> legendRange[<span class="dv">1</span>] <span class="op">+</span> stepSize<span class="op">,</span> stepSize)<span class="op">;</span></span>
<span id="cb11-1303"><a href="#cb11-1303" aria-hidden="true" tabindex="-1"></a>  legendSwatches[legendSwatches<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span>] <span class="op">=</span> legendRange[<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb11-1304"><a href="#cb11-1304" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-1305"><a href="#cb11-1305" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalLegendWidth <span class="op">=</span> swatchParams<span class="op">.</span><span class="at">width</span> <span class="op">*</span> swatchParams<span class="op">.</span><span class="at">num</span><span class="op">;</span></span>
<span id="cb11-1306"><a href="#cb11-1306" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-1307"><a href="#cb11-1307" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-1308"><a href="#cb11-1308" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> swatchRow <span class="op">=</span> legendSwatchContainer<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb11-1309"><a href="#cb11-1309" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"flex"</span>)</span>
<span id="cb11-1310"><a href="#cb11-1310" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"justify-content"</span><span class="op">,</span> <span class="st">"center"</span>)</span>
<span id="cb11-1311"><a href="#cb11-1311" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="st">"100%"</span>)<span class="op">;</span></span>
<span id="cb11-1312"><a href="#cb11-1312" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-1313"><a href="#cb11-1313" aria-hidden="true" tabindex="-1"></a>  swatchRow<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"div"</span>)</span>
<span id="cb11-1314"><a href="#cb11-1314" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(legendSwatches)</span>
<span id="cb11-1315"><a href="#cb11-1315" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb11-1316"><a href="#cb11-1316" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb11-1317"><a href="#cb11-1317" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>swatchParams<span class="op">.</span><span class="at">width</span><span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb11-1318"><a href="#cb11-1318" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"height"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>swatchParams<span class="op">.</span><span class="at">height</span><span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb11-1319"><a href="#cb11-1319" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"background-color"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">colorScaleIncomplete</span>(d))<span class="op">;</span></span>
<span id="cb11-1320"><a href="#cb11-1320" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-1321"><a href="#cb11-1321" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> labelRow <span class="op">=</span> legendSwatchContainer<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb11-1322"><a href="#cb11-1322" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"flex"</span>)</span>
<span id="cb11-1323"><a href="#cb11-1323" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"justify-content"</span><span class="op">,</span> <span class="st">"center"</span>)</span>
<span id="cb11-1324"><a href="#cb11-1324" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>totalLegendWidth<span class="sc">}</span><span class="vs">px`</span>)<span class="op">;</span></span>
<span id="cb11-1325"><a href="#cb11-1325" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-1326"><a href="#cb11-1326" aria-hidden="true" tabindex="-1"></a>  labelRow<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"span"</span>)</span>
<span id="cb11-1327"><a href="#cb11-1327" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(colorScaleIncompleteRange)</span>
<span id="cb11-1328"><a href="#cb11-1328" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb11-1329"><a href="#cb11-1329" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"span"</span>)</span>
<span id="cb11-1330"><a href="#cb11-1330" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb11-1331"><a href="#cb11-1331" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (d <span class="op">===</span> d3<span class="op">.</span><span class="fu">min</span>(colorScaleIncompleteRange)) {</span>
<span id="cb11-1332"><a href="#cb11-1332" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> d <span class="op">+</span> <span class="st">" &lt;="</span><span class="op">;</span></span>
<span id="cb11-1333"><a href="#cb11-1333" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (d <span class="op">===</span> d3<span class="op">.</span><span class="fu">max</span>(colorScaleIncompleteRange)) {</span>
<span id="cb11-1334"><a href="#cb11-1334" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"&gt;= "</span> <span class="op">+</span> d<span class="op">;</span></span>
<span id="cb11-1335"><a href="#cb11-1335" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb11-1336"><a href="#cb11-1336" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> d<span class="op">;</span></span>
<span id="cb11-1337"><a href="#cb11-1337" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb11-1338"><a href="#cb11-1338" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"flex"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">"1"</span> <span class="op">:</span> <span class="kw">null</span>)</span>
<span id="cb11-1339"><a href="#cb11-1339" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"text-align"</span><span class="op">,</span> <span class="st">"center"</span>)</span>
<span id="cb11-1340"><a href="#cb11-1340" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-1341"><a href="#cb11-1341" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> chart<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb11-1342"><a href="#cb11-1342" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-ojs-cell-11" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div id="ojs-cell-11" data-nodetype="expression">

</div>
<figcaption class="figure-caption">Figure&nbsp;6: A heatmap showing the possession value (PV) of an average unsuccessful pass from the hover spot to all areas on the pitch. The highest and lowest PV values across all end points associated with an incomplete pass from the hover point is shown above the pitch.</figcaption>
</figure>
</div>
</div>
<div class="cell">
<details class="hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb12" data-startfrom="1348" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1347;"><span id="cb12-1348"><a href="#cb12-1348" aria-hidden="true" tabindex="-1"></a>{  </span>
<span id="cb12-1349"><a href="#cb12-1349" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> heatmap_incomplete_nested <span class="op">=</span> d3_soccer<span class="op">.</span><span class="fu">heatmap</span>(pitch)</span>
<span id="cb12-1350"><a href="#cb12-1350" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">colorScale</span>(d3<span class="op">.</span><span class="fu">scaleLinear</span>()<span class="op">.</span><span class="fu">domain</span>([<span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span>])<span class="op">.</span><span class="fu">range</span>([<span class="st">"white"</span><span class="op">,</span> <span class="st">"white"</span>]))</span>
<span id="cb12-1351"><a href="#cb12-1351" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enableInteraction</span>(<span class="kw">true</span>)</span>
<span id="cb12-1352"><a href="#cb12-1352" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">onSelect</span>((x<span class="op">,</span> y<span class="op">,</span> v) <span class="kw">=&gt;</span> {</span>
<span id="cb12-1353"><a href="#cb12-1353" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> rawMinValue <span class="op">=</span> d3<span class="op">.</span><span class="fu">min</span>(v<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">value</span>)<span class="op">;</span></span>
<span id="cb12-1354"><a href="#cb12-1354" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> rawMaxValue <span class="op">=</span> d3<span class="op">.</span><span class="fu">max</span>(v<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">value</span>)<span class="op">;</span></span>
<span id="cb12-1355"><a href="#cb12-1355" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> minValue <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(rawMinValue<span class="op">,</span> <span class="op">-</span><span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb12-1356"><a href="#cb12-1356" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> maxValue <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(rawMaxValue<span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb12-1357"><a href="#cb12-1357" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-1358"><a href="#cb12-1358" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">select</span>(<span class="st">'#pv-min-incomplete-nested'</span>)<span class="op">.</span><span class="fu">text</span>(minValue<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>))<span class="op">;</span></span>
<span id="cb12-1359"><a href="#cb12-1359" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">select</span>(<span class="st">'#pv-max-incomplete-nested'</span>)<span class="op">.</span><span class="fu">text</span>(maxValue<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>))<span class="op">;</span></span>
<span id="cb12-1360"><a href="#cb12-1360" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> cells <span class="op">=</span> d3</span>
<span id="cb12-1361"><a href="#cb12-1361" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">select</span>(<span class="st">"#heatmap-incomplete-nested"</span>)</span>
<span id="cb12-1362"><a href="#cb12-1362" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"rect.cell"</span>)</span>
<span id="cb12-1363"><a href="#cb12-1363" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">data</span>(v)</span>
<span id="cb12-1364"><a href="#cb12-1364" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-1365"><a href="#cb12-1365" aria-hidden="true" tabindex="-1"></a>      cells<span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb12-1366"><a href="#cb12-1366" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">merge</span>(cells) <span class="co">// Merge enter and update selections</span></span>
<span id="cb12-1367"><a href="#cb12-1367" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x</span>)</span>
<span id="cb12-1368"><a href="#cb12-1368" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">y</span>)</span>
<span id="cb12-1369"><a href="#cb12-1369" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">width</span>)</span>
<span id="cb12-1370"><a href="#cb12-1370" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">height</span>)</span>
<span id="cb12-1371"><a href="#cb12-1371" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">colorScaleIncomplete</span>(<span class="op">+</span>d<span class="op">.</span><span class="at">value</span>))<span class="op">;</span></span>
<span id="cb12-1372"><a href="#cb12-1372" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-1373"><a href="#cb12-1373" aria-hidden="true" tabindex="-1"></a>      cells<span class="op">.</span><span class="fu">exit</span>()<span class="op">.</span><span class="fu">remove</span>()</span>
<span id="cb12-1374"><a href="#cb12-1374" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-1375"><a href="#cb12-1375" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">select</span>(<span class="st">"#heatmap-incomplete-nested"</span>)<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"rect.cell"</span>)<span class="op">.</span><span class="fu">data</span>(incomplete_nested_pv_data)</span>
<span id="cb12-1376"><a href="#cb12-1376" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb12-1377"><a href="#cb12-1377" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">parent_el</span>(<span class="st">"#heatmap-incomplete-nested"</span>)</span>
<span id="cb12-1378"><a href="#cb12-1378" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">interpolate</span>(<span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb12-1379"><a href="#cb12-1379" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-1380"><a href="#cb12-1380" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(<span class="st">"#heatmap-incomplete-nested"</span>)<span class="op">.</span><span class="fu">html</span>(<span class="st">""</span>)<span class="op">.</span><span class="fu">datum</span>(incomplete_nested_pv_data)<span class="op">.</span><span class="fu">call</span>(heatmap_incomplete_nested)<span class="op">;</span></span>
<span id="cb12-1381"><a href="#cb12-1381" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-12" data-nodetype="expression">

</div>
</div>
</div>
</section>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>I’ll note that the choice of model surely plays a role in the inference we’ll make. Even <a href="https://dtai.cs.kuleuven.be/sports/blog/introducing-atomic-spadl:-a-new-way-to-represent-event-stream-data">atomic VAEP</a>, which splits passes into two actions–the pass itself and the reception (or lack of)–may yield different answers.</p>
<div class="cell" data-include="false">
<details class="hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb13" data-startfrom="1390" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1389;"><span id="cb13-1390"><a href="#cb13-1390" aria-hidden="true" tabindex="-1"></a>pitch <span class="op">=</span> d3_soccer<span class="op">.</span><span class="fu">pitch</span>()</span>
<span id="cb13-1391"><a href="#cb13-1391" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">height</span>(<span class="dv">300</span>)</span>
<span id="cb13-1392"><a href="#cb13-1392" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">rotate</span>(<span class="kw">false</span>)</span>
<span id="cb13-1393"><a href="#cb13-1393" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">showDirOfPlay</span>(<span class="kw">true</span>)</span>
<span id="cb13-1394"><a href="#cb13-1394" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">shadeMiddleThird</span>(<span class="kw">false</span>)</span>
<span id="cb13-1395"><a href="#cb13-1395" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">pitchStrokeWidth</span>(<span class="fl">0.5</span>)</span>
<span id="cb13-1396"><a href="#cb13-1396" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">clip</span>([[<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>]<span class="op">,</span> [<span class="dv">105</span><span class="op">,</span> <span class="dv">68</span>]])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell" data-include="false">
<details class="hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb14" data-startfrom="1401" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1400;"><span id="cb14-1401"><a href="#cb14-1401" aria-hidden="true" tabindex="-1"></a>d3 <span class="op">=</span> <span class="pp">require</span>(<span class="st">"d3@v5"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell" data-include="false">
<details class="hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb15" data-startfrom="1406" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1405;"><span id="cb15-1406"><a href="#cb15-1406" aria-hidden="true" tabindex="-1"></a>d3_soccer <span class="op">=</span> <span class="pp">require</span>(<span class="st">"d3-soccer@0.1.0"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell" data-include="false">
<details class="hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb16" data-startfrom="1412" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1411;"><span id="cb16-1412"><a href="#cb16-1412" aria-hidden="true" tabindex="-1"></a>complete_pv_data  <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"complete_pv_data.json"</span>)<span class="op">.</span><span class="fu">json</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="complete_pv_data" class="cell-output cell-output-display hidden">
<div id="ojs-cell-16" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell" data-include="false">
<details class="hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb17" data-startfrom="1418" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1417;"><span id="cb17-1418"><a href="#cb17-1418" aria-hidden="true" tabindex="-1"></a>complete_actual_pv_data  <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"complete_actual_pv_data.json"</span>)<span class="op">.</span><span class="fu">json</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="complete_actual_pv_data" class="cell-output cell-output-display hidden">
<div id="ojs-cell-17" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell" data-include="false">
<details class="hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb18" data-startfrom="1424" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1423;"><span id="cb18-1424"><a href="#cb18-1424" aria-hidden="true" tabindex="-1"></a>incomplete_pv_data <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"incomplete_pv_data.json"</span>)<span class="op">.</span><span class="fu">json</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="incomplete_pv_data" class="cell-output cell-output-display hidden">
<div id="ojs-cell-18" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell" data-include="false">
<details class="hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb19" data-startfrom="1430" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1429;"><span id="cb19-1430"><a href="#cb19-1430" aria-hidden="true" tabindex="-1"></a>incomplete_actual_pv_data  <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"incomplete_actual_pv_data.json"</span>)<span class="op">.</span><span class="fu">json</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="incomplete_actual_pv_data" class="cell-output cell-output-display hidden">
<div id="ojs-cell-19" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell" data-include="false">
<details class="hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb20" data-startfrom="1436" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1435;"><span id="cb20-1436"><a href="#cb20-1436" aria-hidden="true" tabindex="-1"></a>complete_nested_pv_data  <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"complete_nested_pv_data.json"</span>)<span class="op">.</span><span class="fu">json</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="complete_nested_pv_data" class="cell-output cell-output-display hidden">
<div id="ojs-cell-20" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell" data-include="false">
<details class="hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb21" data-startfrom="1442" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1441;"><span id="cb21-1442"><a href="#cb21-1442" aria-hidden="true" tabindex="-1"></a>incomplete_nested_pv_data <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"incomplete_nested_pv_data.json"</span>)<span class="op">.</span><span class="fu">json</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="incomplete_nested_pv_data" class="cell-output cell-output-display hidden">
<div id="ojs-cell-21" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell" data-include="false">
<details class="hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb22" data-startfrom="1448" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1447;"><span id="cb22-1448"><a href="#cb22-1448" aria-hidden="true" tabindex="-1"></a>colorScaleCompleteRange <span class="op">=</span> [<span class="op">-</span><span class="fl">0.025</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="fl">0.025</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="colorscalecompleterange" class="cell-output cell-output-display hidden">
<div id="ojs-cell-22" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell" data-include="false">
<details class="hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb23" data-startfrom="1454" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1453;"><span id="cb23-1454"><a href="#cb23-1454" aria-hidden="true" tabindex="-1"></a>colorScaleIncompleteRange <span class="op">=</span> [<span class="op">-</span><span class="fl">0.025</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="fl">0.025</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="colorscaleincompleterange" class="cell-output cell-output-display hidden">
<div id="ojs-cell-23" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell" data-include="false">
<details class="hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb24" data-startfrom="1460" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1459;"><span id="cb24-1460"><a href="#cb24-1460" aria-hidden="true" tabindex="-1"></a>colorScaleComplete <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb24-1461"><a href="#cb24-1461" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">domain</span>(colorScaleCompleteRange)</span>
<span id="cb24-1462"><a href="#cb24-1462" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">range</span>([<span class="st">"#a6611a"</span><span class="op">,</span> <span class="st">"white"</span><span class="op">,</span> <span class="st">"#018571"</span>])<span class="op">.</span><span class="fu">clamp</span>(<span class="kw">true</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="colorscalecomplete" class="cell-output cell-output-display hidden">
<div id="ojs-cell-24" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell" data-include="false">
<details class="hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb25" data-startfrom="1468" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1467;"><span id="cb25-1468"><a href="#cb25-1468" aria-hidden="true" tabindex="-1"></a>colorScaleIncomplete <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb25-1469"><a href="#cb25-1469" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">domain</span>(colorScaleIncompleteRange)</span>
<span id="cb25-1470"><a href="#cb25-1470" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">range</span>([<span class="st">"#d01c8b"</span><span class="op">,</span> <span class="st">"white"</span><span class="op">,</span> <span class="st">"#4dac26"</span>])<span class="op">.</span><span class="fu">clamp</span>(<span class="kw">true</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="colorscaleincomplete" class="cell-output cell-output-display hidden">
<div id="ojs-cell-25" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell" data-include="false">
<details class="hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb26" data-startfrom="1476" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1475;"><span id="cb26-1476"><a href="#cb26-1476" aria-hidden="true" tabindex="-1"></a>swatchParams <span class="op">=</span> {</span>
<span id="cb26-1477"><a href="#cb26-1477" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb26-1478"><a href="#cb26-1478" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="dv">40</span><span class="op">,</span></span>
<span id="cb26-1479"><a href="#cb26-1479" aria-hidden="true" tabindex="-1"></a>    <span class="dt">height</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span></span>
<span id="cb26-1480"><a href="#cb26-1480" aria-hidden="true" tabindex="-1"></a>    <span class="dt">num</span><span class="op">:</span> <span class="dv">7</span></span>
<span id="cb26-1481"><a href="#cb26-1481" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb26-1482"><a href="#cb26-1482" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="swatchparams" class="cell-output cell-output-display hidden">
<div id="ojs-cell-26" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell" data-include="false">
<details class="hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb27" data-startfrom="1488" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1487;"><span id="cb27-1488"><a href="#cb27-1488" aria-hidden="true" tabindex="-1"></a>passStartParams <span class="op">=</span> {</span>
<span id="cb27-1489"><a href="#cb27-1489" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb27-1490"><a href="#cb27-1490" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> <span class="fl">45.9375</span><span class="op">,</span></span>
<span id="cb27-1491"><a href="#cb27-1491" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> <span class="fl">28.33333</span></span>
<span id="cb27-1492"><a href="#cb27-1492" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-1493"><a href="#cb27-1493" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="passstartparams" class="cell-output cell-output-display hidden">
<div id="ojs-cell-27" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell" data-include="false">
<details class="hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb28" data-startfrom="1499" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1498;"><span id="cb28-1499"><a href="#cb28-1499" aria-hidden="true" tabindex="-1"></a>tileParams <span class="op">=</span> {</span>
<span id="cb28-1500"><a href="#cb28-1500" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb28-1501"><a href="#cb28-1501" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="fl">6.5625</span><span class="op">,</span></span>
<span id="cb28-1502"><a href="#cb28-1502" aria-hidden="true" tabindex="-1"></a>    <span class="dt">height</span><span class="op">:</span> <span class="fl">5.666667</span></span>
<span id="cb28-1503"><a href="#cb28-1503" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-1504"><a href="#cb28-1504" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tileparams" class="cell-output cell-output-display hidden">
<div id="ojs-cell-28" data-nodetype="declaration">

</div>
</div>
</div>



</section>


<div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">

</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>This may seem pedantic, but we know that just looking at spatial features <a href="https://fivethirtyeight.com/features/possession-is-the-puzzle-of-soccer-analytics-these-models-are-trying-to-solve-it/">is probably not “good enough”</a> when it comes assigning PV to actions. &gt; But location isn’t everything. A pass from the center circle to the top of the box might be a valuable through ball that puts a striker through one-on-one with the keeper, or it might be a worthless lob into a crowd of defenders. “With just x-y locations, it’s really hard to tell, ‘Is this actually a productive pass to make?’” Rudd said.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Do not be alarmed by the small values! Values between 0.02 and 0.02 is very common for PV models.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>This may seem pedantic, but we know that just looking at spatial features <a href="https://fivethirtyeight.com/features/possession-is-the-puzzle-of-soccer-analytics-these-models-are-trying-to-solve-it/">is probably not “good enough”</a> when it comes assigning PV to actions.</p>
<blockquote class="blockquote">
<p>But location isn’t everything. A pass from the center circle to the top of the box might be a valuable through ball that puts a striker through one-on-one with the keeper, or it might be a worthless lob into a crowd of defenders. “With just x-y locations, it’s really hard to tell, ‘Is this actually a productive pass to make?’” Rudd said.</p>
</blockquote>
<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></li>
<li id="fn4"><p>There are some oddities if you look close enough (e.g.&nbsp;negative PV for long cross pitch completed passes), but such is the nature of a machine learning model.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script type="ojs-module-contents">
{"contents":[{"methodName":"interpret","cellName":"ojs-cell-1","inline":false,"source":"{\n  const chart = d3.create(\"div\")\n  const title = chart.append(\"div\").attr(\"id\", \"heatmap-title-complete\")\n  title.append(\"p\").html(`PV: <span id='pv-value-complete'>0</span>`)\n  chart.append(\"div\").attr(\"id\", \"heatmap-complete\")\n\n  const legendSwatchContainer = chart.append(\"div\")\n    .attr(\"id\", \"heatmap-legend-complete\")\n    .style(\"display\", \"flex\")\n    .style(\"flex-direction\", \"column\")\n    .style(\"align-items\", \"center\")\n    .style(\"width\", \"100%\");\n\n  const legendRange = [\n    1.1 * d3.min(colorScaleCompleteRange),\n    1.1 * d3.max(colorScaleCompleteRange)\n  ];\n  const stepSize = (legendRange[1] - legendRange[0]) / (swatchParams.num - 1);\n  const legendSwatches = d3.range(legendRange[0], legendRange[1] + stepSize, stepSize);\n  legendSwatches[legendSwatches.length - 1] = legendRange[1];\n\n  const totalLegendWidth = swatchParams.width * swatchParams.num;\n\n  const swatchRow = legendSwatchContainer.append(\"div\")\n    .style(\"display\", \"flex\")\n    .style(\"justify-content\", \"center\")\n    .style(\"width\", \"100%\");\n\n  swatchRow.selectAll(\"div\")\n    .data(legendSwatches)\n    .enter()\n    .append(\"div\")\n    .style(\"width\", `${swatchParams.width}px`)\n    .style(\"height\", `${swatchParams.height}px`)\n    .style(\"background-color\", d => colorScaleComplete(d));\n\n  const labelRow = legendSwatchContainer.append(\"div\")\n    .style(\"display\", \"flex\")\n    .style(\"justify-content\", \"center\")\n    .style(\"width\", `${totalLegendWidth}px`);\n\n  labelRow.selectAll(\"span\")\n    .data(colorScaleCompleteRange)\n    .enter()\n    .append(\"span\")\n    .text(d => {\n      if (d === d3.min(colorScaleCompleteRange)) {\n        return d + \" <=\";\n      } else if (d === d3.max(colorScaleCompleteRange)) {\n        return \">= \" + d;\n      }\n      return d;\n    })\n    // Center the middle text element, then right- and left-align the right and left text labels\n    .style(\"flex\", d => d === 0 ? \"1\" : null)\n    .style(\"text-align\", \"center\")\n\n  return chart.node();\n}\n"},{"methodName":"interpret","cellName":"ojs-cell-2","inline":false,"source":"{\n  const heatmap_complete = d3_soccer.heatmap(pitch)\n    .colorScale(colorScaleComplete)\n    .enableInteraction(true)\n    .onSelect((x, y, v) => {\n      const cappedValue = Math.min(Math.max(v, -1), 1);\n      d3.select(\"#pv-value-complete\").text(cappedValue.toFixed(3));\n    })\n    .parent_el(\"#heatmap-complete\")\n    .interpolate(false);\n\n  d3.select(\"#heatmap-complete\").html(\"\").datum(complete_pv_data).call(heatmap_complete);\n\n  const svg = d3.select(\"#heatmap-complete\").select(\"svg\");\n\n  svg.append(\"rect\")\n    .attr(\"x\", passStartParams.x)\n    .attr(\"y\", passStartParams.y)\n    .attr(\"width\", tileParams.width)\n    .attr(\"height\", tileParams.height)\n    .style(\"stroke\", \"blue\")\n    .style(\"fill\", \"none\")\n    .style(\"stroke-width\", \"1px\");\n}\n"},{"methodName":"interpret","cellName":"ojs-cell-3","inline":false,"source":"{\n  const chart = d3.create(\"div\")\n  const title = chart.append(\"div\").attr(\"id\", \"heatmap-title-complete-empirical\")\n  title.append(\"p\").html(`PV: <span id='pv-value-complete-empirical'>0</span>`)\n  chart.append(\"div\").attr(\"id\", \"heatmap-complete-empirical\")\n\n  const legendSwatchContainer = chart.append(\"div\")\n    .attr(\"id\", \"heatmap-legend-complete-empirical\")\n    .style(\"display\", \"flex\")\n    .style(\"flex-direction\", \"column\")\n    .style(\"align-items\", \"center\")\n    .style(\"width\", \"100%\");\n\n  const legendRange = [\n    1.1 * d3.min(colorScaleCompleteRange),\n    1.1 * d3.max(colorScaleCompleteRange)\n  ];\n  const stepSize = (legendRange[1] - legendRange[0]) / (swatchParams.num - 1);\n  const legendSwatches = d3.range(legendRange[0], legendRange[1] + stepSize, stepSize);\n  legendSwatches[legendSwatches.length - 1] = legendRange[1];\n\n  const totalLegendWidth = swatchParams.width * swatchParams.num;\n\n  const swatchRow = legendSwatchContainer.append(\"div\")\n    .style(\"display\", \"flex\")\n    .style(\"justify-content\", \"center\")\n    .style(\"width\", \"100%\");\n\n  swatchRow.selectAll(\"div\")\n    .data(legendSwatches)\n    .enter()\n    .append(\"div\")\n    .style(\"width\", `${swatchParams.width}px`)\n    .style(\"height\", `${swatchParams.height}px`)\n    .style(\"background-color\", d => colorScaleComplete(d));\n\n  const labelRow = legendSwatchContainer.append(\"div\")\n    .style(\"display\", \"flex\")\n    .style(\"justify-content\", \"center\")\n    .style(\"width\", `${totalLegendWidth}px`);\n\n  labelRow.selectAll(\"span\")\n    .data(colorScaleCompleteRange)\n    .enter()\n    .append(\"span\")\n    .text(d => {\n      if (d === d3.min(colorScaleCompleteRange)) {\n        return d + \" <=\";\n      } else if (d === d3.max(colorScaleCompleteRange)) {\n        return \">= \" + d;\n      }\n      return d;\n    })\n    .style(\"flex\", d => d === 0 ? \"1\" : null)\n    .style(\"text-align\", \"center\")\n\n  return chart.node();\n}\n"},{"methodName":"interpret","cellName":"ojs-cell-4","inline":false,"source":"{\n  const heatmap_complete_empirical = d3_soccer.heatmap(pitch)\n    .colorScale(colorScaleComplete)\n    .enableInteraction(true)\n    .onSelect((x, y, v) => {\n      const cappedValue = Math.min(Math.max(v, -1), 1);\n      d3.select(\"#pv-value-complete-empirical\").text(cappedValue.toFixed(3));\n    })\n    .parent_el(\"#heatmap-complete-empirical\")\n    .interpolate(false);\n\n  d3.select(\"#heatmap-complete-empirical\").html(\"\").datum(complete_actual_pv_data).call(heatmap_complete_empirical);\n\n  const svg = d3.select(\"#heatmap-complete-empirical\").select(\"svg\");\n\n  const cells = svg.selectAll(\".cell\");\n\n  cells.each(function(d, i) {\n    const cell = d3.select(this);\n    const bbox = this.getBBox();\n\n    d3.select(this.parentNode)\n      .append(\"text\")\n      .attr(\"x\", bbox.x + bbox.width / 2)\n      .attr(\"y\", bbox.y + bbox.height / 2)\n      .attr(\"text-anchor\", \"middle\")\n      .attr(\"alignment-baseline\", \"central\")\n      .style(\"font-size\", \"2.5px\")\n      .style(\"pointer-events\", \"none\")\n      .text((d.prop * 100).toFixed(1) + \"%\");\n  });\n\n  svg.append(\"rect\")\n    .attr(\"x\", passStartParams.x)\n    .attr(\"y\", passStartParams.y)\n    .attr(\"width\", tileParams.width)\n    .attr(\"height\", tileParams.height)\n    .style(\"stroke\", \"blue\")\n    .style(\"fill\", \"none\")\n    .style(\"stroke-width\", \"1px\");\n}\n"},{"methodName":"interpret","cellName":"ojs-cell-5","inline":false,"source":"{\n  const chart = d3.create(\"div\")\n  const title = chart.append(\"div\").attr(\"id\", \"heatmap-title-complete-nested\")\n  title.append(\"p\").html(`min PV: <span id='pv-min-complete-nested'>0</span>, max PV: <span id='pv-max-complete-nested'>0</span>`)\n  chart.append(\"div\").attr(\"id\", \"heatmap-complete-nested\")\n  \n  const legendSwatchContainer = chart.append(\"div\")\n    .attr(\"id\", \"heatmap-legend-complete-nested\")\n    .style(\"display\", \"flex\")\n    .style(\"flex-direction\", \"column\")\n    .style(\"align-items\", \"center\")\n    .style(\"width\", \"100%\");\n  \n  const legendRange = [\n    1.1 * d3.min(colorScaleCompleteRange),\n    1.1 * d3.max(colorScaleCompleteRange)\n  ];\n  const stepSize = (legendRange[1] - legendRange[0]) / (swatchParams.num - 1);\n  const legendSwatches = d3.range(legendRange[0], legendRange[1] + stepSize, stepSize);\n  legendSwatches[legendSwatches.length - 1] = legendRange[1];\n  \n  const totalLegendWidth = swatchParams.width * swatchParams.num;\n  \n  const swatchRow = legendSwatchContainer.append(\"div\")\n    .style(\"display\", \"flex\")\n    .style(\"justify-content\", \"center\")\n    .style(\"width\", \"100%\");\n  \n  swatchRow.selectAll(\"div\")\n    .data(legendSwatches)\n    .enter()\n    .append(\"div\")\n    .style(\"width\", `${swatchParams.width}px`)\n    .style(\"height\", `${swatchParams.height}px`)\n    .style(\"background-color\", d => colorScaleComplete(d));\n  \n  const labelRow = legendSwatchContainer.append(\"div\")\n    .style(\"display\", \"flex\")\n    .style(\"justify-content\", \"center\")\n    .style(\"width\", `${totalLegendWidth}px`);\n  \n  \n  labelRow.selectAll(\"span\")\n    .data(colorScaleCompleteRange)\n    .enter()\n    .append(\"span\")\n    .text(d => {\n      if (d === d3.min(colorScaleCompleteRange)) {\n        return d + \" <=\";\n      } else if (d === d3.max(colorScaleCompleteRange)) {\n        return \">= \" + d;\n      }\n      return d;\n    })\n    .style(\"flex\", d => d === 0 ? \"1\" : null)\n    .style(\"text-align\", \"center\")\n  \n  return chart.node();\n\n}\n"},{"methodName":"interpret","cellName":"ojs-cell-6","inline":false,"source":"{  \n  const heatmap_complete_nested = d3_soccer.heatmap(pitch)\n    .colorScale(d3.scaleLinear().domain([-1, 1]).range([\"white\", \"white\"]))\n    .enableInteraction(true)\n    .onSelect((x, y, v) => {\n      const rawMinValue = d3.min(v, d => d.value);\n      const rawMaxValue = d3.max(v, d => d.value);\n      const minValue = Math.max(rawMinValue, -1);\n      const maxValue = Math.min(rawMaxValue, 1);\n  \n      d3.select('#pv-min-complete-nested').text(minValue.toFixed(3));\n      d3.select('#pv-max-complete-nested').text(maxValue.toFixed(3));\n      const cells = d3\n        .select(\"#heatmap-complete-nested\")\n        .selectAll(\"rect.cell\")\n        .data(v)\n  \n      cells.enter()\n        .merge(cells) // Merge enter and update selections\n        .attr(\"x\", d => d.x)\n        .attr(\"y\", d => d.y)\n        .attr(\"width\", d => d.width)\n        .attr(\"height\", d => d.height)\n        .style(\"fill\", d => colorScaleComplete(+d.value));\n  \n      cells.exit().remove()\n  \n      d3.select(\"#heatmap-complete-nested\").selectAll(\"rect.cell\").data(complete_nested_pv_data)\n    })\n    .parent_el(\"#heatmap-complete-nested\")\n    .interpolate(false);\n  \n  d3.select(\"#heatmap-complete-nested\").html(\"\").datum(complete_nested_pv_data).call(heatmap_complete_nested);\n}\n"},{"methodName":"interpret","cellName":"ojs-cell-7","inline":false,"source":"{\n  const chart = d3.create(\"div\")\n  const title = chart.append(\"div\").attr(\"id\", \"heatmap-title-incomplete\")\n  title.append(\"p\").html(`PV: <span id='pv-value-incomplete'>0</span>`)\n  chart.append(\"div\").attr(\"id\", \"heatmap-incomplete\")\n  \n  const legendSwatchContainer = chart.append(\"div\")\n    .attr(\"id\", \"heatmap-legend-incomplete\")\n    .style(\"display\", \"flex\")\n    .style(\"flex-direction\", \"column\")\n    .style(\"align-items\", \"center\")\n    .style(\"width\", \"100%\");\n  \n  const legendRange = [\n    1.1 * d3.min(colorScaleIncompleteRange),\n    1.1 * d3.max(colorScaleIncompleteRange)\n  ];\n  const stepSize = (legendRange[1] - legendRange[0]) / (swatchParams.num - 1);\n  const legendSwatches = d3.range(legendRange[0], legendRange[1] + stepSize, stepSize);\n  legendSwatches[legendSwatches.length - 1] = legendRange[1];\n  \n  const totalLegendWidth = swatchParams.width * swatchParams.num;\n  \n  const swatchRow = legendSwatchContainer.append(\"div\")\n    .style(\"display\", \"flex\")\n    .style(\"justify-content\", \"center\")\n    .style(\"width\", \"100%\");\n  \n  swatchRow.selectAll(\"div\")\n    .data(legendSwatches)\n    .enter()\n    .append(\"div\")\n    .style(\"width\", `${swatchParams.width}px`)\n    .style(\"height\", `${swatchParams.height}px`)\n    .style(\"background-color\", d => colorScaleIncomplete(d));\n  \n  \n  const labelRow = legendSwatchContainer.append(\"div\")\n    .style(\"display\", \"flex\")\n    .style(\"justify-content\", \"center\")\n    .style(\"width\", `${totalLegendWidth}px`);\n  \n  \n  labelRow.selectAll(\"span\")\n    .data(colorScaleIncompleteRange)\n    .enter()\n    .append(\"span\")\n    .text(d => {\n      if (d === d3.min(colorScaleIncompleteRange)) {\n        return d + \" <=\";\n      } else if (d === d3.max(colorScaleIncompleteRange)) {\n        return \">= \" + d;\n      }\n      return d;\n    })\n    .style(\"flex\", d => d === 0 ? \"1\" : null)\n    .style(\"text-align\", \"center\")\n  \n  return chart.node();\n}\n"},{"methodName":"interpret","cellName":"ojs-cell-8","inline":false,"source":"{\n  const heatmap_incomplete = d3_soccer.heatmap(pitch)\n    .colorScale(colorScaleIncomplete)\n    .enableInteraction(true)\n    .onSelect((x, y, v) => {\n      const cappedValue = Math.min(Math.max(v, -1), 1);\n      d3.select('#pv-value-incomplete').text(cappedValue.toFixed(3));\n    })\n    .parent_el(\"#heatmap-incomplete\")\n    .interpolate(false);\n  \n  d3.select(\"#heatmap-incomplete\").html(\"\").datum(incomplete_pv_data).call(heatmap_incomplete);\n  \n  const svg = d3.select(\"#heatmap-incomplete\").select(\"svg\");\n  \n  svg.append(\"rect\")\n    .attr(\"x\", passStartParams.x)\n    .attr(\"y\", passStartParams.y)\n    .attr(\"width\", tileParams.width)\n    .attr(\"height\", tileParams.height)\n    .style(\"stroke\", \"blue\")\n    .style(\"fill\", \"none\")\n    .style(\"stroke-width\", \"1px\");\n}\n"},{"methodName":"interpret","cellName":"ojs-cell-9","inline":false,"source":"{\n  const chart = d3.create(\"div\")\n  const title = chart.append(\"div\").attr(\"id\", \"heatmap-title-incomplete-empirical\")\n  title.append(\"p\").html(`PV: <span id='pv-value-incomplete-empirical'>0</span>`)\n  chart.append(\"div\").attr(\"id\", \"heatmap-incomplete-empirical\")\n\n  const legendSwatchContainer = chart.append(\"div\")\n    .attr(\"id\", \"heatmap-legend-incomplete-empirical\")\n    .style(\"display\", \"flex\")\n    .style(\"flex-direction\", \"column\")\n    .style(\"align-items\", \"center\")\n    .style(\"width\", \"100%\");\n\n  const legendRange = [\n    1.1 * d3.min(colorScaleIncompleteRange),\n    1.1 * d3.max(colorScaleIncompleteRange)\n  ];\n  const stepSize = (legendRange[1] - legendRange[0]) / (swatchParams.num - 1);\n  const legendSwatches = d3.range(legendRange[0], legendRange[1] + stepSize, stepSize);\n  legendSwatches[legendSwatches.length - 1] = legendRange[1];\n\n  const totalLegendWidth = swatchParams.width * swatchParams.num;\n\n  const swatchRow = legendSwatchContainer.append(\"div\")\n    .style(\"display\", \"flex\")\n    .style(\"justify-content\", \"center\")\n    .style(\"width\", \"100%\");\n\n  swatchRow.selectAll(\"div\")\n    .data(legendSwatches)\n    .enter()\n    .append(\"div\")\n    .style(\"width\", `${swatchParams.width}px`)\n    .style(\"height\", `${swatchParams.height}px`)\n    .style(\"background-color\", d => colorScaleIncomplete(d));\n\n  const labelRow = legendSwatchContainer.append(\"div\")\n    .style(\"display\", \"flex\")\n    .style(\"justify-content\", \"center\")\n    .style(\"width\", `${totalLegendWidth}px`);\n\n  labelRow.selectAll(\"span\")\n    .data(colorScaleIncompleteRange)\n    .enter()\n    .append(\"span\")\n    .text(d => {\n      if (d === d3.min(colorScaleIncompleteRange)) {\n        return d + \" <=\";\n      } else if (d === d3.max(colorScaleIncompleteRange)) {\n        return \">= \" + d;\n      }\n      return d;\n    })\n    .style(\"flex\", d => d === 0 ? \"1\" : null)\n    .style(\"text-align\", \"center\")\n\n  return chart.node();\n}\n"},{"methodName":"interpret","cellName":"ojs-cell-10","inline":false,"source":"{\n  const heatmap_incomplete_empirical = d3_soccer.heatmap(pitch)\n    .colorScale(colorScaleIncomplete)\n    .enableInteraction(true)\n    .onSelect((x, y, v) => {\n      const cappedValue = Math.min(Math.max(v, -1), 1);\n      d3.select(\"#pv-value-incomplete-empirical\").text(cappedValue.toFixed(3));\n    })\n    .parent_el(\"#heatmap-incomplete-empirical\")\n    .interpolate(false);\n\n  d3.select(\"#heatmap-incomplete-empirical\").html(\"\").datum(incomplete_actual_pv_data).call(heatmap_incomplete_empirical);\n\n  const svg = d3.select(\"#heatmap-incomplete-empirical\").select(\"svg\");\n\n  const cells = svg.selectAll(\".cell\");\n\n  cells.each(function(d, i) {\n    const cell = d3.select(this);\n    const bbox = this.getBBox();\n\n    d3.select(this.parentNode)\n      .append(\"text\")\n      .attr(\"x\", bbox.x + bbox.width / 2)\n      .attr(\"y\", bbox.y + bbox.height / 2)\n      .attr(\"text-anchor\", \"middle\")\n      .attr(\"alignment-baseline\", \"central\")\n      .style(\"font-size\", \"2.5px\")\n      .style(\"pointer-events\", \"none\")\n      .text((d.prop * 100).toFixed(1) + \"%\");\n  });\n\n  svg.append(\"rect\")\n    .attr(\"x\", passStartParams.x)\n    .attr(\"y\", passStartParams.y)\n    .attr(\"width\", tileParams.width)\n    .attr(\"height\", tileParams.height)\n    .style(\"stroke\", \"blue\")\n    .style(\"fill\", \"none\")\n    .style(\"stroke-width\", \"1px\");\n}\n"},{"methodName":"interpret","cellName":"ojs-cell-11","inline":false,"source":"{\n  const chart = d3.create(\"div\")\n  const title = chart.append(\"div\").attr(\"id\", \"heatmap-title-incomplete-nested\")\n  title.append(\"p\").html(`min PV: <span id='pv-min-incomplete-nested'>0</span>, max PV: <span id='pv-max-incomplete-nested'>0</span>`)\n  chart.append(\"div\").attr(\"id\", \"heatmap-incomplete-nested\")\n  \n  const legendSwatchContainer = chart.append(\"div\")\n    .attr(\"id\", \"heatmap-legend-incomplete-nested\")\n    .style(\"display\", \"flex\")\n    .style(\"flex-direction\", \"column\")\n    .style(\"align-items\", \"center\")\n    .style(\"width\", \"100%\");\n  \n  const legendRange = [\n    1.1 * d3.min(colorScaleIncompleteRange),\n    1.1 * d3.max(colorScaleIncompleteRange)\n  ];\n  const stepSize = (legendRange[1] - legendRange[0]) / (swatchParams.num - 1);\n  const legendSwatches = d3.range(legendRange[0], legendRange[1] + stepSize, stepSize);\n  legendSwatches[legendSwatches.length - 1] = legendRange[1];\n  \n  const totalLegendWidth = swatchParams.width * swatchParams.num;\n  \n  \n  const swatchRow = legendSwatchContainer.append(\"div\")\n    .style(\"display\", \"flex\")\n    .style(\"justify-content\", \"center\")\n    .style(\"width\", \"100%\");\n  \n  swatchRow.selectAll(\"div\")\n    .data(legendSwatches)\n    .enter()\n    .append(\"div\")\n    .style(\"width\", `${swatchParams.width}px`)\n    .style(\"height\", `${swatchParams.height}px`)\n    .style(\"background-color\", d => colorScaleIncomplete(d));\n  \n  const labelRow = legendSwatchContainer.append(\"div\")\n    .style(\"display\", \"flex\")\n    .style(\"justify-content\", \"center\")\n    .style(\"width\", `${totalLegendWidth}px`);\n  \n  labelRow.selectAll(\"span\")\n    .data(colorScaleIncompleteRange)\n    .enter()\n    .append(\"span\")\n    .text(d => {\n      if (d === d3.min(colorScaleIncompleteRange)) {\n        return d + \" <=\";\n      } else if (d === d3.max(colorScaleIncompleteRange)) {\n        return \">= \" + d;\n      }\n      return d;\n    })\n    .style(\"flex\", d => d === 0 ? \"1\" : null)\n    .style(\"text-align\", \"center\")\n  \n  return chart.node();\n}\n"},{"methodName":"interpret","cellName":"ojs-cell-12","inline":false,"source":"{  \n  const heatmap_incomplete_nested = d3_soccer.heatmap(pitch)\n    .colorScale(d3.scaleLinear().domain([-1, 1]).range([\"white\", \"white\"]))\n    .enableInteraction(true)\n    .onSelect((x, y, v) => {\n      const rawMinValue = d3.min(v, d => d.value);\n      const rawMaxValue = d3.max(v, d => d.value);\n      const minValue = Math.max(rawMinValue, -1);\n      const maxValue = Math.min(rawMaxValue, 1);\n  \n      d3.select('#pv-min-incomplete-nested').text(minValue.toFixed(3));\n      d3.select('#pv-max-incomplete-nested').text(maxValue.toFixed(3));\n      const cells = d3\n        .select(\"#heatmap-incomplete-nested\")\n        .selectAll(\"rect.cell\")\n        .data(v)\n  \n      cells.enter()\n        .merge(cells) // Merge enter and update selections\n        .attr(\"x\", d => d.x)\n        .attr(\"y\", d => d.y)\n        .attr(\"width\", d => d.width)\n        .attr(\"height\", d => d.height)\n        .style(\"fill\", d => colorScaleIncomplete(+d.value));\n  \n      cells.exit().remove()\n  \n      d3.select(\"#heatmap-incomplete-nested\").selectAll(\"rect.cell\").data(incomplete_nested_pv_data)\n    })\n    .parent_el(\"#heatmap-incomplete-nested\")\n    .interpolate(false);\n  \n  d3.select(\"#heatmap-incomplete-nested\").html(\"\").datum(incomplete_nested_pv_data).call(heatmap_incomplete_nested);\n}\n"},{"methodName":"interpret","cellName":"ojs-cell-13","inline":false,"source":"pitch = d3_soccer.pitch()\n.height(300)\n.rotate(false)\n.showDirOfPlay(true)\n.shadeMiddleThird(false)\n.pitchStrokeWidth(0.5)\n.clip([[0, 0], [105, 68]]);\n"},{"methodName":"interpret","cellName":"ojs-cell-14","inline":false,"source":"d3 = require(\"d3@v5\")\n"},{"methodName":"interpret","cellName":"ojs-cell-15","inline":false,"source":"d3_soccer = require(\"d3-soccer@0.1.0\")\n"},{"methodName":"interpret","cellName":"ojs-cell-16","inline":false,"source":"complete_pv_data  = FileAttachment(\"complete_pv_data.json\").json()\n"},{"methodName":"interpret","cellName":"ojs-cell-17","inline":false,"source":"complete_actual_pv_data  = FileAttachment(\"complete_actual_pv_data.json\").json()\n"},{"methodName":"interpret","cellName":"ojs-cell-18","inline":false,"source":"incomplete_pv_data = FileAttachment(\"incomplete_pv_data.json\").json()\n"},{"methodName":"interpret","cellName":"ojs-cell-19","inline":false,"source":"incomplete_actual_pv_data  = FileAttachment(\"incomplete_actual_pv_data.json\").json()\n"},{"methodName":"interpret","cellName":"ojs-cell-20","inline":false,"source":"complete_nested_pv_data  = FileAttachment(\"complete_nested_pv_data.json\").json()\n"},{"methodName":"interpret","cellName":"ojs-cell-21","inline":false,"source":"incomplete_nested_pv_data = FileAttachment(\"incomplete_nested_pv_data.json\").json()\n"},{"methodName":"interpret","cellName":"ojs-cell-22","inline":false,"source":"colorScaleCompleteRange = [-0.025, 0, 0.025]\n"},{"methodName":"interpret","cellName":"ojs-cell-23","inline":false,"source":"colorScaleIncompleteRange = [-0.025, 0, 0.025]\n"},{"methodName":"interpret","cellName":"ojs-cell-24","inline":false,"source":"colorScaleComplete = d3.scaleLinear()\n  .domain(colorScaleCompleteRange)\n  .range([\"#a6611a\", \"white\", \"#018571\"]).clamp(true)\n"},{"methodName":"interpret","cellName":"ojs-cell-25","inline":false,"source":"colorScaleIncomplete = d3.scaleLinear()\n  .domain(colorScaleIncompleteRange)\n  .range([\"#d01c8b\", \"white\", \"#4dac26\"]).clamp(true)\n"},{"methodName":"interpret","cellName":"ojs-cell-26","inline":false,"source":"swatchParams = {\n  return {\n    width: 40,\n    height: 20,\n    num: 7\n  }\n}\n"},{"methodName":"interpret","cellName":"ojs-cell-27","inline":false,"source":"passStartParams = {\n  return {\n    x: 45.9375,\n    y: 28.33333\n  }\n}\n"},{"methodName":"interpret","cellName":"ojs-cell-28","inline":false,"source":"tileParams = {\n  return {\n    width: 6.5625,\n    height: 5.666667\n  }\n}\n"}]}
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../posts/ball-progression-epv";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "../..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>