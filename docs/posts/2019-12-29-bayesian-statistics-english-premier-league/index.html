<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #545454; font-weight: bold; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #a1024a; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007faa; font-weight: bold; } /* ControlFlow */
code span.ch { color: #008000; } /* Char */
code span.cn { color: #d91e18; } /* Constant */
code span.co { color: #545454; } /* Comment */
code span.cv { color: #545454; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #aa5d00; } /* DataType */
code span.dv { color: #a1024a; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #a1024a; } /* Float */
code span.fu { color: #4254a7; } /* Function */
code span.im { } /* Import */
code span.in { color: #545454; font-weight: bold; } /* Information */
code span.kw { color: #007faa; font-weight: bold; } /* Keyword */
code span.op { color: #696969; } /* Operator */
code span.ot { color: #007faa; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #008000; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #008000; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #008000; } /* VerbatimString */
code span.wa { color: #545454; font-weight: bold; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
<title>My Blog: A Bayesian Approach to Ranking English Premier League Teams (using R)</title>

<meta property="description" itemprop="description" content="A Bayesian Approach to Ranking English Premier League Teams (using R)"/>

<link rel="canonical" href="https//tonyelhabr.rbind.io/"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2019-12-13"/>
<meta property="article:created" itemprop="dateCreated" content="2019-12-13"/>
<meta name="article:author" content="Tony ElHabr"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="My Blog: A Bayesian Approach to Ranking English Premier League Teams (using R)"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="A Bayesian Approach to Ranking English Premier League Teams (using R)"/>
<meta property="og:url" content="https//tonyelhabr.rbind.io/"/>
<meta property="og:image" content="https//tonyelhabr.rbind.io/viz_summ_1_z_adj.png"/>
<meta property="og:image:width" content="2100"/>
<meta property="og:image:height" content="1500"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="My Blog"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="My Blog: A Bayesian Approach to Ranking English Premier League Teams (using R)"/>
<meta property="twitter:description" content="A Bayesian Approach to Ranking English Premier League Teams (using R)"/>
<meta property="twitter:url" content="https//tonyelhabr.rbind.io/"/>
<meta property="twitter:image" content="https//tonyelhabr.rbind.io/viz_summ_1_z_adj.png"/>
<meta property="twitter:image:width" content="2100"/>
<meta property="twitter:image:height" content="1500"/>
<meta property="twitter:site" content="@TonyElHabr"/>
<meta property="twitter:creator" content="@TonyElHabr"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="My Blog: A Bayesian Approach to Ranking English Premier League Teams (using R)"/>
<meta name="citation_fulltext_html_url" content="https//tonyelhabr.rbind.io/"/>
<meta name="citation_online_date" content="2019/12/13"/>
<meta name="citation_publication_date" content="2019/12/13"/>
<meta name="citation_author" content="Tony ElHabr"/>
<!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","base_url","date","categories","output","preview","twitter","citation_url","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["A Bayesian Approach to Ranking English Premier League Teams (using R)"]},{"type":"character","attributes":{},"value":["A Bayesian Approach to Ranking English Premier League Teams (using R)"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url"]}},"value":[{"type":"character","attributes":{},"value":["Tony ElHabr"]},{"type":"character","attributes":{},"value":["https://twitter.com/TonyElHabr"]}]}]},{"type":"character","attributes":{},"value":["https//tonyelhabr.rbind.io"]},{"type":"character","attributes":{},"value":["2019-12-13"]},{"type":"character","attributes":{},"value":["r","bayes","statistics","poisson","soccer","epl"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["toc","toc_depth","self_contained"]}},"value":[{"type":"logical","attributes":{},"value":[true]},{"type":"integer","attributes":{},"value":[3]},{"type":"logical","attributes":{},"value":[false]}]}]},{"type":"character","attributes":{},"value":["viz_summ_1_z_adj.png"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["site","creator"]}},"value":[{"type":"character","attributes":{},"value":["@TonyElHabr"]},{"type":"character","attributes":{},"value":["@TonyElHabr"]}]},{"type":"character","attributes":{},"value":["https//tonyelhabr.rbind.io/"]},{"type":"character","attributes":{},"value":["https//tonyelhabr.rbind.io/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["bayesian-statistics-english-premier-league_files/anchor-4.2.2/anchor.min.js","bayesian-statistics-english-premier-league_files/bowser-1.9.3/bowser.min.js","bayesian-statistics-english-premier-league_files/distill-2.2.21/template.v2.js","bayesian-statistics-english-premier-league_files/header-attrs-2.6/header-attrs.js","bayesian-statistics-english-premier-league_files/jquery-1.11.3/jquery.min.js","bayesian-statistics-english-premier-league_files/webcomponents-2.0.0/webcomponents.js","epl.xlsx","viz_conf_mat.png","viz_g_mean.png","viz_g_mode.png","viz_result_mode.png","viz_summ_1_z.png","viz_summ_1_z_adj.png"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

</style>

<link href="../../site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<script src="../../site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
<script src="../../site_libs/fuse-6.4.1/fuse.min.js"></script>

<script type="application/javascript">

function getMeta(metaName) {
  var metas = document.getElementsByTagName('meta');
  for (let i = 0; i < metas.length; i++) {
    if (metas[i].getAttribute('name') === metaName) {
      return metas[i].getAttribute('content');
    }
  }
  return '';
}

function offsetURL(url) {
  var offset = getMeta('distill:offset');
  return offset ? offset + '/' + url : url;
}

function createIndex() {
  var options = {
    keys: [
      "title",
      "categories",
      "description",
      "contents"
    ]
  };
  return new window.Fuse([],options);
}

function createFuseIndex() {

  // create fuse index
  var options = { keys: ["title", "description", "contents"] };
  var fuse = new window.Fuse([], options);

  // fetch the main search.json
  return fetch(offsetURL('search.json'))
    .then(function(response) {
      if (response.status == 200) {
        return response.json().then(function(json) {
          // index main articles
          json.articles.forEach(function(article) {
            fuse.add(article);
          });
          // download collections and index their articles
          return Promise.all(json.collections.map(function(collection) {
            return fetch(offsetURL(collection)).then(function(response) {
              if (response.status === 200) {
                return response.json().then(function(articles) {
                  articles.forEach(function(article) {
                    fuse.add(article);
                  });
                })
              } else {
                return Promise.reject(
                  new Error('Unexpected status from search index request: ' +
                            response.status)
                );
              }
            });
          })).then(function() {
            return fuse;
          });
        });

      } else {
        return Promise.reject(
          new Error('Unexpected status from search index request: ' +
                      response.status)
        );
      }
    });
}

window.document.addEventListener("DOMContentLoaded", function (event) {

  // get search element (bail if we don't have one)
  var searchEl = window.document.getElementById('distill-search');
  if (!searchEl)
    return;

  createFuseIndex()
    .then(function(fuse) {

      // make search box visible
      searchEl.classList.remove('hidden');

      // initialize autocomplete
      var options = {
        autoselect: true,
        hint: false,
        minLength: 2,
      };
      window.autocomplete(searchEl, options, [{
        source: function(query, callback) {
          const searchOptions = {
            isCaseSensitive: false,
            shouldSort: true,
            minMatchCharLength: 2,
            limit: 10,
            keys: [
              { name: 'title', weight: 20 },
              { name: 'categories', weight: 15 },
              { name: 'description', weight: 10 },
              { name: 'contents', weight: 5 },
            ],
          };
          var results = fuse.search(query, searchOptions);
          callback(results
            .map(function(result) { return result.item; })
            .filter(function(item) { return !!item.description; })
          );
        },
        templates: {
          suggestion: function(suggestion) {
            var html = `
              <div class="search-item">
                <h3>${suggestion.title}</h3>
                <div class="search-item-description">
                  ${suggestion.description}
                </div>
                <div class="search-item-preview">
                  <img src="${suggestion.preview ? offsetURL(suggestion.preview) : ''}"</img>
                </div>
              </div>
            `;
            return html;
          }
        }
      }]).on('autocomplete:selected', function(event, suggestion) {
        window.location.href = offsetURL(suggestion.path);
      });
      // remove inline display style on autocompleter (we want to
      // manage responsive display via css)
      $('.algolia-autocomplete').css("display", "");
    })
    .catch(function(error) {
      console.log(error);
    });

});

</script>

<style type="text/css">

/* Algolioa Autocomplete */

.algolia-autocomplete {
  display: inline-block;
  margin-left: 10px;
  vertical-align: sub;
  background-color: white;
  color: black;
  padding: 6px;
  padding-top: 8px;
  padding-bottom: 0;
  border-radius: 6px;
  border: 1px #0F2E3D solid;
  width: 180px;
}


@media screen and (max-width: 768px) {
  .distill-site-nav .algolia-autocomplete {
    display: none;
    visibility: hidden;
  }
  .distill-site-nav.responsive .algolia-autocomplete {
    display: inline-block;
    visibility: visible;
  }
  .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
    margin-left: 0;
    width: 400px;
    max-height: 400px;
  }
}

.algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
  width: 90%;
  outline: none;
  border: none;
}

.algolia-autocomplete .aa-hint {
  color: #999;
}
.algolia-autocomplete .aa-dropdown-menu {
  width: 550px;
  max-height: 70vh;
  overflow-x: visible;
  overflow-y: scroll;
  padding: 5px;
  margin-top: 3px;
  margin-left: -150px;
  background-color: #fff;
  border-radius: 5px;
  border: 1px solid #999;
  border-top: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
  cursor: pointer;
  padding: 5px 4px;
  border-bottom: 1px solid #eee;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
  border-bottom: none;
  margin-bottom: 2px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
  overflow: hidden;
  font-size: 0.8em;
  line-height: 1.4em;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
  margin-block-start: 0;
  margin-block-end: 5px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
  display: inline-block;
  overflow: hidden;
  height: 2.8em;
  width: 80%;
  margin-right: 4%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
  display: inline-block;
  width: 15%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
  height: 3em;
  width: auto;
  display: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
  display: initial;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
  background-color: #eee;
}
.algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
  font-weight: bold;
  font-style: normal;
}

</style>


<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: hidden;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure img {
  width: 100%;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme
  $('code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.6/header-attrs.js"></script>
  <script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<style type="text/css">
.distill-site-nav {
  font-family: 'Karla', sans-serif;
  color: #000;
  background-color: #fff;
  font-size: 15px;
  font-weight: 400;
}

.distill-site-header {
  font-family: 'Karla', sans-serif;
  color: #000;
  background-color: #fff;
  font-size: 15px;
  font-weight: 400;
}

@import url('https://fonts.googleapis.com/css2?family=Lato');
@import url('https://fonts.googleapis.com/css2?family=Karla');
@import url('https://fonts.googleapis.com/css2?family=Fira+Code');

html,
body,
p {
  font-family: 'Lato', sans-serif;
  font-weight: 200;
  line-height: 1.3;
  font-size: 1em;
  color: #333333;
  font-style: normal;
}

code {
  font-family: 'Fira Code', sans-serif;
  color: #383838;
  background: #f5f5f5;
  font-weight: 400;
  font-size: 0.9em;
}

h1,
h2,
h3,
h4,
h5 {
  font-family: 'Karla', sans-serif;
}

.distill-site-nav a {
  font-family: 'Karla', sans-serif;
  font-weight: 500;
  font-size: 15px;
  color: #000;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: #ff6700;
}

.nav-dropdown-content a {
  font-family: 'Karla', sans-serif;
  font-weight: 500;
  color: #ffffff;
}

.distill-site-header {
  font-family: 'Karla', sans-serif;
  font-weight: 500;
  background-color: #ffffff;
}

.distill-site-footer {
  background-color: #000;
  color: #ffffff;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

details {
  background-color: hsla(60, 7%, 80%, 0.2);
  cursor: pointer;
  color: #2d2d2d;
  margin-bottom: 1vh;
  padding: 1em;
  border: none;
  text-align: left;
  outline: none;
}

.active,
details:hover {
  transition: max-height 0.2s ease-out;
  /* background-color: #acc2c2; */
}

details {
  display: flex;
  justify-content: space-between;
  align-content: center;
  border-radius: 4px;
}

details.active {
  border-bottom-left-radius: 0;
  border-bottom-right-radius: 0;
}

summary::-webkit-details-marker {
  display: none;
}

summary::after {
  float: right;
  font-family: 'Font Awesome 5 Free';
  content: '\f0fe';
}

details[open] summary::after {
  float: right;
  font-family: 'Font Awesome 5 Free';
  content: '\f146';
}

details h4 {
  margin: 0;
  color: #2d2d2d !important;
  line-height: inherit;
}

</style>
<!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"A Bayesian Approach to Ranking English Premier League Teams (using R)","description":"A Bayesian Approach to Ranking English Premier League Teams (using R)","authors":[{"author":"Tony ElHabr","authorURL":"https://twitter.com/TonyElHabr","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2019-12-13T00:00:00.000-06:00","citationText":"ElHabr, 2019"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a href="../../index.html" class="title">My Blog</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="../../index.html">Home</a>
<a href="../../about.html">About</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>A Bayesian Approach to Ranking English Premier League Teams (using R)</h1>
<!--radix_placeholder_categories-->
<div class="dt-tags">
  <a href="../../index.html#category:r" class="dt-tag">r</a>
  <a href="../../index.html#category:bayes" class="dt-tag">bayes</a>
  <a href="../../index.html#category:statistics" class="dt-tag">statistics</a>
  <a href="../../index.html#category:poisson" class="dt-tag">poisson</a>
  <a href="../../index.html#category:soccer" class="dt-tag">soccer</a>
  <a href="../../index.html#category:epl" class="dt-tag">epl</a>
</div>
<!--/radix_placeholder_categories-->
<p>A Bayesian Approach to Ranking English Premier League Teams (using R)</p>
</div>

<div class="d-byline">
  Tony ElHabr <a href="https://twitter.com/TonyElHabr" class="uri">https://twitter.com/TonyElHabr</a> 
  
<br/>2019-12-13
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#introduction">Introduction</a>
<ul>
<li><a href="#data-collection">Data Collection</a></li>
</ul></li>
<li><a href="#modeling">Modeling</a></li>
<li><a href="#interpretation-discussion">Interpretation &amp; Discussion</a>
<ul>
<li><a href="#predictions">Predictions</a></li>
</ul></li>
<li><a href="#conclusion">Conclusion</a>
<ul>
<li><a href="#future-work">Future Work</a></li>
</ul></li>
<li><a href="#appendix">Appendix</a>
<ul>
<li><a href="#code">Code</a></li>
</ul></li>
</ul>
</nav>
</div>
<p>As <a href="/post/cheat-sheet-rmarkdown">I mentioned back in July</a>, I haven’t had as much time (since summer of 2018) to write due to taking classes in pursuit of a degree from <a href="https://pe.gatech.edu/degrees/analytics">Georgia Tech’s Online Master of Science in Analytics (OMSA)</a> program. On the other hand, the classes have given me some ideas for future content. And, in the case of the <a href="https://en.wikipedia.org/wiki/Bayesian_statistics">Bayesian Statistics</a> class that I took this past fall, there’s content that translates well to a blog post directly. What follows is a lightly edited version of the report that I submitted at the end of the semester for this class.</p>
<h1 id="introduction">Introduction</h1>
<p>I model and predict <a href="https://en.wikipedia.org/wiki/Premier_League">English Premier League</a> (EPL) game outcomes using Bayesian methods. Specifically, I estimated goals scored by each team in a given game as independent Poisson processes, taking the difference of the estimated points scored on each side to determine game winners. More broadly, one may call this a hierarchical Bayesian Poisson model.</p>
<p>Why model goals scored using a Poisson distribution? <a href="https://en.wikipedia.org/wiki/Poisson_distribution">By definition</a>, it “is a discrete probability distribution that expresses the probability of a given number of events occurring in a fixed interval of time with a known constant rate.” In the context of soccer, the fixed interval of time is the 90 minutes of a game (disregarding injury time and over time), and the known constant rate is the expected number of goals scored per minute. Importantly, I must make the assumption that the rate of scored goals is the same across all minutes of a game. <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> Additionally, when computing the difference between Poisson distributions, I must assume that the two distributions are independent of one another. <a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<p>Using Poisson distributions to model soccer scores is certainly not a novel concept. <a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> <a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> In particular, I would like to acknowledge <a href="http://www.sumsar.net/blog/2013/07/modeling-match-results-in-la-liga-part-one/">the work of Rasmus Baath’s</a>, whose series of blog posts exemplifying the use of R and <a href="http://mcmc-jags.sourceforge.net/">JAGS</a> to model scores in <a href="https://en.wikipedia.org/wiki/La_Liga"><em>La Liga</em></a> games between the 2008-09 to 2012-13 season served as a guide for the analysis that I conduct here. <a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> <a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></p>
<h2 id="data-collection">Data Collection</h2>
<p>For this project I retrieved game scores and outcomes for the previous three seasons of EPL games (i.e. from the 2016-17 season through the 2018-2019 season).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='co'># Reference: https://github.com/jalapic/engsoccerdata/blob/master/R/england_current.R</span>
<span class='va'>scrape_epl_data</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>season</span> <span class='op'>=</span> <span class='fu'>lubridate</span><span class='fu'>::</span><span class='fu'><a href='http://lubridate.tidyverse.org/reference/year.html'>year</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.Date</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>1L</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>s1</span> <span class='op'>&lt;-</span> <span class='va'>season</span> <span class='op'>%&gt;%</span> <span class='fu'>str_sub</span><span class='op'>(</span><span class='fl'>3</span>, <span class='fl'>4</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='op'>)</span>
  <span class='va'>s2</span> <span class='op'>&lt;-</span> <span class='va'>s1</span> <span class='op'>+</span> <span class='fl'>1L</span>
  <span class='va'>path</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sprintf.html'>sprintf</a></span><span class='op'>(</span><span class='st'>'http://www.football-data.co.uk/mmz4281/%2d%2d/E0.csv'</span>, <span class='va'>s1</span>, <span class='va'>s2</span><span class='op'>)</span>
  <span class='va'>data_raw</span> <span class='op'>&lt;-</span> <span class='va'>path</span> <span class='op'>%&gt;%</span> <span class='fu'>read_csv</span><span class='op'>(</span><span class='op'>)</span>
  <span class='va'>data</span> <span class='op'>&lt;-</span>
    <span class='va'>data_raw</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>janitor</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/janitor/man/clean_names.html'>clean_names</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>mutate_at</span><span class='op'>(</span><span class='fu'>vars</span><span class='op'>(</span><span class='va'>date</span><span class='op'>)</span>, <span class='op'>~</span><span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='va'>.</span>, <span class='st'>'%d/%m/%y'</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>select</span><span class='op'>(</span>
      <span class='va'>date</span>, 
      tm_h <span class='op'>=</span> <span class='va'>home_team</span>, 
      tm_a <span class='op'>=</span> <span class='va'>away_team</span>,
      g_h <span class='op'>=</span> <span class='va'>fthg</span>,
      g_a <span class='op'>=</span> <span class='va'>ftag</span>
    <span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>mutate</span><span class='op'>(</span>
      g_total <span class='op'>=</span> <span class='va'>g_h</span> <span class='op'>+</span> <span class='va'>g_a</span>,
      g_diff <span class='op'>=</span> <span class='va'>g_h</span> <span class='op'>-</span> <span class='va'>g_a</span>,
      result <span class='op'>=</span> 
        <span class='fu'>case_when</span><span class='op'>(</span>
          <span class='va'>g_h</span> <span class='op'>&gt;</span> <span class='va'>g_a</span> <span class='op'>~</span> <span class='st'>'h'</span>, 
          <span class='va'>g_h</span> <span class='op'>&lt;</span> <span class='va'>g_a</span> <span class='op'>~</span> <span class='st'>'a'</span>, 
          <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='st'>'t'</span>
        <span class='op'>)</span>,
      tm_winner <span class='op'>=</span> 
        <span class='fu'>case_when</span><span class='op'>(</span>
          <span class='va'>g_h</span> <span class='op'>&gt;</span> <span class='va'>g_a</span> <span class='op'>~</span> <span class='va'>tm_h</span>, 
          <span class='va'>g_h</span> <span class='op'>&lt;</span> <span class='va'>g_a</span> <span class='op'>~</span> <span class='va'>tm_a</span>, 
          <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='cn'>NA_character_</span>
        <span class='op'>)</span>
    <span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>mutate_at</span><span class='op'>(</span><span class='fu'>vars</span><span class='op'>(</span><span class='fu'>matches</span><span class='op'>(</span><span class='st'>'season|^g_'</span><span class='op'>)</span><span class='op'>)</span>, <span class='va'>as.integer</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='va'>data</span> <span class='op'>&lt;-</span>
  <span class='fu'>tibble</span><span class='op'>(</span>season <span class='op'>=</span> <span class='va'>seasons</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>data <span class='op'>=</span> <span class='fu'>map</span><span class='op'>(</span><span class='va'>season</span>, <span class='va'>scrape_epl_data</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>unnest</span><span class='op'>(</span><span class='va'>data</span><span class='op'>)</span>
<span class='va'>data</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<!-- Before implementing some models, I need to "wrangle" the raw data a bit in order to put it in a more workable format for OpenBUGs. (Specifically, I need to put it into a list.) -->
<h1 id="modeling">Modeling</h1>
<p>My model is formally defined as follows.</p>
<p><span class="math display">\[
\begin{array}{c}
g_h \sim \mathcal{Pois}(\lambda_{h,i,j}) \\
g_a \sim \mathcal{Pois}(\lambda_{a,i,j}) \\
\log(\lambda_{h,i,j}) = \text{baseline}_h + (z_i - z_j) \\
\log(\lambda_{a,i,j}) = \text{baseline}_a + (z_j - z_i). \\
\end{array}
\]</span></p>
<p>This model estimates the goals scored by the home team, <span class="math inline">\(g_h\)</span>, and the goals scored by the away team, <span class="math inline">\(g_a\)</span>, in a given game between home team, <span class="math inline">\(\text{tm}_h\)</span>, and away team, <span class="math inline">\(\text{tm}_a\)</span>, as random variables coming from independent Poisson processes, <span class="math inline">\(\mathcal{Pois}(\lambda_{h,i,j})\)</span> and <span class="math inline">\(\mathcal{Pois}(\lambda_{a,i,j})\)</span>. The log of the rate of goals scored by the home team, <span class="math inline">\(\lambda_{h,i,j}\)</span>, in a game between <span class="math inline">\(\text{tm}_i\)</span> and <span class="math inline">\(\text{tm}_j\)</span> is modeled as the sum of a “baseline” average of goals scored by any given team playing at home, <span class="math inline">\(\text{baseline}_h\)</span>, and the difference between the team “strength” <span class="math inline">\(z\)</span> of teams <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> in a given game. I define the log of the goal rate by the away team, <span class="math inline">\(\lambda_{a,i,j}\)</span>, in a similar fashion. <a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a> It is important to distinguish the baseline levels for home and away so as to account for <a href="https://en.wikipedia.org/wiki/Home_advantage">“home field advantage”</a>. (One should expect to find that <span class="math inline">\(\text{baseline}_h &gt; \text{baseline}_a\)</span> in the posterior estimates.)</p>
<p>Since I am employing a Bayesian approach, I need to model priors as well. I define them as follows.</p>
<p><span class="math display">\[
\begin{array}{c}
\text{baseline}_h \sim \mathcal{N}(0, 2^2) \\
\text{baseline}_a \sim \mathcal{N}(0, 2^2) \\
z_{i} \sim \mathcal{N}(z_{\text{all}} , \sigma^2_{\text{all}}) \quad \text{tm}_i &gt; 1 \\
z_{\text{all}} \sim \mathcal{N}(0, 2^2) \\
\sigma_{\text{all}} \sim \mathcal{U}(0, 2).
\end{array}
\]</span></p>
<p>There are a couple of things to note about these priors. First, I must “zero”-anchor the strength estimate <span class="math inline">\(z\)</span> of one team. (This is manifested by <span class="math inline">\(\text{tm}_i &gt; 1\)</span>.) Here, I choose the first team alphabetically—Arsenal. Second, the priors are intentionally defined to be relatively vague (although not too vauge) so as to allow the posterior estimates to be heavily defined by the data rather than the priors. Note that the standard deviation of the overall team strength parameter <span class="math inline">\(z_{\text{all}}\)</span>, defined as <span class="math inline">\(2\)</span> on a log scale, corresponds to an interval of <span class="math inline">\(\left[e^{-2}, e^2\right] = \left[0.13, 7.40\right]\)</span> on an unstransformed scale, i.e. goals scored per game.</p>
<p>I leverage the <a href="https://cran.r-project.org/web/packages/R2OpenBUGS/index.html"><code>{R2OpenBUGs}</code> package</a> to create this model with R on the “frontend” and generate the results using the OpenBUGS engine on the “backend”. Regarding the implementation itself, note that I run 100,000 simulations (<code>n.iter</code>), minus 1,000 “burn-in” runs (<code>n.burn</code>).</p>
<p>The raw results are as follows. (As a quick “validation” of these results, note that <span class="math inline">\(\text{baseline}_h &gt; \text{baseline}_a\)</span>, as hypothesized.)</p>
<h1 id="interpretation-discussion">Interpretation &amp; Discussion</h1>
<p>Next, I correspond the strength estimates <span class="math inline">\(z\)</span> to teams. Notably, I must “re-add” the zero-anchored team—Arsenal (whose <span class="math inline">\(z\)</span> is assigned a dummy value of 1). To do this, I impute its credible set quantiles using the values of the overall strength term <span class="math inline">\(z_{\text{all}}\)</span>.</p>
<p><img src="viz_summ_1_z.png" /></p>
<p>It’s not surprising to see that the strength (<span class="math inline">\(z\)</span>) corresponding to all but three teams—Liverpool, Man City, and Tottenham—is negative. These three teams, followed closely by Arsenal have been regarded as the best teams for the past two or three EPL seasons. So, relative to Arsenal, all other teams (aside from the top three) are viewed as “worse” by the model.</p>
<p>Note that the <span class="math inline">\(z\)</span> estimates above should not be interpreted as goals scored by the teams because they are relative to the strength of Arsenal. To facilitate such an interpretation, I need to translate <span class="math inline">\(z\)</span> to goals scored per game. To do this, for each <span class="math inline">\(z\)</span>, I (1) subtract the average value of all <span class="math inline">\(z\)</span>’s, (2) add the posterior mean of <span class="math inline">\(\text{baseline}_{h}\)</span>, and (3) exponentiate.</p>
<p>The plot below shows the results of this transformation.</p>
<p><img src="viz_summ_1_z_adj.png" /></p>
<h2 id="predictions">Predictions</h2>
<p>I can make predictions of game results for the historical data, given the model. Specifically, I simulate the score for both teams in each matchup (1,140 in all) 1,000 times, choosing the result inferred by the mode of each side’s simulated score. (For example, if the mode of the 1,000 simulated scores for the away team is 1 and that of the home team is 2, then the predicted outcome is a win for the home team.) A breakdown of the predicted and actual outcomes is shown below.</p>
<p><img src="viz_conf_mat.png" /></p>
<p>I make a couple of observations:</p>
<ul>
<li>The most common outcome is an actual win by the home team and a predicted win by the home team.</li>
<li>The model never predicts a tie. (This may seem “unreasonable”, but BÃ¥Ã¥th also found this to be true for his final model.)</li>
<li>The model predicts the outcome correctly in 447 + 216 = 663 of 1,140 games (i.e., 58%).</li>
</ul>
<p>The next couple of visuals provide more details regarding the simulated outcomes.</p>
<p><img src="viz_g_mode.png" /></p>
<p>From the above graph of the mode of goals scored by both sides, it’s apparent that a 2-1 scores in favor of the home side is the most common outcome.</p>
<p><img src="viz_g_mean.png" /></p>
<p>The above histogram illustrating the mean (instead of the mode) of the simulated goals provides a bit more nuance to our understanding of modes shown before.</p>
<p><img src="viz_result_mode.png" /></p>
<p>Finally, the above visual shows the predicted outcomes (inferred from the prior graph of predicted modes).</p>
<p>To better understand how the model works on a team-level basis, let’s look at how well it predicts for each team.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Team</th>
<th style="text-align: right;"># of Wins</th>
<th style="text-align: left;">Win %</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Arsenal</td>
<td style="text-align: right;">46</td>
<td style="text-align: left;">80.70%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Man City</td>
<td style="text-align: right;">45</td>
<td style="text-align: left;">78.95%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Tottenham</td>
<td style="text-align: right;">43</td>
<td style="text-align: left;">75.44%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Liverpool</td>
<td style="text-align: right;">41</td>
<td style="text-align: left;">71.93%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Chelsea</td>
<td style="text-align: right;">39</td>
<td style="text-align: left;">68.42%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Cardiff</td>
<td style="text-align: right;">12</td>
<td style="text-align: left;">63.16%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Everton</td>
<td style="text-align: right;">36</td>
<td style="text-align: left;">63.16%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fulham</td>
<td style="text-align: right;">12</td>
<td style="text-align: left;">63.16%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Man United</td>
<td style="text-align: right;">35</td>
<td style="text-align: left;">61.40%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Huddersfield</td>
<td style="text-align: right;">23</td>
<td style="text-align: left;">60.53%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Burnley</td>
<td style="text-align: right;">34</td>
<td style="text-align: left;">59.65%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Stoke</td>
<td style="text-align: right;">22</td>
<td style="text-align: left;">57.89%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Bournemouth</td>
<td style="text-align: right;">30</td>
<td style="text-align: left;">52.63%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Crystal Palace</td>
<td style="text-align: right;">30</td>
<td style="text-align: left;">52.63%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sunderland</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">52.63%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Swansea</td>
<td style="text-align: right;">20</td>
<td style="text-align: left;">52.63%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">West Ham</td>
<td style="text-align: right;">30</td>
<td style="text-align: left;">52.63%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Watford</td>
<td style="text-align: right;">29</td>
<td style="text-align: left;">50.88%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Newcastle</td>
<td style="text-align: right;">19</td>
<td style="text-align: left;">50.00%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Leicester</td>
<td style="text-align: right;">28</td>
<td style="text-align: left;">49.12%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Middlesbrough</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">47.37%</td>
</tr>
<tr class="even">
<td style="text-align: left;">West Brom</td>
<td style="text-align: right;">18</td>
<td style="text-align: left;">47.37%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Wolves</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">47.37%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Brighton</td>
<td style="text-align: right;">15</td>
<td style="text-align: left;">39.47%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Southampton</td>
<td style="text-align: right;">22</td>
<td style="text-align: left;">38.60%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Hull</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">31.58%</td>
</tr>
</tbody>
</table>
<p>In most cases, the model predicts the outcome correctly (see <code>is_correct</code>) with greater than 50% accuracy, although there are also teams for which its accuracy is less than 50%.</p>
<h1 id="conclusion">Conclusion</h1>
<p>In summary, I have created a hierarchical Poisson model to predict scores—and, consequently, game outcomes—for EPL games for the three seasons starting in 2016 and ending in 2018. The model has an training set prediction accuracy of 66.3%. <a href="http://www.sumsar.net/blog/2013/07/modeling-match-results-in-la-liga-part-one/">Baath</a>, whose work inspired mine, achieved an accuracy of 56% with his final model.</p>
<h2 id="future-work">Future Work</h2>
<p>My model can certainly be improved. One major flaw of the model is that it does not account for temporal effects, i.e. differences in team strength across seasons. <a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a> The consequences of this flaw are compounded by the fact that the pool of teams in each EPL season changes. At the end of each season, the three “worst” EPL teams (by win-loss-tie record) are “relegated” to a secondary league, and, in turn, three secondary league teams are “promoted” to the EPL in their place. <a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a> Consequently, one might say that the estimates of the teams that do not appear in all seasons are exaggerated.</p>
<h1 id="appendix">Appendix</h1>
<h2 id="code">Code</h2>
<p>See all relevant R code below.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span>
<span class='co'># Data Collection</span>
<span class='va'>seasons</span> <span class='op'>&lt;-</span> <span class='fl'>2016L</span><span class='op'>:</span><span class='fl'>2018L</span>
<span class='co'># Reference: https://github.com/jalapic/engsoccerdata/blob/master/R/england_current.R</span>
<span class='va'>scrape_epl_data</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>season</span> <span class='op'>=</span> <span class='fu'>lubridate</span><span class='fu'>::</span><span class='fu'><a href='http://lubridate.tidyverse.org/reference/year.html'>year</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.Date</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>1L</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>s1</span> <span class='op'>&lt;-</span> <span class='va'>season</span> <span class='op'>%&gt;%</span> <span class='fu'>str_sub</span><span class='op'>(</span><span class='fl'>3</span>, <span class='fl'>4</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='op'>)</span>
  <span class='va'>s2</span> <span class='op'>&lt;-</span> <span class='va'>s1</span> <span class='op'>+</span> <span class='fl'>1L</span>
  <span class='va'>path</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sprintf.html'>sprintf</a></span><span class='op'>(</span><span class='st'>'http://www.football-data.co.uk/mmz4281/%2d%2d/E0.csv'</span>, <span class='va'>s1</span>, <span class='va'>s2</span><span class='op'>)</span>
  <span class='va'>data_raw</span> <span class='op'>&lt;-</span> <span class='va'>path</span> <span class='op'>%&gt;%</span> <span class='fu'>read_csv</span><span class='op'>(</span><span class='op'>)</span>
  <span class='va'>data</span> <span class='op'>&lt;-</span>
    <span class='va'>data_raw</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>janitor</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/janitor/man/clean_names.html'>clean_names</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>mutate_at</span><span class='op'>(</span><span class='fu'>vars</span><span class='op'>(</span><span class='va'>date</span><span class='op'>)</span>, <span class='op'>~</span><span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='va'>.</span>, <span class='st'>'%d/%m/%y'</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>select</span><span class='op'>(</span>
      <span class='va'>date</span>, 
      tm_h <span class='op'>=</span> <span class='va'>home_team</span>, 
      tm_a <span class='op'>=</span> <span class='va'>away_team</span>,
      g_h <span class='op'>=</span> <span class='va'>fthg</span>,
      g_a <span class='op'>=</span> <span class='va'>ftag</span>
    <span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>mutate</span><span class='op'>(</span>
      g_total <span class='op'>=</span> <span class='va'>g_h</span> <span class='op'>+</span> <span class='va'>g_a</span>,
      g_diff <span class='op'>=</span> <span class='va'>g_h</span> <span class='op'>-</span> <span class='va'>g_a</span>,
      result <span class='op'>=</span> 
        <span class='fu'>case_when</span><span class='op'>(</span>
          <span class='va'>g_h</span> <span class='op'>&gt;</span> <span class='va'>g_a</span> <span class='op'>~</span> <span class='st'>'h'</span>, 
          <span class='va'>g_h</span> <span class='op'>&lt;</span> <span class='va'>g_a</span> <span class='op'>~</span> <span class='st'>'a'</span>, 
          <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='st'>'t'</span>
        <span class='op'>)</span>,
      tm_winner <span class='op'>=</span> 
        <span class='fu'>case_when</span><span class='op'>(</span>
          <span class='va'>g_h</span> <span class='op'>&gt;</span> <span class='va'>g_a</span> <span class='op'>~</span> <span class='va'>tm_h</span>, 
          <span class='va'>g_h</span> <span class='op'>&lt;</span> <span class='va'>g_a</span> <span class='op'>~</span> <span class='va'>tm_a</span>, 
          <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='cn'>NA_character_</span>
        <span class='op'>)</span>
    <span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>mutate_at</span><span class='op'>(</span><span class='fu'>vars</span><span class='op'>(</span><span class='fu'>matches</span><span class='op'>(</span><span class='st'>'season|^g_'</span><span class='op'>)</span><span class='op'>)</span>, <span class='va'>as.integer</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='va'>data</span> <span class='op'>&lt;-</span>
  <span class='fu'>tibble</span><span class='op'>(</span>season <span class='op'>=</span> <span class='va'>seasons</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>data <span class='op'>=</span> <span class='fu'>map</span><span class='op'>(</span><span class='va'>season</span>, <span class='va'>scrape_epl_data</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>unnest</span><span class='op'>(</span><span class='va'>data</span><span class='op'>)</span>
<span class='va'>data</span>
<span class='va'>pull2</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>data</span>, <span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>data</span> <span class='op'>%&gt;%</span>
    <span class='fu'>pull</span><span class='op'>(</span><span class='va'>...</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='va'>tms</span> <span class='op'>&lt;-</span> <span class='va'>data</span> <span class='op'>%&gt;%</span> <span class='fu'>distinct</span><span class='op'>(</span><span class='va'>tm_h</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>arrange</span><span class='op'>(</span><span class='va'>tm_h</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>pull</span><span class='op'>(</span><span class='va'>tm_h</span><span class='op'>)</span>
<span class='va'>n_tm</span> <span class='op'>&lt;-</span> <span class='va'>tms</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>n_gm</span> <span class='op'>&lt;-</span> <span class='va'>data</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>n_season</span> <span class='op'>&lt;-</span> <span class='va'>seasons</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>data_list</span> <span class='op'>&lt;-</span>
  <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    g_h <span class='op'>=</span> <span class='va'>data</span> <span class='op'>%&gt;%</span> <span class='fu'>pull</span><span class='op'>(</span><span class='va'>g_h</span><span class='op'>)</span>,
    g_a <span class='op'>=</span> <span class='va'>data</span> <span class='op'>%&gt;%</span> <span class='fu'>pull</span><span class='op'>(</span><span class='va'>g_a</span><span class='op'>)</span>,
    tm_h <span class='op'>=</span> <span class='va'>data</span> <span class='op'>%&gt;%</span> <span class='fu'>pull2</span><span class='op'>(</span><span class='va'>tm_h</span><span class='op'>)</span>,
    tm_a <span class='op'>=</span> <span class='va'>data</span> <span class='op'>%&gt;%</span> <span class='fu'>pull2</span><span class='op'>(</span><span class='va'>tm_a</span><span class='op'>)</span>,
    season <span class='op'>=</span> <span class='va'>data</span> <span class='op'>%&gt;%</span> <span class='fu'>pull2</span><span class='op'>(</span><span class='va'>season</span><span class='op'>)</span>,
    n_tm <span class='op'>=</span> <span class='va'>n_tm</span>,
    n_gm <span class='op'>=</span> <span class='va'>n_gm</span>,
    n_season <span class='op'>=</span> <span class='va'>n_season</span>
  <span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span><span class='op'>(</span><span class='va'>data_list</span><span class='op'>)</span>
<span class='va'>model_1</span> <span class='op'>&lt;-</span> <span class='fu'>glue</span><span class='fu'>::</span><span class='fu'><a href='https://glue.tidyverse.org/reference/glue_collapse.html'>glue_collapse</a></span><span class='op'>(</span><span class='st'>'model {
  for(g in 1:n_gm) {
    g_h[g] ~ dpois(lambda_h[tm_h[g], tm_a[g]])
    g_a[g] ~ dpois(lambda_a[tm_h[g], tm_a[g]])
  }

  for(h in 1:n_tm) {
    for(a in 1:n_tm) {
      lambda_h[h, a] &lt;- exp(baseline_h + (z[h] - z[a]))
      lambda_a[h, a] &lt;- exp(baseline_a + (z[a] - z[h]))
    }
  }
    
  z[1] &lt;- 0 
  for(t in 2:n_tm) {
    z[t] ~ dnorm(z_all, tau_all)
  }
    
  z_all ~ dnorm(0, 0.25)
  tau_all &lt;- 1 / pow(sigma_all, 2)
  sigma_all ~ dunif(0, 2)
  baseline_h ~ dnorm(0, 0.25)
  baseline_a ~ dnorm(0, 0.25)
}'</span><span class='op'>)</span>

<span class='va'>path_model_1</span> <span class='op'>&lt;-</span> <span class='st'>'model_1.txt'</span>
<span class='fu'>write_lines</span><span class='op'>(</span><span class='va'>model_1</span>, <span class='va'>path_model_1</span><span class='op'>)</span>
<span class='kw'>if</span><span class='op'>(</span><span class='va'>eval_model_1</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='co'># inits_1 &lt;- list(n_tm = data_list$n_tm)</span>
  <span class='va'>inits_1</span> <span class='op'>&lt;-</span> <span class='cn'>NULL</span>
  <span class='va'>params_1</span> <span class='op'>&lt;-</span>
    <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>'baseline'</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'_a'</span>, <span class='st'>'_h'</span><span class='op'>)</span><span class='op'>)</span>,
      <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>'sigma_all'</span><span class='op'>)</span>,
      <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>'z'</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>''</span>, <span class='st'>'_all'</span><span class='op'>)</span><span class='op'>)</span>
    <span class='op'>)</span>
  
  <span class='va'>res_sim_1</span> <span class='op'>&lt;-</span>
    <span class='fu'>R2OpenBUGS</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/R2OpenBUGS/man/bugs.html'>bugs</a></span><span class='op'>(</span>
      <span class='co'># debug = TRUE,</span>
      data <span class='op'>=</span> <span class='va'>data_list</span>,
      inits <span class='op'>=</span> <span class='va'>inits_1</span>,
      model.file <span class='op'>=</span> <span class='va'>path_model_1</span>,
      parameters.to.save <span class='op'>=</span> <span class='va'>params_1</span>,
      DIC <span class='op'>=</span> <span class='cn'>FALSE</span>,
      n.chains <span class='op'>=</span> <span class='fl'>1</span>,
      n.iter <span class='op'>=</span> <span class='fl'>10000</span>,
      n.burnin <span class='op'>=</span> <span class='fl'>1000</span>
    <span class='op'>)</span>
<span class='op'>}</span>
<span class='co'># Model 1 Interpretation</span>
<span class='va'>z_var_lvls</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sprintf.html'>sprintf</a></span><span class='op'>(</span><span class='st'>'z[%d]'</span>, <span class='fl'>2</span><span class='op'>:</span><span class='va'>n_tm</span><span class='op'>)</span>
<span class='va'>var_lvls</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>'baseline'</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'_a'</span>, <span class='st'>'_h'</span><span class='op'>)</span><span class='op'>)</span>, <span class='st'>'sigma_all'</span>, <span class='va'>z_var_lvls</span>, <span class='st'>'z_all'</span><span class='op'>)</span>
<span class='va'>res_sim_summ_1</span> <span class='op'>&lt;-</span>
  <span class='va'>res_sim_1</span><span class='op'>$</span><span class='va'>summary</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>as_tibble</span><span class='op'>(</span>rownames <span class='op'>=</span> <span class='st'>'var'</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'># Re-order these.</span>
  <span class='fu'>mutate_at</span><span class='op'>(</span><span class='fu'>vars</span><span class='op'>(</span><span class='va'>var</span><span class='op'>)</span>, <span class='op'>~</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>.</span>, levels <span class='op'>=</span> <span class='va'>var_lvls</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>arrange</span><span class='op'>(</span><span class='va'>var</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'># Then re-coerce var back to its original data type.</span>
  <span class='fu'>mutate_at</span><span class='op'>(</span><span class='fu'>vars</span><span class='op'>(</span><span class='va'>var</span><span class='op'>)</span>, <span class='va'>as.character</span><span class='op'>)</span>
<span class='va'>res_sim_summ_1</span>

<span class='va'>tms_info</span> <span class='op'>&lt;-</span>
  <span class='fu'>tibble</span><span class='op'>(</span>tm <span class='op'>=</span> <span class='va'>tms</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>tm_idx <span class='op'>=</span> <span class='fu'>row_number</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>tms_info</span>

<span class='va'>res_sim_summ_1_z</span> <span class='op'>&lt;-</span>
  <span class='fu'>bind_rows</span><span class='op'>(</span>
    <span class='va'>res_sim_summ_1</span> <span class='op'>%&gt;%</span> 
      <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>var</span> <span class='op'>==</span> <span class='st'>'z_all'</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
      <span class='fu'>mutate</span><span class='op'>(</span>var <span class='op'>=</span> <span class='st'>'z[1]'</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
      <span class='fu'>mutate</span><span class='op'>(</span>tm_idx <span class='op'>=</span> <span class='fl'>1L</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
      <span class='fu'>mutate_at</span><span class='op'>(</span><span class='fu'>vars</span><span class='op'>(</span><span class='fu'>matches</span><span class='op'>(</span><span class='st'>'%$'</span><span class='op'>)</span><span class='op'>)</span>, <span class='op'>~</span><span class='op'>{</span><span class='va'>.</span> <span class='op'>-</span> <span class='va'>mean</span><span class='op'>}</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
      <span class='fu'>mutate</span><span class='op'>(</span>mean <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span>,
    <span class='va'>res_sim_summ_1</span> <span class='op'>%&gt;%</span> 
      <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>var</span> <span class='op'>%&gt;%</span> <span class='fu'>str_detect</span><span class='op'>(</span><span class='st'>'^z\\['</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
      <span class='fu'>mutate</span><span class='op'>(</span>
        tm_idx <span class='op'>=</span> 
          <span class='va'>var</span> <span class='op'>%&gt;%</span> 
          <span class='fu'>str_replace_all</span><span class='op'>(</span><span class='st'>'(^z\\[)([0-9]+)(\\]$)'</span>, <span class='st'>'\\2'</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
          <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='op'>)</span>
      <span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>left_join</span><span class='op'>(</span><span class='va'>tms_info</span>, by <span class='op'>=</span> <span class='st'>'tm_idx'</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='op'>-</span><span class='va'>tm_idx</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>tm</span>, <span class='fu'>everything</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>arrange</span><span class='op'>(</span><span class='va'>tm</span><span class='op'>)</span>
<span class='va'>res_sim_summ_1_z</span>
<span class='va'>theme_custom</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'>theme_light</span><span class='op'>(</span>base_size <span class='op'>=</span> <span class='fl'>12</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>theme</span><span class='op'>(</span>
      legend.position <span class='op'>=</span> <span class='st'>'bottom'</span>,
      legend.title <span class='op'>=</span> <span class='fu'>element_blank</span><span class='op'>(</span><span class='op'>)</span>,
      axis.title.x <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>hjust <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>,
      axis.title.y <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>hjust <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>,
      <span class='va'>...</span>
    <span class='op'>)</span>
<span class='op'>}</span>

<span class='va'>.lab_subtitle</span> <span class='op'>&lt;-</span> <span class='st'>'Seasons 2016-17 - 2018-19'</span>
<span class='va'>.visualize_res_sim_summ</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>data</span>, <span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>data</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>arrange</span><span class='op'>(</span><span class='op'>-</span><span class='va'>mean</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>mutate_at</span><span class='op'>(</span><span class='fu'>vars</span><span class='op'>(</span><span class='va'>tm</span><span class='op'>)</span>, <span class='op'>~</span><span class='fu'>forcats</span><span class='fu'>::</span><span class='fu'><a href='https://forcats.tidyverse.org/reference/fct_reorder.html'>fct_reorder</a></span><span class='op'>(</span><span class='va'>.</span>, <span class='va'>mean</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>tm</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_pointrange</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>mean</span>, ymin <span class='op'>=</span> <span class='va'>`2.5%`</span>, ymax <span class='op'>=</span> <span class='va'>`97.5%`</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>theme_custom</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>coord_flip</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>labs</span><span class='op'>(</span>
      subtitle <span class='op'>=</span> <span class='va'>.lab_subtitle</span> ,
      caption <span class='op'>=</span> <span class='fu'>glue</span><span class='fu'>::</span><span class='fu'><a href='https://glue.tidyverse.org/reference/glue.html'>glue</a></span><span class='op'>(</span>
        <span class='st'>'Posterior mean and 95% equitailed credible set depicted.
        {tms[1]} used as "zero"-anchor team.'</span>
      <span class='op'>)</span>,
      y <span class='op'>=</span> <span class='cn'>NULL</span>
    <span class='op'>)</span>
<span class='op'>}</span>

<span class='va'>visualize_res_sim_summ_z</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>data</span>, <span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>data</span> <span class='op'>%&gt;%</span>
    <span class='fu'>.visualize_res_sim_summ</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_hline</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>yintercept <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>labs</span><span class='op'>(</span>
      title <span class='op'>=</span> <span class='fu'>glue</span><span class='fu'>::</span><span class='fu'><a href='https://glue.tidyverse.org/reference/glue.html'>glue</a></span><span class='op'>(</span><span class='st'>'Model\'s estimated strength (z)'</span><span class='op'>)</span>,
      x <span class='op'>=</span> <span class='st'>'Posterior mean of z'</span>
    <span class='op'>)</span>
<span class='op'>}</span>

<span class='va'>visualize_res_sim_summ_z_adj</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>data</span>, <span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>data</span> <span class='op'>%&gt;%</span>
    <span class='fu'>.visualize_res_sim_summ</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>labs</span><span class='op'>(</span>
      title <span class='op'>=</span> <span class='fu'>glue</span><span class='fu'>::</span><span class='fu'><a href='https://glue.tidyverse.org/reference/glue.html'>glue</a></span><span class='op'>(</span><span class='st'>'Model\'s estimated goals scored per game'</span><span class='op'>)</span>,
      x <span class='op'>=</span> <span class='st'>'Posterior mean of z transformed to goals'</span>
    <span class='op'>)</span>
<span class='op'>}</span>

<span class='va'>export_png</span> <span class='op'>&lt;-</span>
  <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>,
           <span class='va'>path</span>,
           <span class='va'>...</span>,
           <span class='va'>units</span> <span class='op'>=</span> <span class='st'>'in'</span>,
           <span class='va'>width</span> <span class='op'>=</span> <span class='fl'>7</span>,
           <span class='va'>height</span> <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='fu'>ggsave</span><span class='op'>(</span>
      plot <span class='op'>=</span> <span class='va'>x</span>,
      filename <span class='op'>=</span> <span class='va'>path</span>,
      units <span class='op'>=</span> <span class='va'>units</span>,
      width <span class='op'>=</span> <span class='va'>width</span>,
      height <span class='op'>=</span> <span class='va'>height</span>,
      <span class='va'>...</span>
    <span class='op'>)</span>
  <span class='op'>}</span>
<span class='va'>n_sim</span> <span class='op'>&lt;-</span> <span class='fl'>1000</span>
<span class='va'>path_preds</span> <span class='op'>&lt;-</span> <span class='fu'>file_path_out</span><span class='op'>(</span><span class='st'>'preds_1.rds'</span><span class='op'>)</span>
<span class='va'>eval_preds</span> <span class='op'>&lt;-</span> <span class='cn'>FALSE</span> <span class='co'># !fs::file_exists(path_preds)</span>
<span class='kw'>if</span><span class='op'>(</span><span class='va'>eval_preds</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>.baseline_h</span> <span class='op'>&lt;-</span> <span class='va'>res_sim_summ_1</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>var</span> <span class='op'>==</span> <span class='st'>'baseline_h'</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>pull</span><span class='op'>(</span><span class='va'>mean</span><span class='op'>)</span>
  <span class='va'>.baseline_a</span> <span class='op'>&lt;-</span> <span class='va'>res_sim_summ_1</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>var</span> <span class='op'>==</span> <span class='st'>'baseline_a'</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>pull</span><span class='op'>(</span><span class='va'>mean</span><span class='op'>)</span>
  <span class='va'>.extract_tab_max</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>tab</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='va'>tab</span><span class='op'>[</span> <span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.max</a></span><span class='op'>(</span><span class='va'>tab</span><span class='op'>)</span><span class='op'>]</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='op'>)</span>
  <span class='op'>}</span>
  <span class='va'>do_predict</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>i</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='va'>data_filt</span> <span class='op'>&lt;-</span> <span class='va'>data</span> <span class='op'>%&gt;%</span> <span class='fu'>slice</span><span class='op'>(</span><span class='va'>i</span><span class='op'>)</span>
    <span class='va'>.tm_h</span> <span class='op'>&lt;-</span> <span class='va'>data_filt</span> <span class='op'>%&gt;%</span> <span class='fu'>pull</span><span class='op'>(</span><span class='va'>tm_h</span><span class='op'>)</span>
    <span class='va'>.tm_a</span> <span class='op'>&lt;-</span> <span class='va'>data_filt</span> <span class='op'>%&gt;%</span> <span class='fu'>pull</span><span class='op'>(</span><span class='va'>tm_a</span><span class='op'>)</span>
    <span class='va'>z_h</span> <span class='op'>&lt;-</span> <span class='va'>res_sim_summ_1_z</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>tm</span> <span class='op'>==</span> <span class='va'>.tm_h</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>pull</span><span class='op'>(</span><span class='va'>mean</span><span class='op'>)</span>
    <span class='va'>z_a</span> <span class='op'>&lt;-</span> <span class='va'>res_sim_summ_1_z</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>tm</span> <span class='op'>==</span> <span class='va'>.tm_a</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>pull</span><span class='op'>(</span><span class='va'>mean</span><span class='op'>)</span>
    <span class='va'>g_h</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Poisson.html'>rpois</a></span><span class='op'>(</span><span class='va'>n_sim</span>, <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>.baseline_h</span> <span class='op'>+</span> <span class='op'>(</span><span class='va'>z_h</span> <span class='op'>-</span> <span class='va'>z_a</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
    <span class='va'>g_a</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Poisson.html'>rpois</a></span><span class='op'>(</span><span class='va'>n_sim</span>, <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>.baseline_a</span> <span class='op'>+</span> <span class='op'>(</span><span class='va'>z_a</span> <span class='op'>-</span> <span class='va'>z_h</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
    <span class='va'>tab_h</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>g_h</span><span class='op'>)</span>
    <span class='va'>tab_a</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>g_a</span><span class='op'>)</span>
    <span class='va'>result_sign</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sign.html'>sign</a></span><span class='op'>(</span><span class='va'>g_h</span> <span class='op'>-</span> <span class='va'>g_a</span><span class='op'>)</span>
    <span class='va'>tab_result</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>result_sign</span><span class='op'>)</span>
    <span class='va'>result_mode</span> <span class='op'>&lt;-</span> <span class='fu'>.extract_tab_max</span><span class='op'>(</span><span class='va'>tab_result</span><span class='op'>)</span>
    <span class='fu'>tibble</span><span class='op'>(</span>
      g_h_mode <span class='op'>=</span> <span class='fu'>.extract_tab_max</span><span class='op'>(</span><span class='va'>tab_h</span><span class='op'>)</span>,
      g_a_mode <span class='op'>=</span> <span class='fu'>.extract_tab_max</span><span class='op'>(</span><span class='va'>tab_a</span><span class='op'>)</span>,
      result_mode <span class='op'>=</span> <span class='va'>result_mode</span>,
      g_h_mean <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>g_h</span><span class='op'>)</span>,
      g_a_mean <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>g_a</span><span class='op'>)</span>
    <span class='op'>)</span>
  <span class='op'>}</span>
  
  <span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>42</span><span class='op'>)</span>
  <span class='va'>preds</span> <span class='op'>&lt;-</span> 
    <span class='fu'>tibble</span><span class='op'>(</span>idx <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='va'>n_gm</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>mutate</span><span class='op'>(</span>res <span class='op'>=</span> <span class='fu'>map</span><span class='op'>(</span><span class='va'>idx</span>, <span class='va'>do_predict</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>unnest</span><span class='op'>(</span><span class='va'>res</span><span class='op'>)</span>
  <span class='va'>preds</span>
<span class='op'>}</span>
<span class='va'>preds_tidy</span> <span class='op'>&lt;-</span> 
  <span class='va'>preds</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>gather</span><span class='op'>(</span>key <span class='op'>=</span> <span class='st'>'key'</span>, value <span class='op'>=</span> <span class='st'>'value'</span>, <span class='op'>-</span><span class='va'>idx</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>idx</span>, <span class='va'>key</span>, <span class='va'>value</span><span class='op'>)</span>
<span class='va'>preds_tidy</span>

<span class='va'>.key_lab_g_stem</span> <span class='op'>&lt;-</span> <span class='st'>'Team Goals'</span>
<span class='va'>.key_lab_g_h_prefix</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sprintf.html'>sprintf</a></span><span class='op'>(</span><span class='st'>'Home %s, %%s'</span>, <span class='va'>.key_lab_g_stem</span><span class='op'>)</span>
<span class='va'>.key_lab_g_a_prefix</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sprintf.html'>sprintf</a></span><span class='op'>(</span><span class='st'>'Away %s, %%s'</span>, <span class='va'>.key_lab_g_stem</span><span class='op'>)</span>
<span class='va'>keys_info</span> <span class='op'>&lt;-</span>
  <span class='fu'>tribble</span><span class='op'>(</span>
    <span class='op'>~</span><span class='va'>key</span>, <span class='op'>~</span><span class='va'>key_lab</span>,
    <span class='st'>'g_h_mode'</span>, <span class='fu'><a href='https://rdrr.io/r/base/sprintf.html'>sprintf</a></span><span class='op'>(</span><span class='va'>.key_lab_g_h_prefix</span>, <span class='st'>'Mode'</span><span class='op'>)</span>,
    <span class='st'>'g_a_mode'</span>, <span class='fu'><a href='https://rdrr.io/r/base/sprintf.html'>sprintf</a></span><span class='op'>(</span><span class='va'>.key_lab_g_a_prefix</span>, <span class='st'>'Mode'</span><span class='op'>)</span>,
    <span class='st'>'g_h_mean'</span>, <span class='fu'><a href='https://rdrr.io/r/base/sprintf.html'>sprintf</a></span><span class='op'>(</span><span class='va'>.key_lab_g_h_prefix</span>, <span class='st'>'Mean'</span><span class='op'>)</span>,
    <span class='st'>'g_a_mean'</span>, <span class='fu'><a href='https://rdrr.io/r/base/sprintf.html'>sprintf</a></span><span class='op'>(</span><span class='va'>.key_lab_g_a_prefix</span>, <span class='st'>'Mean'</span><span class='op'>)</span>,
    <span class='st'>'result_mode'</span>, <span class='st'>'Result, Mode'</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>idx <span class='op'>=</span> <span class='fu'>row_number</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate_at</span><span class='op'>(</span><span class='fu'>vars</span><span class='op'>(</span><span class='va'>key_lab</span><span class='op'>)</span>, <span class='op'>~</span><span class='fu'>forcats</span><span class='fu'>::</span><span class='fu'><a href='https://forcats.tidyverse.org/reference/fct_reorder.html'>fct_reorder</a></span><span class='op'>(</span><span class='va'>.</span>, <span class='va'>idx</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='op'>-</span><span class='va'>idx</span><span class='op'>)</span>
<span class='va'>keys_info</span>

<span class='va'>preds_tidy_aug</span> <span class='op'>&lt;-</span>
  <span class='va'>preds_tidy</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>inner_join</span><span class='op'>(</span><span class='va'>keys_info</span><span class='op'>)</span>
<span class='va'>preds_tidy_aug</span>

<span class='va'>preds_aug</span> <span class='op'>&lt;-</span>
  <span class='va'>preds</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>inner_join</span><span class='op'>(</span><span class='va'>data</span> <span class='op'>%&gt;%</span> <span class='fu'>mutate</span><span class='op'>(</span>idx <span class='op'>=</span> <span class='fu'>row_number</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate_at</span><span class='op'>(</span>
    <span class='fu'>vars</span><span class='op'>(</span><span class='va'>result_mode</span><span class='op'>)</span>,
    <span class='op'>~</span><span class='fu'>case_when</span><span class='op'>(</span>
      <span class='va'>.</span> <span class='op'>==</span> <span class='fl'>1</span> <span class='op'>~</span> <span class='st'>'h'</span>, 
      <span class='va'>.</span> <span class='op'>==</span> <span class='op'>-</span><span class='fl'>1</span> <span class='op'>~</span> <span class='st'>'a'</span>, 
      <span class='va'>.</span> <span class='op'>==</span> <span class='fl'>0</span> <span class='op'>~</span> <span class='st'>'t'</span>
    <span class='op'>)</span>
  <span class='op'>)</span>
<span class='va'>conf_mat_tidy</span> <span class='op'>&lt;-</span>
  <span class='va'>preds_aug</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>count</span><span class='op'>(</span><span class='va'>result_mode</span>, <span class='va'>result</span><span class='op'>)</span>

<span class='va'>conf_mat_correct</span> <span class='op'>&lt;-</span>
  <span class='va'>conf_mat_tidy</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>group_by</span><span class='op'>(</span>is_correct <span class='op'>=</span> <span class='va'>result_mode</span> <span class='op'>==</span> <span class='va'>result</span><span class='op'>)</span> 

<span class='va'>conf_mat_correct_summ</span> <span class='op'>&lt;-</span>
  <span class='va'>conf_mat_correct</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>summarise_at</span><span class='op'>(</span><span class='fu'>vars</span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span>, <span class='op'>~</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>.</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>frac <span class='op'>=</span> <span class='va'>n</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>conf_mat_correct</span>

<span class='va'>conf_mat_correct_h</span> <span class='op'>&lt;-</span> <span class='va'>conf_mat_correct</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>is_correct</span>, <span class='va'>result</span> <span class='op'>==</span> <span class='st'>'h'</span><span class='op'>)</span>
<span class='co'># conf_mat_correct_t &lt;- conf_mat_correct %&gt;% filter(is_correct, result == 't')</span>
<span class='va'>conf_mat_correct_a</span> <span class='op'>&lt;-</span> <span class='va'>conf_mat_correct</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>is_correct</span>, <span class='va'>result</span> <span class='op'>==</span> <span class='st'>'a'</span><span class='op'>)</span>
<span class='va'>conf_mat_correct_summ_yes</span> <span class='op'>&lt;-</span> <span class='va'>conf_mat_correct_summ</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>is_correct</span><span class='op'>)</span>

<span class='va'>viz_conf_mat</span> <span class='op'>&lt;-</span>
  <span class='va'>conf_mat_tidy</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>frac <span class='op'>=</span> <span class='va'>n</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>n_lab <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sprintf.html'>sprintf</a></span><span class='op'>(</span><span class='st'>'%s (%s)'</span>, <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org//reference/label_number.html'>comma</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span>, <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org//reference/label_percent.html'>percent</a></span><span class='op'>(</span><span class='va'>frac</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate_at</span><span class='op'>(</span>
    <span class='fu'>vars</span><span class='op'>(</span><span class='fu'>matches</span><span class='op'>(</span><span class='st'>'result'</span><span class='op'>)</span><span class='op'>)</span>, 
    <span class='op'>~</span><span class='fu'>forcats</span><span class='fu'>::</span><span class='fu'><a href='https://forcats.tidyverse.org/reference/fct_relevel.html'>fct_relevel</a></span><span class='op'>(</span><span class='va'>.</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'h'</span>, <span class='st'>'a'</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># c('h', 't', 'a'))</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate_at</span><span class='op'>(</span>
    <span class='fu'>vars</span><span class='op'>(</span><span class='fu'>matches</span><span class='op'>(</span><span class='st'>'result'</span><span class='op'>)</span><span class='op'>)</span>, 
    <span class='op'>~</span><span class='fu'>forcats</span><span class='fu'>::</span><span class='fu'><a href='https://forcats.tidyverse.org/reference/fct_recode.html'>fct_recode</a></span><span class='op'>(</span><span class='va'>.</span>, Home <span class='op'>=</span> <span class='st'>'h'</span>, Away <span class='op'>=</span> <span class='st'>'a'</span><span class='op'>)</span> <span class='co'># , Tie = 't')</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>result_mode</span>, y <span class='op'>=</span> <span class='va'>result</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_tile</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_text</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>label <span class='op'>=</span> <span class='va'>n_lab</span><span class='op'>)</span>, size <span class='op'>=</span> <span class='fl'>5</span>, fontface <span class='op'>=</span> <span class='st'>'bold'</span>, color <span class='op'>=</span> <span class='st'>'black'</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='co'># scale_fill_manual(limits = c(0, 0.5)) +</span>
  <span class='fu'>scale_fill_viridis_c</span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>0.5</span>, begin <span class='op'>=</span> <span class='fl'>0</span>, end <span class='op'>=</span> <span class='fl'>1</span>, option <span class='op'>=</span> <span class='st'>'E'</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_custom</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>
    legend.position <span class='op'>=</span> <span class='st'>'none'</span>,
    panel.grid.major <span class='op'>=</span> <span class='fu'>element_blank</span><span class='op'>(</span><span class='op'>)</span>,
    panel.grid.minor <span class='op'>=</span> <span class='fu'>element_blank</span><span class='op'>(</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>
    title <span class='op'>=</span> <span class='st'>'Comparison of Predicted and Actual Game Outcomes'</span>,
    subtitle <span class='op'>=</span> <span class='va'>.lab_subtitle</span>,
    x <span class='op'>=</span> <span class='st'>'Predicted Result'</span>,
    y <span class='op'>=</span> <span class='st'>'Actual Result'</span>
  <span class='op'>)</span>
<span class='va'>viz_conf_mat</span>
<span class='va'>viz_g_mode</span> <span class='op'>&lt;-</span>
  <span class='va'>preds_tidy_aug</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>key</span> <span class='op'>%&gt;%</span> <span class='fu'>str_detect</span><span class='op'>(</span><span class='st'>'^g.*mode$'</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>value</span>, fill <span class='op'>=</span> <span class='va'>key_lab</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_fill_brewer</span><span class='op'>(</span>palette <span class='op'>=</span> <span class='st'>'Set1'</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_bar</span><span class='op'>(</span>position <span class='op'>=</span> <span class='st'>'dodge'</span>, alpha <span class='op'>=</span> <span class='fl'>0.8</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_custom</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>
    panel.grid.major.x <span class='op'>=</span> <span class='fu'>element_blank</span><span class='op'>(</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>
    title <span class='op'>=</span> <span class='st'>'Simulated Mode of Goals Scored By Home and Away Teams'</span>,
    subtitle <span class='op'>=</span> <span class='va'>.lab_subtitle</span>,
    caption <span class='op'>=</span> <span class='va'>.lab_caption_n_gm</span>,
    x <span class='op'>=</span> <span class='st'>'Goals Scored'</span>,
    y <span class='op'>=</span> <span class='st'>'Count of Games'</span>
  <span class='op'>)</span>
<span class='va'>viz_g_mode</span>
<span class='va'>viz_g_mean</span> <span class='op'>&lt;-</span>
  <span class='va'>preds_tidy_aug</span> <span class='op'>%&gt;%</span> 
  <span class='co'># This is done so that the `aes()` can be defined before data is actually passed into the whole ggplot pipeline.</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'>row_number</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>==</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>value</span>, fill <span class='op'>=</span> <span class='va'>key_lab</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_fill_brewer</span><span class='op'>(</span>palette <span class='op'>=</span> <span class='st'>'Set1'</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_histogram</span><span class='op'>(</span>data <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>preds_tidy_aug</span>, <span class='va'>key</span> <span class='op'>==</span> <span class='st'>'g_h_mean'</span><span class='op'>)</span>, alpha <span class='op'>=</span> <span class='fl'>1</span>, binwidth <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_histogram</span><span class='op'>(</span>data <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>preds_tidy_aug</span>, <span class='va'>key</span> <span class='op'>==</span> <span class='st'>'g_a_mean'</span><span class='op'>)</span>, alpha <span class='op'>=</span> <span class='fl'>0.5</span>, binwidth <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>
    panel.grid.major.x <span class='op'>=</span> <span class='fu'>element_blank</span><span class='op'>(</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_custom</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>
    title <span class='op'>=</span> <span class='st'>'Simulated Mean of Goals Scored By Home and Away Teams'</span>,
    subtitle <span class='op'>=</span> <span class='va'>.lab_subtitle</span> ,
    caption <span class='op'>=</span> <span class='va'>.lab_caption_n_gm</span>,
    x <span class='op'>=</span> <span class='st'>'Goals Scored'</span>,
    y <span class='op'>=</span> <span class='st'>'Count of Games'</span>
  <span class='op'>)</span>
<span class='va'>viz_g_mean</span>
<span class='va'>preds_tidy_res</span> <span class='op'>&lt;-</span>
  <span class='va'>preds_tidy</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>key</span> <span class='op'>==</span> <span class='st'>'res_mode'</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate_at</span><span class='op'>(</span>
    <span class='fu'>vars</span><span class='op'>(</span><span class='va'>value</span><span class='op'>)</span>,
    <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>value_lab <span class='op'>=</span> <span class='op'>~</span><span class='fu'>case_when</span><span class='op'>(</span>
      <span class='va'>.</span> <span class='op'>==</span> <span class='fl'>1</span> <span class='op'>~</span> <span class='st'>'Home Team Wins'</span>,
      <span class='va'>.</span> <span class='op'>==</span> <span class='fl'>0</span> <span class='op'>~</span> <span class='st'>'Draw'</span>,
      <span class='va'>.</span> <span class='op'>==</span> <span class='op'>-</span><span class='fl'>1</span> <span class='op'>~</span> <span class='st'>'Away Team Wins'</span>
    <span class='op'>)</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate_at</span><span class='op'>(</span><span class='fu'>vars</span><span class='op'>(</span><span class='va'>value_lab</span><span class='op'>)</span>, <span class='op'>~</span><span class='fu'>forcats</span><span class='fu'>::</span><span class='fu'><a href='https://forcats.tidyverse.org/reference/fct_reorder.html'>fct_reorder</a></span><span class='op'>(</span><span class='va'>.</span>, <span class='va'>value</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>preds_tidy_res</span> <span class='op'>%&gt;%</span> <span class='fu'>count</span><span class='op'>(</span><span class='va'>value_lab</span><span class='op'>)</span>

<span class='va'>viz_result_mode</span> <span class='op'>&lt;-</span>
  <span class='va'>preds_tidy</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>key</span> <span class='op'>==</span> <span class='st'>'result_mode'</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate_at</span><span class='op'>(</span>
    <span class='fu'>vars</span><span class='op'>(</span><span class='va'>value</span><span class='op'>)</span>,
    <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>value_lab <span class='op'>=</span> <span class='op'>~</span><span class='fu'>case_when</span><span class='op'>(</span>
      <span class='va'>.</span> <span class='op'>==</span> <span class='fl'>1</span> <span class='op'>~</span> <span class='st'>'Home Team Wins'</span>,
      <span class='va'>.</span> <span class='op'>==</span> <span class='fl'>0</span> <span class='op'>~</span> <span class='st'>'Draw'</span>,
      <span class='va'>.</span> <span class='op'>==</span> <span class='op'>-</span><span class='fl'>1</span> <span class='op'>~</span> <span class='st'>'Away Team Wins'</span>
    <span class='op'>)</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate_at</span><span class='op'>(</span><span class='fu'>vars</span><span class='op'>(</span><span class='va'>value_lab</span><span class='op'>)</span>, <span class='op'>~</span><span class='fu'>forcats</span><span class='fu'>::</span><span class='fu'><a href='https://forcats.tidyverse.org/reference/fct_reorder.html'>fct_reorder</a></span><span class='op'>(</span><span class='va'>.</span>, <span class='va'>value</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>value_lab</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_bar</span><span class='op'>(</span>position <span class='op'>=</span> <span class='st'>'dodge'</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_custom</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>
    panel.grid.major.x <span class='op'>=</span> <span class='fu'>element_blank</span><span class='op'>(</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>
    title <span class='op'>=</span> <span class='st'>'Simulated Result of Games'</span>,
    subtitle <span class='op'>=</span> <span class='va'>.lab_subtitle</span> ,
    caption <span class='op'>=</span> <span class='va'>.lab_caption_n_gm</span>,
    x <span class='op'>=</span> <span class='cn'>NULL</span>,
    y <span class='op'>=</span> <span class='st'>'Count of Games'</span>
  <span class='op'>)</span>
<span class='va'>viz_result_mode</span>
<span class='va'>preds_by_tm</span> <span class='op'>&lt;-</span>
  <span class='va'>preds_aug</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>tm_h</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>count</span><span class='op'>(</span>is_correct <span class='op'>=</span> <span class='va'>result_mode</span> <span class='op'>==</span> <span class='va'>result</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>frac <span class='op'>=</span> <span class='va'>n</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>is_correct</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>arrange</span><span class='op'>(</span><span class='op'>-</span><span class='va'>frac</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>pct <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org//reference/label_percent.html'>percent</a></span><span class='op'>(</span><span class='va'>frac</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='op'>-</span><span class='va'>frac</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>This is arguably a “bad” assumption. <a href="http://article.sapub.org/10.5923.s.sports.201401.08.html">Research</a> has shown that goal rate per minute increases in the last 15 minutes of a game.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p>This may also be perceived to be a questionable assumption. One may argue that a matchup of “styles”—e.g. an aggressive team against another aggressive team—may distort the results from what would otherwise be expected.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3" role="doc-endnote"><p>This approach is arguably too “simplistic”, but it is certainly a valid approach.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4" role="doc-endnote"><p>See this <a href="https://www.pinnacle.com/en/betting-articles/Soccer/how-to-calculate-poisson-distribution/MD62MLXUMKMXZ6A8">Pinnacle blog post</a> for a discussion of the topic. (Undoubtedly there are many more articles and papers that explore a similar notion.)<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5" role="doc-endnote"><p>There are several notable differences with my work compared to that of BÃ¥Ã¥th: (1) I use the <a href="http://www.openbugs.net/w/FrontPage">OpenBUGS</a> software (and the <a href="https://cran.r-project.org/web/packages/R2OpenBUGS/index.html"><code>{R2OpenBUGS}</code> package</a>) instead of JAGS; (2) I evaluate EPL teams instead of La Liga teams, and over a different time period; (3) I use a “tidy” approach (in terms of packages, plotting, coding style, etc.) instead of a more traditional “base R” approach; (4) I implement a modified version of the second of Baath’s three proposed models (notably, using different priors).<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6" role="doc-endnote"><p>Baath’s work is licensed under the <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons license</a>, which allows for others to adapt the work of another.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7" role="doc-endnote"><p>Note that I substitute the baseline home average goal rate with a baseline for away teams, <span class="math inline">\(\text{baseline}_a\)</span>, and I swap the order of the <span class="math inline">\(z_j\)</span> and <span class="math inline">\(z_i\)</span> teams since the relationship is not bi-directional. Also, note that I am careful to distinguish between subscript pair <span class="math inline">\(_h\)</span> and <span class="math inline">\(_a\)</span> for home and away and pair <span class="math inline">\(_i\)</span> and <span class="math inline">\(_j\)</span> for team <span class="math inline">\(i\)</span> and team <span class="math inline">\(j\)</span>. The latter pair is independent of the notion of home or away.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8" role="doc-endnote"><p>There are certainly also changes in team strength within seasons, which are even more difficult to model.<a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn9" role="doc-endnote"><p>This explains why there are more than 20 teams in thee data set even though there are only 20 teams in the EPL in a given season.<a href="#fnref9" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">ElHabr (2019, Dec. 13). My Blog: A Bayesian Approach to Ranking English Premier League Teams (using R). Retrieved from https//tonyelhabr.rbind.io/</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@misc{elhabr2019a,
  author = {ElHabr, Tony},
  title = {My Blog: A Bayesian Approach to Ranking English Premier League Teams (using R)},
  url = {https//tonyelhabr.rbind.io/},
  year = {2019}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
