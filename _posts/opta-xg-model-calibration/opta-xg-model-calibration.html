<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>


  <!--radix_placeholder_meta_tags-->
  <title>xG Model Calibration</title>

  <meta property="description" itemprop="description" content="Evaluating Opta&#39;s xG Model performance with Brier Skill Score and Calibration Plots"/>


  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2023-02-20"/>
  <meta property="article:created" itemprop="dateCreated" content="2023-02-20"/>
  <meta name="article:author" content="Tony ElHabr"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="xG Model Calibration"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="Evaluating Opta&#39;s xG Model performance with Brier Skill Score and Calibration Plots"/>
  <meta property="og:locale" content="en_US"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="xG Model Calibration"/>
  <meta property="twitter:description" content="Evaluating Opta&#39;s xG Model performance with Brier Skill Score and Calibration Plots"/>

  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","categories","output","preview","twitter","site","creator"]}},"value":[{"type":"character","attributes":{},"value":["xG Model Calibration"]},{"type":"character","attributes":{},"value":["Evaluating Opta's xG Model performance with Brier Skill Score and Calibration Plots"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url"]}},"value":[{"type":"character","attributes":{},"value":["Tony ElHabr"]},{"type":"character","attributes":{},"value":["https://twitter.com/TonyElHabr"]}]}]},{"type":"character","attributes":{},"value":["2023-02-20"]},{"type":"character","attributes":{},"value":["r","soccer"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["toc","toc_depth","self_contained"]}},"value":[{"type":"logical","attributes":{},"value":[true]},{"type":"integer","attributes":{},"value":[4]},{"type":"logical","attributes":{},"value":[false]}]}]},{"type":"character","attributes":{},"value":["footedness_calibration.png"]},{"type":"NULL"},{"type":"character","attributes":{},"value":["@TonyElHabr"]},{"type":"character","attributes":{},"value":["@TonyElHabr"]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["deflection_calibration.png","footedness_calibration.png","league_group_calibration.png","old_vs_new_xg.png","old_xg_vs_xgd.png","overall_calibration.png","sca1_calibration.png"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        if ($(this).children()[0].nodeName == "D-FOOTNOTE") {
          var fn = $(this).children()[0]
          $(this).html(fn.shadowRoot.querySelector("sup"))
          $(this).id = fn.id
          fn.remove()
        }
        var refs = $(this).attr('data-cites').split(" ");
        var refHtml = refs.map(function(ref) {
          return "<p>" + $('#ref-' + ref).html() + "</p>";
        }).join("\n");
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // fix footnotes in tables (#411)
      // replacing broken distill.pub feature
      $('table d-footnote').each(function() {
        // we replace internal showAtNode methode which is triggered when hovering a footnote
        this.hoverBox.showAtNode = function(node) {
          // ported from https://github.com/distillpub/template/pull/105/files
          calcOffset = function(elem) {
              let x = elem.offsetLeft;
              let y = elem.offsetTop;
              // Traverse upwards until an `absolute` element is found or `elem`
              // becomes null.
              while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                  x += elem.offsetLeft;
                  y += elem.offsetTop;
              }

              return { left: x, top: y };
          }
          // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
          const bbox = node.getBoundingClientRect();
          const offset = calcOffset(node);
          this.show([offset.left + bbox.width, offset.top + bbox.height]);
        }
      })

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      // ignore leaflet img layers (#106)
      figures = figures.filter(':not(img[class*="leaflet"])')
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="opta-xg-model-calibration_files/header-attrs-2.14/header-attrs.js"></script>
  <script src="opta-xg-model-calibration_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="opta-xg-model-calibration_files/popper-2.6.0/popper.min.js"></script>
  <link href="opta-xg-model-calibration_files/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="opta-xg-model-calibration_files/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="opta-xg-model-calibration_files/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="opta-xg-model-calibration_files/anchor-4.2.2/anchor.min.js"></script>
  <script src="opta-xg-model-calibration_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="opta-xg-model-calibration_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="opta-xg-model-calibration_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"xG Model Calibration","description":"Evaluating Opta's xG Model performance with Brier Skill Score and Calibration Plots","authors":[{"author":"Tony ElHabr","authorURL":"https://twitter.com/TonyElHabr","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2023-02-20T00:00:00.000-06:00","citationText":"ElHabr, 2023"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>xG Model Calibration</h1>
<!--radix_placeholder_categories-->
<div class="dt-tags">
<div class="dt-tag">r</div>
<div class="dt-tag">soccer</div>
</div>
<!--/radix_placeholder_categories-->
<p>Evaluating Opta’s xG Model performance with Brier Skill Score and
Calibration Plots</p>
</div>

<div class="d-byline">
  Tony ElHabr <a href="https://twitter.com/TonyElHabr"
class="uri">https://twitter.com/TonyElHabr</a> 
  
<br/>2023-02-20
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#introduction" id="toc-introduction">Introduction</a></li>
<li><a href="#pre--and-post-update-xg-comparison"
id="toc-pre--and-post-update-xg-comparison">1. Pre- and post-update xG
comparison</a></li>
<li><a href="#xg-model-calibration" id="toc-xg-model-calibration">2. xG
Model Calibration</a>
<ul>
<li><a href="#calibration-plot" id="toc-calibration-plot">Calibration
plot</a></li>
<li><a href="#brier-skill-score-bss"
id="toc-brier-skill-score-bss">Brier Skill Score (BSS)</a></li>
<li><a href="#grouped-calibration-and-bss"
id="toc-grouped-calibration-and-bss">Grouped Calibration and
BSS</a></li>
</ul></li>
<li><a href="#conclusion" id="toc-conclusion">Conclusion</a></li>
</ul>
</nav>
</div>
<h2 id="introduction">Introduction</h2>
<p>Recently, <a
href="https://twitter.com/TonyElHabr/status/1614288983105617922">I
pointed out</a> what seemed to be a bug with the <a
href="https://theanalyst.com/na/2021/07/what-are-expected-goals-xg/">expected
goals (xG)</a> data shown on <a href="https://fbref.com">FBref</a>. In
particular, the difference between non-penalty goals (npG) and
non-penalty xG (npxG)<a href="#fn1" class="footnote-ref" id="fnref1"
role="doc-noteref"><sup>1</sup></a> seemed to be an outlier for the
2021/22 season across <a
href="https://fbref.com/en/comps/Big5/Big-5-European-Leagues-Stats">the
Big 5 leagues</a>.</p>
<blockquote class="twitter-tweet">
<p lang="en" dir="ltr">
<p>“aLl xG mOdeLs ArE thE sAme”<br><br>my brother in christ wut is this
then
<a href="https://t.co/7tjp1VFkoc">pic.twitter.com/7tjp1VFkoc</a></p>
</p>
<p>— Tony (<span class="citation"
data-cites="TonyElHabr">@TonyElHabr</span>)
<a href="https://twitter.com/TonyElHabr/status/1614288983105617922?ref_src=twsrc%5Etfw">January
14, 2023</a></p>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>As it turns out FBref and their data provider, <a
href="https://www.statsperform.com/opta/">Opta</a>, agreed! On Feb. 8,
2023, <a
href="https://twitter.com/fbref/status/1623358271791722502?s=20">they
posted an update</a> indicating that they adjusted 2021/22 xG such that
the difference between npG and npxG is much more in line with other
seasons.</p>
<p>The FBref/Opta update gave me two ideas:</p>
<ol type="1">
<li><p><strong>Compare pre- and post-update xG</strong> to identify
where/how adjustments were applied.<a href="#fn2" class="footnote-ref"
id="fnref2" role="doc-noteref"><sup>2</sup></a></p></li>
<li><p><strong>Quantify the <a
href="https://en.wikipedia.org/wiki/Calibration_(statistics)">calibration</a>
of their xG model.</strong></p></li>
</ol>
<h2 id="pre--and-post-update-xg-comparison">1. Pre- and post-update xG
comparison</h2>
<p>First, let’s take a wholistic look at all of the shots for the
2021/22 seasons played in Big 5 leagues.<a href="#fn3"
class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<p><img src="old_vs_new_xg.png" /> Of the 44,986 shots in the data set,
30,326 (67.2%) had changes to their xG values.<a href="#fn4"
class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> Of
those that changed, 23, 584 (78.0%) were reduced, i.e. the pre-update xG
value was higher. The average change was pretty minimal, just about
~0.01 xG.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>glimpse</span><span class='op'>(</span><span class='va'>discretized_updated_np_shots</span><span class='op'>)</span>
<span class='co'>#&gt; Rows: 44,986</span>
<span class='co'>#&gt; Columns: 16</span>
<span class='co'>#&gt; $ league             &lt;fct&gt; ENG, ENG, ENG, ENG, ENG, ENG, ENG, ENG, ENG, ENG, E…</span>
<span class='co'>#&gt; $ date               &lt;date&gt; 2021-08-13, 2021-08-13, 2021-08-13, 2021-08-13, 20…</span>
<span class='co'>#&gt; $ half               &lt;dbl&gt; 1, 1, 1, 1, 1, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 2, 2, …</span>
<span class='co'>#&gt; $ minute             &lt;chr&gt; "11", "12", "22", "28", "30", "66", "73", "80", "2"…</span>
<span class='co'>#&gt; $ team               &lt;chr&gt; "Brentford", "Brentford", "Brentford", "Brentford",…</span>
<span class='co'>#&gt; $ player             &lt;chr&gt; "Frank Onyeka", "Bryan Mbeumo", "Sergi Canós", "Ser…</span>
<span class='co'>#&gt; $ new_xg             &lt;dbl&gt; 0.08, 0.09, 0.02, 0.06, 0.26, 0.06, 0.40, 0.28, 0.0…</span>
<span class='co'>#&gt; $ old_xg             &lt;dbl&gt; 0.09, 0.14, 0.04, 0.07, 0.31, 0.13, 0.58, 0.27, 0.0…</span>
<span class='co'>#&gt; $ is_goal            &lt;fct&gt; no, no, yes, no, no, no, yes, no, no, no, no, no, n…</span>
<span class='co'>#&gt; $ distance           &lt;fct&gt; "(8,10]", "(12,14]", "(16,18]", "(20,25]", "(12,14]…</span>
<span class='co'>#&gt; $ sca1               &lt;fct&gt; pass_live, pass_live, pass_live, pass_live, take_on…</span>
<span class='co'>#&gt; $ body_part          &lt;fct&gt; Head, Right Foot, Right Foot, Right Foot, Right Foo…</span>
<span class='co'>#&gt; $ is_from_deflection &lt;fct&gt; no, no, no, no, no, no, no, no, no, no, no, no, no,…</span>
<span class='co'>#&gt; $ is_from_volley     &lt;fct&gt; no, no, no, no, no, no, no, no, no, yes, no, no, no…</span>
<span class='co'>#&gt; $ is_free_kick       &lt;fct&gt; no, no, no, no, no, no, no, no, no, no, no, no, no,…</span>
<span class='co'>#&gt; $ is_primary_foot    &lt;fct&gt; missing, no, yes, yes, no, yes, missing, missing, y…</span>

<span class='va'>discretized_updated_np_shots</span> |&gt; 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='va'>is_penalty</span><span class='op'>)</span> |&gt; 
  <span class='fu'>mutate</span><span class='op'>(</span>xgd <span class='op'>=</span> <span class='va'>old_xg</span> <span class='op'>-</span> <span class='va'>new_xg</span><span class='op'>)</span> |&gt; 
  <span class='fu'>pull</span><span class='op'>(</span><span class='va'>xgd</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='co'>#&gt; [1] 0.0095014</span>
</code></pre>
</div>
</div>
<p>To get more insight into how/why xG changed, we can look at changes
to xG values grouped by various <code>feature</code>s that FBref
publishes alongside each shot’s xG, including <code>distance</code>
(yards), <code>sca1</code> (direct <a
href="https://www.sports-reference.com/blog/2020/04/goal-creation-possession-passing-and-more-advanced-stats-on-fbref/">shot-creating
action</a>), <code>body_part</code>, <code>is_from_deflection</code>,
<code>is_from_volley</code>, <code>is_free_kick</code>, and
<code>is_primary_foot</code>.<a href="#fn5" class="footnote-ref"
id="fnref5" role="doc-noteref"><sup>5</sup></a><a href="#fn6"
class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></p>
<p>The table below shows that the reductions in npxG occurred most
frequently for longer <code>distance</code>s, suggesting that the
pre-update xG model was over-predicting xG for longer shots.
Interestingly, xG for shots when interceptions led directly to the shot
(<code>sca1</code>), and xG for shots with
<code>body_part = "other"</code> (non-foot, non-header) were also
frequently reduced, in the cases where xG was changed.</p>
<table>
<colgroup>
<col style="width: 8%" />
<col style="width: 12%" />
<col style="width: 16%" />
<col style="width: 20%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Feature</th>
<th style="text-align: left;">Group</th>
<th style="text-align: right;"># of non-penalty shots</th>
<th style="text-align: right;"># of shots with changed npxG</th>
<th style="text-align: right;"># of shots with lower post-update npxG of
those that changed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>distance</code></td>
<td style="text-align: left;"><code>(25,30]</code></td>
<td style="text-align: right;">6,061</td>
<td style="text-align: right;">3,659 (60.4%)</td>
<td style="text-align: right;">3,437 (93.9%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>distance</code></td>
<td style="text-align: left;"><code>(20,25]</code></td>
<td style="text-align: right;">6,760</td>
<td style="text-align: right;">4,463 (66.0%)</td>
<td style="text-align: right;">4,088 (91.6%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>sca1</code></td>
<td style="text-align: left;"><code>"interception"</code></td>
<td style="text-align: right;">149</td>
<td style="text-align: right;">96 (64.4%)</td>
<td style="text-align: right;">87 (90.6%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>distance</code></td>
<td style="text-align: left;"><code>(18,20]</code></td>
<td style="text-align: right;">1,889</td>
<td style="text-align: right;">1,232 (65.2%)</td>
<td style="text-align: right;">1,088 (88.3%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>distance</code></td>
<td style="text-align: left;"><code>(30,35]</code></td>
<td style="text-align: right;">2,725</td>
<td style="text-align: right;">1,267 (46.5%)</td>
<td style="text-align: right;">1,117 (88.2%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>body_part</code></td>
<td style="text-align: left;"><code>"Other"</code></td>
<td style="text-align: right;">191</td>
<td style="text-align: right;">153 (80.1%)</td>
<td style="text-align: right;">130 (85.0%)</td>
</tr>
</tbody>
</table>
<p>On the other end of the spectrum, reductions in npxG occurred least
frequently for shorter <code>distance</code> buckets
(<code>(0,2]</code>, <code>(2,4]</code>, <code>(4,6]</code>,
<code>(6,8)</code>). Reductions still occurred a majority of the time
when there was a change—note that each has <code>&gt;50%</code> for the
last column—for all but the shortest <code>distance</code> group,
<code>(0,2]</code>.</p>
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 8%" />
<col style="width: 17%" />
<col style="width: 21%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Feature</th>
<th style="text-align: left;">Group</th>
<th style="text-align: right;"># of non-penalty shots</th>
<th style="text-align: right;"># of shots with changed npxG</th>
<th style="text-align: right;"># of shots with lower post-update npxG of
those that changed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>distance</code></td>
<td style="text-align: left;"><code>(0,2]</code></td>
<td style="text-align: right;">173</td>
<td style="text-align: right;">130 (75.1%)</td>
<td style="text-align: right;">51 (39.2%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>distance</code></td>
<td style="text-align: left;"><code>(2,4]</code></td>
<td style="text-align: right;">1,087</td>
<td style="text-align: right;">826 (76.0%)</td>
<td style="text-align: right;">428 (51.8%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>distance</code></td>
<td style="text-align: left;"><code>(4,6]</code></td>
<td style="text-align: right;">2,003</td>
<td style="text-align: right;">1,479 (73.8%)</td>
<td style="text-align: right;">831 (56.2%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>distance</code></td>
<td style="text-align: left;"><code>(35,Inf]</code></td>
<td style="text-align: right;">539</td>
<td style="text-align: right;">313 (58.1%)</td>
<td style="text-align: right;">177 (56.5%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>distance</code></td>
<td style="text-align: left;"><code>(6,8]</code></td>
<td style="text-align: right;">2,557</td>
<td style="text-align: right;">1,882 (73.6%)</td>
<td style="text-align: right;">1,183 (62.9%)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>is_free_kick</code></td>
<td style="text-align: left;"><code>"yes"</code></td>
<td style="text-align: right;">1,576</td>
<td style="text-align: right;">882 (56.0%)</td>
<td style="text-align: right;">557 (63.2%)</td>
</tr>
</tbody>
</table>
<h2 id="xg-model-calibration">2. xG Model Calibration</h2>
<p><a
href="https://tonyelhabr.rbind.io/post/epl-xpts-simulation-1/#match-predictive-performance7">I’ve
touched on model calibration before</a>, when discussing xG-implied
match outcome probabilities. There, I wrote my own code to create a <a
href="https://changhsinlee.com/python-calibration-plot/">calibration
plot</a>. Since then, the <a
href="https://www.tidymodels.org/"><code>{tidymodels}</code> team</a>
has added <a
href="https://www.tidyverse.org/blog/2022/11/model-calibration/">calibration
plot functionality</a> to the <a
href="https://probably.tidymodels.org/"><code>{probably}</code>
package</a>. Let’s try it out.</p>
<p>Here, we’ll use a big sample of data—all 2017/18 - 2021/22
non-penalty shots for the Big 5 leagues and several other first and
second tier leagues.<a href="#fn7" class="footnote-ref" id="fnref7"
role="doc-noteref"><sup>7</sup></a></p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>np_shots</span> |&gt; <span class='fu'>count</span><span class='op'>(</span><span class='va'>league</span>, name <span class='op'>=</span> <span class='st'>'n_shots'</span><span class='op'>)</span>
<span class='co'>#&gt; # A tibble: 13 × 2</span>
<span class='co'>#&gt;    league    n_shots</span>
<span class='co'>#&gt;    &lt;chr&gt;       &lt;int&gt;</span>
<span class='co'>#&gt;  1 BRA_1st_M   39380</span>
<span class='co'>#&gt;  2 ENG_1st_F   11366</span>
<span class='co'>#&gt;  3 ENG_1st_M   46766</span>
<span class='co'>#&gt;  4 ENG_2nd_M   52701</span>
<span class='co'>#&gt;  5 ESP_1st_M   43398</span>
<span class='co'>#&gt;  6 FRA_1st_M   43021</span>
<span class='co'>#&gt;  7 GER_1st_M   39148</span>
<span class='co'>#&gt;  8 ITA_1st_M   49903</span>
<span class='co'>#&gt;  9 MEX_1st_M   32650</span>
<span class='co'>#&gt; 10 NED_1st_M   29803</span>
<span class='co'>#&gt; 11 POR_1st_M   27366</span>
<span class='co'>#&gt; 12 USA_1st_F    9887</span>
<span class='co'>#&gt; 13 USA_1st_M   31047</span>
</code></pre>
</div>
</div>
<h3 id="calibration-plot">Calibration plot</h3>
<p>We can use <code>probably::cal_plot_breaks()</code> to visually
assess whether the observed rate of non-penalty goals (y-axis) is close
to the predicted probably of goals (npxG, x-axis).<a href="#fn8"
class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a> If
the xG model’s predictions are “well calibrated”, the calibration points
will align with the “ideal” line having slope 1 and intercept 0. Points
at which the curve is below the diagonal line indicate where the model
is more likelty to overpredict; and, likewise, points where the curve is
above the diagonal line indicate where the model is underpredicting.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/tidymodels/probably/'>probably</a></span><span class='op'>)</span> <span class='co'>## 0.1.0.9007</span>

<span class='va'>overall_calibration</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://probably.tidymodels.org/reference/cal_plot_breaks.html'>cal_plot_breaks</a></span><span class='op'>(</span>
  <span class='va'>np_shots</span>,
  truth <span class='op'>=</span> <span class='va'>is_goal</span>,
  estimate <span class='op'>=</span> <span class='va'>xg</span>,
  num_breaks <span class='op'>=</span> <span class='fl'>20</span>,
  conf_level <span class='op'>=</span> <span class='fl'>0.9</span>,
  event_level <span class='op'>=</span> <span class='st'>'second'</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<p><img src="overall_calibration.png" /></p>
<p>We can see that the model is pretty well calibrated on the lower end
of the spectrum, when xG &lt; 0.25. This makes up a larger majority of
the shots (~90%). However, the model is not as well calibrated for
higher xG values, tending to overpredict. For example, at the
calibration point where npxG is <code>0.675</code>, the actual goal rate
is <code>0.6</code>.</p>
<h3 id="brier-skill-score-bss">Brier Skill Score (BSS)</h3>
<p>One thing that is not provided in the <code>{tidymodels}</code> realm
(specifically, the <code>{yardstick}</code> package) is a function to
compute <a href="https://en.wikipedia.org/wiki/Brier_score">Brier
score</a>. Nonetheless, we can define a Brier score function ourselves
by closely following <a
href="https://www.tidymodels.org/learn/develop/metrics/">the mean
squared error custom metric example</a> provided by the
<code>{tidymodels}</code> team.<a href="#fn9" class="footnote-ref"
id="fnref9" role="doc-noteref"><sup>9</sup></a></p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/tidymodels/yardstick'>yardstick</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://rlang.r-lib.org'>rlang</a></span><span class='op'>)</span>
<span class='va'>brier_score</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>data</span>, <span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='kw'><a href='https://rdrr.io/r/base/UseMethod.html'>UseMethod</a></span><span class='op'>(</span><span class='st'>'brier_score'</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='va'>brier_score</span> <span class='op'>&lt;-</span> <span class='fu'>yardstick</span><span class='fu'>::</span><span class='fu'><a href='https://yardstick.tidymodels.org/reference/new-metric.html'>new_prob_metric</a></span><span class='op'>(</span><span class='va'>brier_score</span>, direction <span class='op'>=</span> <span class='st'>'minimize'</span><span class='op'>)</span>

<span class='va'>brier_score_vec</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>truth</span>, <span class='va'>estimate</span>, <span class='va'>na_rm</span> <span class='op'>=</span> <span class='cn'>TRUE</span>, <span class='va'>event_level</span>, <span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span>
  
  <span class='va'>brier_score_impl</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>truth</span>, <span class='va'>estimate</span>, <span class='va'>event_level</span>, <span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='va'>truth</span> <span class='op'>&lt;-</span> <span class='fl'>1</span> <span class='op'>-</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>truth</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>)</span>
    
    <span class='kw'>if</span> <span class='op'>(</span><span class='va'>event_level</span> <span class='op'>==</span> <span class='st'>'second'</span><span class='op'>)</span> <span class='op'>{</span>
      <span class='va'>truth</span> <span class='op'>&lt;-</span> <span class='fl'>1</span> <span class='op'>-</span> <span class='va'>truth</span>
    <span class='op'>}</span>
    
    <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>truth</span> <span class='op'>-</span> <span class='va'>estimate</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span>
  <span class='op'>}</span>
  
  <span class='co'>## Recycle the estimate value if it's scalar-ish.</span>
  <span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>estimate</span><span class='op'>)</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='va'>estimate</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='va'>estimate</span>, <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>truth</span><span class='op'>)</span><span class='op'>)</span>
  <span class='op'>}</span>
  
  <span class='fu'>yardstick</span><span class='fu'>::</span><span class='fu'><a href='https://yardstick.tidymodels.org/reference/metric_vec_template.html'>metric_vec_template</a></span><span class='op'>(</span>
    metric_impl <span class='op'>=</span> <span class='va'>brier_score_impl</span>,
    truth <span class='op'>=</span> <span class='va'>truth</span>,
    estimate <span class='op'>=</span> <span class='va'>estimate</span>,
    na_rm <span class='op'>=</span> <span class='va'>na_rm</span>,
    cls <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'factor'</span>, <span class='st'>'numeric'</span><span class='op'>)</span>,
    estimator <span class='op'>=</span> <span class='st'>'binary'</span>,
    event_level <span class='op'>=</span> <span class='va'>event_level</span>,
    <span class='va'>...</span>
  <span class='op'>)</span>
<span class='op'>}</span>

<span class='va'>brier_score.data.frame</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>data</span>, <span class='va'>truth</span>, <span class='va'>estimate</span>, <span class='va'>na_rm</span> <span class='op'>=</span> <span class='cn'>TRUE</span>, <span class='va'>event_level</span> <span class='op'>=</span> <span class='st'>'first'</span>, <span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'>yardstick</span><span class='fu'>::</span><span class='fu'><a href='https://yardstick.tidymodels.org/reference/metric_summarizer.html'>metric_summarizer</a></span><span class='op'>(</span>
    metric_nm <span class='op'>=</span> <span class='st'>'brier_score'</span>,
    metric_fn <span class='op'>=</span> <span class='va'>brier_score_vec</span>,
    data <span class='op'>=</span> <span class='va'>data</span>,
    truth <span class='op'>=</span> <span class='op'>!</span><span class='op'>!</span><span class='fu'>rlang</span><span class='fu'>::</span><span class='fu'><a href='https://rlang.r-lib.org/reference/enquo.html'>enquo</a></span><span class='op'>(</span><span class='va'>truth</span><span class='op'>)</span>,
    estimate <span class='op'>=</span> <span class='op'>!</span><span class='op'>!</span><span class='fu'>rlang</span><span class='fu'>::</span><span class='fu'><a href='https://rlang.r-lib.org/reference/enquo.html'>enquo</a></span><span class='op'>(</span><span class='va'>estimate</span><span class='op'>)</span>,
    na_rm <span class='op'>=</span> <span class='va'>na_rm</span>,
    event_level <span class='op'>=</span> <span class='va'>event_level</span>,
    <span class='va'>...</span>
  <span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>Let’s compute the Brier scores for (1) the overall goal rate
(i.e. shots per goal) and (2) xG. We should expect the Brier score for
the latter to be closer to 0 (perfect model), since xG should be a
better predictor of goals than the naive goal rate.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>np_goal_rate</span> <span class='op'>&lt;-</span> <span class='va'>np_shots</span> |&gt; 
  <span class='fu'>count</span><span class='op'>(</span><span class='va'>is_goal</span><span class='op'>)</span> |&gt; 
  <span class='fu'>mutate</span><span class='op'>(</span>prop <span class='op'>=</span> <span class='va'>n</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span><span class='op'>)</span> |&gt; 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>is_goal</span> <span class='op'>==</span> <span class='st'>'yes'</span><span class='op'>)</span> |&gt; 
  <span class='fu'>pull</span><span class='op'>(</span><span class='va'>prop</span><span class='op'>)</span>
<span class='va'>np_goal_rate</span>
<span class='co'>#&gt; 0.0960288</span>

<span class='va'>np_goal_rate_brier_score</span> <span class='op'>&lt;-</span> <span class='va'>np_shots</span> |&gt; 
  <span class='fu'>brier_score</span><span class='op'>(</span>
    truth <span class='op'>=</span> <span class='va'>is_goal</span>,
    estimate <span class='op'>=</span> <span class='op'>!</span><span class='op'>!</span><span class='va'>np_goal_rate</span>,
    event_level <span class='op'>=</span> <span class='st'>'second'</span>
  <span class='op'>)</span> |&gt; 
  <span class='fu'>pull</span><span class='op'>(</span><span class='va'>.estimate</span><span class='op'>)</span>
<span class='va'>np_goal_rate_brier_score</span>
<span class='co'>#&gt; [1] 0.08680727</span>

<span class='va'>npxg_brier_score</span> <span class='op'>&lt;-</span> <span class='va'>np_shots</span> |&gt; 
  <span class='fu'>brier_score</span><span class='op'>(</span>
    truth <span class='op'>=</span> <span class='va'>is_goal</span>,
    estimate <span class='op'>=</span> <span class='va'>xg</span>,
    event_level <span class='op'>=</span> <span class='st'>'second'</span>
  <span class='op'>)</span> |&gt; 
  <span class='fu'>pull</span><span class='op'>(</span><span class='va'>.estimate</span><span class='op'>)</span>
<span class='va'>npxg_brier_score</span>
<span class='co'>#&gt; [1] 0.07150071</span>
</code></pre>
</div>
</div>
<p>Now we can go on to compute <a
href="https://en.wikipedia.org/wiki/Brier_score#Brier_Skill_Score_(BSS)">Brier
skill score (BSS)</a> using an appropriate reference Brier score.<a
href="#fn10" class="footnote-ref" id="fnref10"
role="doc-noteref"><sup>10</sup></a> In this context, the average goal
rate seems to be a good choice for a baseline. In contrast to the Brier
score, a higher BSS is ideal. (A perfect model would have a BSS of
1.)</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>npxg_brier_score</span> <span class='op'>&lt;-</span> <span class='va'>np_shots</span> |&gt; 
  <span class='fu'>brier_score</span><span class='op'>(</span>
    truth <span class='op'>=</span> <span class='va'>is_goal</span>,
    estimate <span class='op'>=</span> <span class='va'>xg</span>,
    event_level <span class='op'>=</span> <span class='st'>'second'</span>
  <span class='op'>)</span> |&gt; 
  <span class='fu'>pull</span><span class='op'>(</span><span class='va'>.estimate</span><span class='op'>)</span>
<span class='fl'>1</span> <span class='op'>-</span> <span class='op'>(</span><span class='va'>npxg_brier_score</span> <span class='op'>/</span> <span class='va'>np_goal_rate_brier_score</span><span class='op'>)</span>
<span class='co'>#&gt; [1] 0.176328</span>
</code></pre>
</div>
</div>
<p>A BSS of ~0.18 is not bad! This is better than <a
href="https://projects.fivethirtyeight.com/checking-our-work/">FiveThirtyEight’s
BSS</a> for predicting the results for men’s World Cup matches (~0.12 at
time of writing) and right around their BSS for predicting WNBA playoff
game outcomes (~0.18).</p>
<h3 id="grouped-calibration-and-bss">Grouped Calibration and BSS</h3>
<p>Now let’s take a look at model calibration under specific criteria.
Is the model worse for shots that follow a dribble
(<code>take_on</code>) shot-creating action? After a
<code>live_ball</code> pass? etc.</p>
<p><img src="sca1_calibration.png" /></p>
<p>A couple of observations and thoughts:</p>
<ul>
<li><p>xG of shots following another shot are over-predicted so much
that it causes the BSS to be negative. This means that the model is
actually doing worse in its xG assignment than simply predicting naive
goal rate for shots after another shot!</p></li>
<li><p>A relatively “jagged” calibration plot may not correspond with a
worse (lower) BSS score; and visa versa, a relatively “smooth”
calibration plot may not correspond with a better (higher) BSS.</p>
<ul>
<li>Note that the <code>fouled</code> calibration looks jagged for
higher predicted xG, but the fact goals are only scored on about 5%
shots immediately following a foul means that inprecise probabilities
are not “penalized” quite as much. On the other hand, while the
<code>pass_live</code> calibration looks relatively smooth, the fact
that 10% of shots following live ball passes (2x the frequency for shots
following fouls) means that it is more penalized for imprecision than an
otherwise equivalent post-<code>fouled</code> shot. In fact, this is <a
href="https://en.wikipedia.org/wiki/Brier_score#Shortcomings">one of the
shortcomings of BSS</a>—it does not do a great job with evaluation of
relatively infrequent events.</li>
</ul></li>
</ul>
<p>Next, let’s take a look at calibration off shots coming after
deflections (of other shots).</p>
<p><img src="deflection_calibration.png" /></p>
<ul>
<li>The model doesn’t seem to be very well calibrated for shots
following deflections! Like shots following other shots in the
shot-creating action calibration plot, the BSS for shots after
deflections is negative. And, perhaps more interestingly, the model
seems to underpredict post-deflection shots, which is the opposite of
it’s general tendency to overpredict. (See the wholistic calibration
plot from before.)
<ul>
<li>I’d suspect that there’s lots of confounders that might explain the
lack of calibration after deflections. For one, it could be the case
that there are often zero defenders between the shot-taker and keeper
for shots following a deflection. As far as I know, the Opta model
doesn’t have an explicit feature for this.</li>
<li>It might also be the case that Opta’s <a
href="https://theanalyst.com/eu/2021/07/what-are-expected-goals-xg">“big
chance” indicator</a>—which is not published on FBref but which I
suspect take on a value of “yes”/1/true for many post-deflection
shots—may have some flaws.</li>
</ul></li>
</ul>
<p>Moving on, let’s look at calibration of the xG model by groups of
leagues, splitting out by tier and gender.</p>
<p><img src="league_group_calibration.png" /></p>
<ul>
<li><a
href="https://statsbomb.com/articles/soccer/analytics-and-modelling-in-womens-football/">StatsBomb
has talked</a> about how a “gender-aware” model outperformed a baseline
model, so one might expect the calibration of Opta’s singular model to
be weaker for the women’s game. It turns out that while, yes, the
calibration seems to be a bit worse for shots in the women’s leagues,
the overall difference in model performance for men’s and women’s
leagues seems to be trivial for the sample here.</li>
<li>Interestingly, the calibration of the model for non-Big 5 leagues
and the English men’s Championship league are slightly better according
to BSS, although the differences (both visually, with the calibration
curve, and with BSS) are very minimal.</li>
</ul>
<p>Finally, let’s look at how footedness may play a role in model
calibration. As far as I know, whether or not a footed shot is take by a
player’s primary foot is not an input into the Opta model, so it may be
particularly interesting to look at.</p>
<p><img src="footedness_calibration.png" /></p>
<ul>
<li>Despite my suspicion that xG for shots taken by a player’s weaker
foot (<code>right foot shot, left-footed</code> and
<code>left foot shot, right-footed</code>) might be severely
overpredicted, this doesn’t really seem to be the case. Yes, the model
tends to overpredict for these kinds of shots, but the degree to which
overprediction occurs doesn’t seem out of line with the whole model.
<ul>
<li>I can think of least two types of “selection bias” at play here that
might explain why the calibration isn’t as bad as I might have guessed
for weak-footed shots:
<ol type="1">
<li>Players are more likely to take weak-footed shots when they’re
closer to the goal, where shots are likely to have higher xG, but also
where shots are also more likely to go in.</li>
<li>Players are less likely to take more difficult shots with their weak
foot, so they’re not taking as many shots that are unlikely to go in,
holding all else equal.</li>
</ol></li>
</ul></li>
<li>Of the non-footed shots, it’s interesting to see that the BSS for
headers and shots from <code>other</code> body parts are not
particularly well calibrated. In fact, the latter has a negative BSS,
indicating that we’d better off with a model that predicted the average
goal rate for such shots.</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>We’ve explored the wonderful world of model calibration, making
friends with BSS and calibration curves in our investigation of a public
xG model. Are BSS and calibration curves the be-all and end-all when it
comes to model evaluation? Of course not! But they’re useful tools that
may or may not be appropriate for your use case.</p>
<p>When it comes to the Opta xG model specifically, am I implying that
the model is bad? Of course not! Yes, faceted calibration curves and
feature-specific BSS can make a model look bad, but we must keep in mind
that there are trade-offs to be made with modeling. Fine-tuning a model
to be more well calibrated under certain conditions, e.g. shots after
deflections, may make other parts of the model worse! It’s all about
trade-offs.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<section id="footnotes" class="footnotes footnotes-end-of-document"
role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p>It’s typically better to analyze expected goals after
removing penalties since penalties can distort quantities, adding
“noise” to an analysis.<a href="#fnref1" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>FBref/Opta didn’t specify how they changed their xG
model. Given how I observed very only trivial differences in the
shot-level xG for prior seasons, it’s possible that they didn’t even
change their model! There could have been some data issue specific to
the 2021/22 season, that, when addressed, resulted in more plausible
xG.<a href="#fnref2" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>All code available <a
href="https://github.com/tonyelhabr/itsmetoeknee">on GitHub</a>.<a
href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Observe that, for a large majority of shots, where xG is
in the (0, 0.05] range, xG either did not change at all or only
trivially changed. (See the blur of white points on the left-hand side
of the plot.)<a href="#fnref4" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Several of these are not provided directly from the raw
FBref tables. For example, <code>is_from_deflection</code> is derived
from the <code>Notes</code> field in the FBref shot table.
<code>is_primary_foot</code> is derived from collecting player
footedness data and checking for a match with <code>body_part</code>.<a
href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>Note that I use the term “feature” here, although this
set of fields does not quite match the actual <a
href="https://theanalyst.com/eu/2021/07/what-are-expected-goals-xg">inputs
to the</a> <a
href="https://fbref.com/en/expected-goals-model-explained/">Opta xG
model</a>. While things like <code>distance</code> and
<code>body_part</code> certainly are inputs to the model, we don’t have
angle of the shot to the goal, and <code>is_primary_foot</code>—a field
that I’ve added the feature set myself—isn’t one of the model inputs, as
far as I’m aware.<a href="#fnref6" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>Several leagues don’t have data available for all such
seasons, which is reflected in the row counts by group.<a href="#fnref7"
class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p>I’ve written my own code to plot the calibration, but I
imagine most users will be satisfied with the plot that
<code>{probably}</code> will generate for you.<a href="#fnref8"
class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn9"><p>Brier score for a binary classification task is
equivalent to mean squared error.<a href="#fnref9" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
<li id="fn10"><p>Personally, I like to use BSS over other classification
metrics like <a
href="https://en.wikipedia.org/wiki/Receiver_operating_characteristic">ROC
AUC</a> or Brier score alone. BSS is arguably the most interpretable
probabilistic classification measure. Also, I like that it forces one to
choose a reference with which to compare, which is a good principle in
general, I think.<a href="#fnref10" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
