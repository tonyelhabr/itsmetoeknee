---
title: 'Yet Another (Advenced?) Soccer Statistic'
description: 'Quantifying soccer pass networks with maximum cuts'
author:
  - name: Tony ElHabr
    url: 'https://twitter.com/TonyElHabr'
date: 2022-02-01
categories:
  - r
  - soccer
output: 
  distill::distill_article:
    toc: true
    toc_depth: 3
    self_contained: false
preview: featured.png
twitter:
  site: '@TonyElHabr'
  creator: '@TonyElHabr'
---

```{r setup, include=F, echo=F, cache=F}
knitr::opts_chunk$set(
  include = TRUE,
  echo = TRUE,
  cache = FALSE,
  eval = FALSE,
  cache.lazy = FALSE,
  fig.show = 'hide',
  fig.align = 'center',
  fig.width = 8,
  fig.asp = 0.75,
  fig.retina = 2,
  warning = FALSE,
  message = FALSE
)
```

## Introduction

[Pass networks](https://www.datofutbol.cl/passing-networks-r/) are a common visualization used to summarize a team's behavior in a soccer match. Nodes represent average player position on passes that they are involved with, and edges represent passes between players. Most pass networks also weight node size and edge width by the relative to the total number of passes.

While pass networks provide a nice visual tool for providing insight that can (and should) be supplemented by more detailed analysis, they're often just that---purely a visual tool. In order to gain meaning beyond just anecdotal insight ("Look at how far the wingbacks were up the field!"), practitioners may leverage graph theory concepts such as [centrality](https://en.wikipedia.org/wiki/Centrality) to quantify relationships.[^1]

[^1]: There are other things researchers have done, such as [subsetting the passes that make up the network based on game situation](https://karun.in/blog/interactive-passing-networks.html), or \[supplement the visual with meaningful color\]((<https://statsbomb.com/2018/08/explaining-xgchain-passing-networks/>)

Inspired by Eliakim et. al.'s ["The development of metrics for measuring the level of symmetry in team formation and ball movement flow, and their association with performance"](https://www.tandfonline.com/doi/abs/10.1080/24733938.2021.1919747), I wanted to evaluate

1.  [maximum cuts](https://en.wikipedia.org/wiki/Maximum_cut)
2.  "reflective overlap"

The former is a graph theory concept that has not been explored in relation to soccer pass networks (except for by Eliakim et. al.), and the latter is a term I made up for my attempt at quantifying formation symmetry.[^2]

[^2]: Eliakim et. al. attempt to quanitify formation symmetry with a calculation based on Voronoi tesselations. It's interesting, but I disgree with the approach since it inherently treats each space on the pitch as equal, which I don't believe to be true. Nonetheless, this isn't to say that my metric is superior.

### Data

I'll be using data from the 2017/18 - 2020/21 Premier League seasons, along with the games up through Boxing Day of the 2021/22 season. Passes and other events are only considered up through the first substitution or red card of each match.

## Maximum Pass Network Cuts

What is a maximum cut? Visually, it's an arbitrary line that you can draw through the edges of a network that maximizes the sum of the edge weights.

![](C:/Users/antho/Documents/projects/sports_viz/47-formation_symmetry/example_max_cut.png)

That is actually a weighted max cut, since edges are treated differently, according to their assigned value. (An unweighted max cut would assign each edge a value of 1.)

Switching over to soccer, here's what the pass network and weighted max cut numbers for [the match between Liverpool and Manchester City on October 3, 2021](https://www.fotmob.com/match/3609994/matchfacts/liverpool-vs-manchester-city) look like. [^3]

[^3]: Unfortunately, max cuts can be difficult to visualize for graphs with lots of edges and/or nodes, so reporting just the quantity is often the best thing we can do. ðŸ¤·

![](C:/Users/antho/Documents/projects/sports_viz/47-formation_symmetry/network-game_id=1549604-max_cut_weighted_w_logo.png)

Zooming out from a single example to all games in our data set, the distribution of weighted max cuts per 90 minutes (wMC/90) looks normal.[^4]

[^4]: It's important to adjust for time since not all games have the same number of minutes played due to variance in the occurrence of the first formation change.

![](C:/Users/antho/Documents/projects/sports_viz/47-formation_symmetry/game_mc_hist_w_logo.png)

When plotting wMC/90 against xG/90 differential---probably the best singular measure of overall quality of play[^5]---we see that there's some correlation.

[^5]: If we wanted to do an un-weighted calculation, we would use `1` for any `n>0` in the example here.

![](C:/Users/antho/Documents/projects/sports_viz/47-formation_symmetry/game_mc_xg_scatter_w_logo.png)

In fact, weighted max cut compares favorably against other network stats for summarizing networks in correlation with xG/90 difference, and is basically equivalent to relative % of completed passes at the game-level.[^6] Eliakim et. al. argue that, in relation to soccer, maximum cut surmises what is captured separately by various measures of centrality ([betweenness](https://en.wikipedia.org/wiki/Betweenness_centrality), [indegree and outdegree](https://en.wikipedia.org/wiki/Directed_graph#Indegree_and_outdegree), etc.), which certainly rings true here.

[^6]: We should expect that % of shots has the highest correlation by a fair margin since, given a constant xG per shot, % of shots would perfectly correlate with xG/90 difference.

```{=html}
<span style="max-width:80%; height:auto"><img src=":/Users/antho/Documents/projects/sports_viz/47-formation_symmetry/game_xg_cors_table.png"></span>
```
These correlations are fairly weak, indicating that we can't read too much into them for individual games. The correlations are stronger at the season-level, showing the same ordinality in magnitude of correlation.

```{=html}
<span style="max-width:1000%; height:auto"><img src=":/Users/antho/Documents/projects/sports_viz/47-formation_symmetry/game_and_season_xg_cors_table.png"></span>
```
But this approach is probably too naive. The biggest factor in forecasting xG/90 difference is relative percentage of shots. If we regress max cut on xG/90 difference with relative percentage of shots as a confounder---undoubtedly the most important factor in forecasting xG difference, as evident in the correlations---we see that the influence of max cut diminishes.

How does that 0.55 number change when we add potential confounders to the equation? A regression with xG differential as the target variable and relative proportion of shots, relative proportion of passes, and max cuts of the pass network show that max cut is useful for predicting xG differential, although certainly less significant than the other two variables.

table

How do the correlations and regression coefficients look at the game-level? Well, they become weaker across the board. (Smaller samples mean more noise!)

table

### Why is this Novel?

So why haven't people tried to compute max cuts for pass networks before? I can think of a couple of reasons:

1.  The calculation requires an un-directed network. In our context, this requires treating passes between players as equal, regardless of who is the passer and who is the receiver. This can distort the role of a striker, who may receive much more than pass, or a keeper, who may pass much more than receive.
2.  It's difficult to visualize beyond just reporting a single number, and, thus, may not resonate with an audience.
3.  It's not super easy to calculate! In fact, `{igraph}`---the most popular R framework for network analysis---doesn't have a function for it! FWIW the code that I wrote to calculate the weighted maximum cut for a pass network looks something like this.[^7] (This is the calculation for the 4-node example network shown before.)

[^7]: If we wanted to do an un-weighted calculation, we would use `1` for any `n>0` in the example here.

```{r eval=F}
library(tibble)
library(dplyr)
library(tidyr)
library(sdpt3r) ## Semi-Definite Quadratic Linear Programming Solver

df <- tibble(
  from = c('a', 'a', 'a', 'b', 'b', 'b', 'c', 'c', 'c', 'd', 'd', 'd'),
  to   = c('b', 'c', 'd', 'a', 'c', 'd', 'a', 'b', 'd', 'a', 'b', 'c'),
  n    = c( 1L,  0L,  3L,  1L,  1L,  1L,  0L,  2L,  1L,  1L,  5L,  4L)
)

wide_df <- df %>% 
  pivot_wider(
    names_from = to,
    values_from = n,
    values_fill = 0L
  ) %>% 
  select(from, a, b, c, d) %>% 
  arrange(from) %>% 
  select(-from)
wide_df
## # A tibble: 4 x 4
##       a     b     c     d
##   <int> <int> <int> <int>
## 1     0     1     0     3
## 2     1     0     1     1
## 3     0     2     0     1
## 4     1     5     4     0

m <- as.matrix(wide_df)
symmetric_m <- m + t(m) ## must be symmetric
mc <- maxcut(symmetric_m)
max_cut <- -round(mc$pobj, 0)
max_cut
## [1] 15
```

So what should our take-away be? Well, the relationship between the value of maximum pass network cut and a team's season-long xG differential is certainly noteworthy, but that relationship suffers at the game-level. But xG differential itself suffers from a similar decline in it's relationship with scorelines when we change our perspective from season-long to individual games. And the analytics community is always saying that we shouldn't read too much into single-game xG. So if we are to accept that as truth, then we must say the same about maximum cuts and the relative quality of a team in a match.

## Maximum Pass Network Cuts

## Conclusion

These kinds of metrics may or may not be useful, depending on your application, but there's no denying that they are at useful for providing some kind of summary of a visual thing (the pass network).
